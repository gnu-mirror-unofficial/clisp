<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>30.2. Extensions-2.2. External Modules</title><link rel="stylesheet" href="impnotes.css" type="text/css" /><link rev="made" href="mailto:clisp-list@sf.net" /><meta name="generator" content="DocBook XSL Stylesheets V1.65.1" /><link rel="home" href="index.html" title="Implementation Notes for GNU CLISP." /><link rel="up" href="platform.html" title="Chapter 30. Extensions-2: Platform specific Extensions" /><link rel="previous" href="screen.html" title="30.1. Extensions-2.1. Random Screen Access" /><link rel="next" href="dffi.html" title="30.3. Extensions-2.3. The Foreign Function Call Facility" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">30.2. Extensions-2.2. External Modules</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="screen.html">Prev</a> </td><th width="60%" align="center">Chapter 30. Extensions-2: Platform specific Extensions</th><td width="20%" align="right"> <a accesskey="n" href="dffi.html">Next</a></td></tr></table><hr /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="modules"></a>30.2. Extensions-2.2. External Modules</h2></div><div><h3 class="subtitle">Platform dependent: <a href="http://www.UNIX-systems.org/online.html" target="_top"><strong>UNIX</strong></a> and <a href="http://www.willows.com/" target="_top"><strong>Win32</strong></a> platforms only.</h3></div></div><div></div></div><div class="toc"><dl><dt><span class="section"><a href="modules.html#mod-overview">30.2.1. Overview</a></span></dt><dt><span class="section"><a href="modules.html#modinfo">30.2.2. Function <tt class="function">EXT:MODULE-INFO</tt></a></span></dt><dt><span class="section"><a href="modules.html#mod-dynload">30.2.3. Function <tt class="function">SYS::DYNLOAD-MODULES</tt></a></span></dt><dt><span class="section"><a href="modules.html#mod-set-example">30.2.4. Example</a></span></dt><dt><span class="section"><a href="modules.html#module-tools">30.2.5. Module tools</a></span></dt><dt><span class="section"><a href="modules.html#included-modules">30.2.6. Modules included in the distribution.</a></span></dt></dl></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="mod-win32"></a>Modules on <strong>Win32</strong>.</h3><p>Everything described in the section will work verbatim on <a href="http://www.willows.com/" target="_top"><strong>Win32</strong></a>
  when using <a href="http://cygwin.com/" target="_top"><strong>Cygwin</strong></a> or <a href="http://www.mingw.org/" target="_top"><strong>MinGW</strong></a>, <span class="emphasis"><em>except</em></span> for one
  thing - you will need to replace the <tt class="filename">run</tt>
  extension in <tt class="filename">lisp.run</tt> with the <a href="http://www.willows.com/" target="_top"><strong>Win32</strong></a> executable
  extension <tt class="filename">exe</tt>.</p><p>For historical reasons, all examples appear to assume <a href="http://www.UNIX-systems.org/online.html" target="_top"><strong>UNIX</strong></a> and
  use the <tt class="filename">run</tt> file type (“<span class="quote">extension</span>”)
  for the <a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a> run-time.
  This does <span class="emphasis"><em>not</em></span> mean that they will not work on <a href="http://www.willows.com/" target="_top"><strong>Win32</strong></a>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="mod-overview"></a>30.2.1. Overview</h3></div></div><div></div></div><p><a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a> has a facility for adding external modules (written in
 <a href="http://www.eskimo.com/~scs/C-faq/top.html" target="_top"><span><b class="command">C</b></span></a>, for example).  It is invoked through
 <span><b class="command">clisp-link</b></span>.</p><p>A <strong class="first"><i class="firstterm">module<a id="module" class="indexterm"></a></i></strong> is a
 piece of external code which defines extra Lisp objects, symbols and
 functions.  A module name must consist of the characters
 <tt class="filename">A</tt>-<tt class="filename">Z</tt>,
 <tt class="filename">a</tt>-<tt class="filename">z</tt>, <tt class="filename">_</tt>,
 <tt class="filename">0</tt>-<tt class="filename">9</tt>.
 The module name “<span class="quote">clisp</span>” is reserved.
 Normally a module name is derived from the corresponding file name.</p><p><span><b class="command">clisp-link</b></span> needs a directory containing:
</p><div class="itemizedlist"><ul type="disc"><li><tt class="filename">#P"modules.d"</tt></li><li><tt class="filename">#P"modules.c"</tt></li><li><a href="modules.html#clisp-h" title="30.2.5.2. clisp.h"><tt class="filename">#P"clisp.h"</tt></a></li></ul></div><p>
<span><b class="command">clisp-link</b></span> expects to find these files in a
subdirectory <tt class="filename">linkkit/</tt> of the current directory.
This can be overridden by the <a href="http://www.opengroup.org/onlinepubs/007904975/basedefs/xbd_chap08.html" target="_top">environment variable</a> <tt class="envar">CLISP_LINKKIT</tt>.</p><p><span><b class="command">clisp-link</b></span> operates on <a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a> <a href="modules.html#linkset">linking set</a>s and
 on <a href="modules.html#modset">module set</a>s.</p><p><a id="linkset"></a><b><a href="modules.html#linkset">linking set</a>. </b>A <strong class="first"><i class="firstterm"><a href="modules.html#linkset">linking set</a><a id="linkseti" class="indexterm"></a></i></strong>
   is a directory containing:
</p><div class="variablelist"><dl><dt><tt class="filename">makevars</tt></dt><dd><p>some <a href="http://www.opengroup.org/onlinepubs/007904975/utilities/sh.html" target="_top"><span><b class="command">/bin/sh</b></span></a> commands, setting the variables
</p><div class="variablelist"><dl><dt><tt class="envar">CC</tt></dt><dd>the <a href="http://www.eskimo.com/~scs/C-faq/top.html" target="_top"><span><b class="command">C</b></span></a> compiler
 </dd><dt><tt class="envar">CPPFLAGS</tt></dt><dd>flags for the <a href="http://www.eskimo.com/~scs/C-faq/top.html" target="_top"><span><b class="command">C</b></span></a> compiler, when preprocessing
    or compiling</dd><dt><tt class="envar">CFLAGS</tt></dt><dd>flags for the <a href="http://www.eskimo.com/~scs/C-faq/top.html" target="_top"><span><b class="command">C</b></span></a> compiler, when compiling or
    linking</dd><dt><tt class="envar">CLFLAGS</tt></dt><dd>flags for the <a href="http://www.eskimo.com/~scs/C-faq/top.html" target="_top"><span><b class="command">C</b></span></a> compiler, when linking
 </dd><dt><tt class="envar">LIBS</tt></dt><dd>libraries to use when linking
 </dd><dt><tt class="envar">X_LIBS</tt></dt><dd>additional <a href="http://www.x.org/" target="_top">X Window System</a> libraries to use
 </dd><dt><tt class="envar">RANLIB</tt></dt><dd>the ranlib command
 </dd><dt><tt class="envar">FILES</tt></dt><dd>the list of files needed when linking
 </dd></dl></div></dd><dt><tt class="filename">modules.h</tt></dt><dd>the list of modules contained in this <a href="modules.html#linkset">linking set</a>
</dd><dt><tt class="filename">modules.o</tt></dt><dd>the compiled list of modules contained in this <a href="modules.html#linkset">linking set</a>
</dd><dt>all the <tt class="filename">FILES</tt></dt><dd>listed in <tt class="filename">makevars</tt>
</dd><dt><tt class="filename">lisp.run</tt></dt><dd>the executable</dd><dt><a href="image.html" title="29.1. Extensions-1.1. Saving an Image"><tt class="filename">#P"lispinit.mem"</tt></a></dt><dd>the <a href="image.html" title="29.1. Extensions-1.1. Saving an Image">memory image</a></dd></dl></div><p>To run a <a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a> contained in some <a href="modules.html#linkset">linking set</a>
 <tt class="filename">dir</tt>, call
 <span><b class="command"><i class="replaceable"><tt>dir</tt></i>/lisp.run -M
 <i class="replaceable"><tt>dir</tt></i>/lispinit.mem</b></span></p><p><a id="modset"></a><b><a href="modules.html#modset">module set</a>. </b>A <strong class="first"><i class="firstterm"><a href="modules.html#modset">module set</a><a id="modseti" class="indexterm"></a></i></strong>
   is a directory containing:
</p><div class="variablelist"><dl><dt><span><b class="command">link.sh</b></span></dt><dd>some <a href="http://www.opengroup.org/onlinepubs/007904975/utilities/sh.html" target="_top"><span><b class="command">/bin/sh</b></span></a> commands, which prepare the directory
  before linking, and set the variables <tt class="envar">NEW_FILES</tt>,
  <tt class="envar">NEW_LIBS</tt>, <tt class="envar">NEW_MODULES</tt>, <tt class="envar">TO_LOAD</tt>
  and optionally <tt class="envar">TO_PRELOAD</tt></dd><dt>and any other files</dt><dd>needed by <span><b class="command">link.sh</b></span>
 </dd></dl></div><p>Note that in <span><b class="command">link.sh</b></span> the <a href="modules.html#modset">module set</a> directory
 is referred to as <tt class="varname">$modulename/</tt>.</p><div class="variablelist"><dl><dt><tt class="envar">NEW_FILES</tt></dt><dd>the space-separated list of files that
  belong to the <a href="modules.html#modset">module set</a> and will belong to every new <a href="modules.html#linkset">linking set</a>.
 </dd><dt><tt class="envar">NEW_LIBS</tt></dt><dd>the space-separated list of files or
  <a href="http://www.eskimo.com/~scs/C-faq/top.html" target="_top"><span><b class="command">C</b></span></a> compiler switches that need to be passed to the <a href="http://www.eskimo.com/~scs/C-faq/top.html" target="_top"><span><b class="command">C</b></span></a>
  compiler when linking the lisp.run belonging to a new <a href="modules.html#linkset">linking set</a>.
 </dd><dt><tt class="envar">NEW_MODULES</tt></dt><dd>the space-separated list of the module names
  belonging to the <a href="modules.html#modset">module set</a>.  Normally, every <tt class="filename">#P".c"</tt> file in the
  <a href="modules.html#modset">module set</a> defines a module of its own.  The module name is derived
  from the file name.</dd><dt><tt class="envar">TO_LOAD</tt></dt><dd>the space-separated list of Lisp files to load
  before building the <a href="image.html" title="29.1. Extensions-1.1. Saving an Image"><tt class="filename">#P"lispinit.mem"</tt></a> belonging to a new <a href="modules.html#linkset">linking set</a>.
 </dd><dt><tt class="envar">TO_PRELOAD</tt> (optional)</dt><dd>the space-separated list of Lisp files to load
  into an intermediate <a href="image.html" title="29.1. Extensions-1.1. Saving an Image"><tt class="filename">#P"lispinit.mem"</tt></a> file, before building the <a href="image.html" title="29.1. Extensions-1.1. Saving an Image"><tt class="filename">#P"lispinit.mem"</tt></a>
  belonging to a new <a href="modules.html#linkset">linking set</a>.
  This variable is usually used for defining Lisp packages which must be
  present when the new <tt class="filename">#P".c"</tt> files are initialized.  E.g., the
  <a href="dffi.html#def-call-in"><tt class="function">FFI:DEF-CALL-IN</tt></a> functions must reside in already defined packages;
  see <a href="dffi.html#ex-call-in" title="Example 30.9. Calling Lisp from C">Example 30.9, “Calling Lisp from <span><b class="command">C</b></span>”</a>.</dd></dl></div><p>The command <span><b class="command">clisp-link create-module-set
 <i class="replaceable"><tt>module-dir</tt></i>
 <i class="replaceable"><tt>file1.c</tt></i> ...</b></span> creates a <a href="modules.html#modset">module set</a>
 in <i class="replaceable"><tt>module-dir</tt></i> which refers (via symbolic
 links) to <i class="replaceable"><tt>file1.c</tt></i> etc.  The files are
 expected to be modules of their own.</p><p>The command <span><b class="command">clisp-link add-module-set
 <i class="replaceable"><tt>module-dir</tt></i>
 <i class="replaceable"><tt>source-dir</tt></i>
 <i class="replaceable"><tt>destination-dir</tt></i></b></span> combines a
 <a href="modules.html#linkset">linking set</a> in <i class="replaceable"><tt>source-dir</tt></i> and a module in
 <i class="replaceable"><tt>module-dir</tt></i> to a new <a href="modules.html#linkset">linking set</a>, in a
 directory <i class="replaceable"><tt>destination-dir</tt></i> which is newly
 created.</p><p>The command <span><b class="command">clisp-link run <i class="replaceable"><tt>source-dir</tt></i>
 <i class="replaceable"><tt>module-dir</tt></i> ...</b></span> runs the <a href="modules.html#linkset">linking set</a>
 in <i class="replaceable"><tt>source-dir</tt></i>, with the module in
 <i class="replaceable"><tt>module-dir</tt></i> loaded.  More than one module can
 be specified.  If <a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a> has been built with the configuration option
 <tt class="option">--with-dynamic-modules</tt>, the loading will be performed
 through dynamic loading.  Otherwise - this is much slower - a temporary
 <a href="modules.html#linkset">linking set</a> will be created and deleted afterwards.  Note that dynamic
 loading does not work on all operating systems, and that
 <tt class="option">--with-dynamic-modules</tt> precludes some efficiency
 optimizations which are enabled by default.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="modinfo"></a>30.2.2. Function <a href="modules.html#modinfo" title="30.2.2. Function EXT:MODULE-INFO"><tt class="function">EXT:MODULE-INFO</tt></a></h3></div></div><div></div></div><p>Function <tt class="sexp">(<a href="modules.html#modinfo" title="30.2.2. Function EXT:MODULE-INFO"><tt class="function">EXT:MODULE-INFO</tt></a> <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;OPTIONAL</tt></a> <i class="replaceable"><tt>name</tt></i>
  <i class="replaceable"><tt>verbose</tt></i>)</tt> allows one to inquire
 about what modules are available in the currently running image.
 When called without arguments, it returns the list of module names,
 starting with “<span class="quote">clisp</span>”.  When <i class="replaceable"><tt>name</tt></i> is supplied and
 names a module, 3 values are returned - <i class="replaceable"><tt>name</tt></i>,
 <i class="replaceable"><tt>subr-count</tt></i>,
 <i class="replaceable"><tt>object-count</tt></i>.
 When <i class="replaceable"><tt>verbose</tt></i> is non-<a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a>, the full list of
 module lisp function names written in <a href="http://www.eskimo.com/~scs/C-faq/top.html" target="_top"><span><b class="command">C</b></span></a> (<span class="type">Subr</span>s) and
 the full list of internal lisp objects available in <a href="http://www.eskimo.com/~scs/C-faq/top.html" target="_top"><span><b class="command">C</b></span></a> code
 are additionally returned for the total of 5 values.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="mod-dynload"></a>30.2.3. Function <a href="modules.html#mod-dynload" title="30.2.3. Function SYS::DYNLOAD-MODULES"><tt class="function">SYS::DYNLOAD-MODULES</tt></a></h3></div><div><h4 class="subtitle">Platform dependent: some <a href="http://www.UNIX-systems.org/online.html" target="_top"><strong>UNIX</strong></a> platforms only, compiled <strong>with</strong>
 compile-time flag <tt class="option">--with-dynamic-modules</tt>.</h4></div></div><div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Note that dynamic loading does not work on all operating systems
(<a href="http://www.opengroup.org/onlinepubs/007904975/functions/dlopen.html" target="_top"><tt class="function">dlopen</tt></a> is required), and that <tt class="option">--with-dynamic-modules</tt>
precludes some efficiency optimizations which are on by default.</p></div><p>Function <tt class="sexp">(<a href="modules.html#mod-dynload" title="30.2.3. Function SYS::DYNLOAD-MODULES"><tt class="function">SYS::DYNLOAD-MODULES</tt></a> <i class="replaceable"><tt>filename</tt></i>
 ({<i class="replaceable"><tt>name</tt></i>}+))</tt> loads a shared object file or library
 containing a number of named external <a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a> modules.
 This facility cannot be used to <a href="http://www.opengroup.org/onlinepubs/007904975/functions/dlopen.html" target="_top"><tt class="function">dlopen</tt></a> and access arbitrary shared
 libraries.</p><p>External modules for <a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a> are those which contain a
 <tt class="literal">module__<i class="replaceable"><tt>name</tt></i>__subr_tab</tt>, among others.
 This serves to register external functions which operate on
 Lisp-level structures with <a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a>.</p><p>To use <a href="http://www.opengroup.org/onlinepubs/007904975/functions/dlopen.html" target="_top"><tt class="function">dlopen</tt></a> with modules, you should add
 <tt class="option">-fPIC</tt> to the module's compilation options.
 Something like <span><b class="command">cc -shared -o <i class="replaceable"><tt>name</tt></i>.so <i class="replaceable"><tt>name</tt></i>.o</b></span>
 may be needed to produce the shared object file.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="mod-set-example"></a>30.2.4. Example</h3></div></div><div></div></div><p>To link in the <a href="dffi.html" title="30.3. Extensions-2.3. The Foreign Function Call Facility"><strong class="package">“<span class="quote">FFI</span>”</strong></a> bindings for the <a href="http://www.gnu.org" target="_top">GNU</a>/<a href="http://www.linux.org/" target="_top"><strong>Linux</strong></a> operating
 system, the following steps are needed.  (Step 1 and step 2 need not be
 executed in this order.)</p><div class="orderedlist"><ol type="1"><li><p>Create a new <a href="modules.html#modset">module set</a>:

</p><table border="0" bgcolor="#E0E0E0"><tr><td><pre class="programlisting">$ clisp-link create-module-set linux /<i class="replaceable"><tt>somewhere</tt></i>/bindings/linux.c</pre></td></tr></table><p>

 Modify the newly created <tt class="filename">linux/link.sh</tt> to add
 <tt class="option">-lm</tt>; to the libraries: replace
</p><table border="0" bgcolor="#E0E0E0"><tr><td><pre class="programlisting">NEW_LIBS="$file_list"</pre></td></tr></table><p>
   with
</p><table border="0" bgcolor="#E0E0E0"><tr><td><pre class="programlisting">NEW_LIBS="$file_list -lm"</pre></td></tr></table><p>

   Modify the newly created <tt class="filename">linux/link.sh</tt> to load
   <tt class="filename">linux.fas</tt> before saving the <a href="image.html" title="29.1. Extensions-1.1. Saving an Image">memory image</a>:
   replace
</p><table border="0" bgcolor="#E0E0E0"><tr><td><pre class="programlisting">TO_LOAD=''</pre></td></tr></table><p>
   with
</p><table border="0" bgcolor="#E0E0E0"><tr><td><pre class="programlisting">TO_LOAD='/<i class="replaceable"><tt>somewhere</tt></i>/bindings/linux.fas'</pre></td></tr></table></li><li><p>Compile <tt class="filename">linux.lisp</tt>, creating
  <tt class="filename">linux.c</tt>:

</p><table border="0" bgcolor="#E0E0E0"><tr><td><pre class="programlisting">$ clisp -c /<i class="replaceable"><tt>somewhere</tt></i>/bindings/linux.lisp</pre></td></tr></table></li><li><p>Create a new <a href="modules.html#linkset">linking set</a>:
</p><table border="0" bgcolor="#E0E0E0"><tr><td><pre class="programlisting">$ clisp-link add-module-set linux base base+linux</pre></td></tr></table></li><li><p>Run and try it:

</p><table border="0" bgcolor="#E0E0E0"><tr><td><pre class="programlisting">$ base+linux/lisp.run -M base+linux/lispinit.mem -x '(linux:stat "/tmp")'</pre></td></tr></table></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="module-tools"></a>30.2.5. Module tools</h3></div></div><div></div></div><div class="toc"><dl><dt><span class="section"><a href="modules.html#modprep">30.2.5.1. Modprep</a></span></dt><dt><span class="section"><a href="modules.html#clisp-h">30.2.5.2. clisp.h</a></span></dt><dt><span class="section"><a href="modules.html#exporting">30.2.5.3. Exporting</a></span></dt></dl></div><p>There are some tools to facilitate easy module writing.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="modprep"></a>30.2.5.1. Modprep</h4></div></div><div></div></div><p>If your module is written in <a href="http://www.eskimo.com/~scs/C-faq/top.html" target="_top"><span><b class="command">C</b></span></a>, you can pre-process your
 sources with <tt class="filename">modprep.lisp</tt> in the <a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a>
 distribution and define lisp functions with the
 <tt class="function">DEFUN</tt> macro:</p><table border="0" bgcolor="#E0E0E0"><tr><td><pre class="programlisting">
DEFUN(MY-PACKAGE:MY-FUNCTION-NAME, arg1 arg2 <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a> FOO BAR) {
  if (!boundp(STACK_0)) STACK_0 = fixnum(0); /* BAR */
  if (!boundp(STACK_1)) STACK_1 = fixnum(1); /* FOO */
  pushSTACK(`MY-PACKAGE::SOME-SYMBOL`); /* create a symbol in the package */
  pushSTACK(`#(:THIS :IS :A :VECTOR)`); /* some vector, created once */
  pushSTACK(``MY-PACKAGE::MY-FUNCTION-NAME``); /* double `` means FUNCTION */
  VALUES1(listof(7)); /* cons up a new list and clean up the STACK */
}</pre></td></tr></table><p>
Then <tt class="sexp">(MY-PACKAGE:MY-FUNCTION-NAME 'A 12 :FOO
 T)</tt> will return <tt class="data">(A 12 T 0
 MY-PACKAGE::SOME-SYMBOL #(:THIS :IS :A :VECTOR)
 #&lt;ADD-ON-SYSTEM-FUNCTION MY-PACKAGE:MY-FUNCTION-NAME&gt;)</tt>
(assuming you <a href="http://www.lisp.org/HyperSpec/Body/fun_export.html" target="_top"><tt class="function">EXPORT</tt></a>ed <tt class="literal">MY-FUNCTION-NAME</tt> from
 <strong class="package">“<span class="quote">MY-PACKAGE</span>”</strong>).</p><p>Another useful macros are:
 </p><div class="variablelist"><dl><dt><tt class="function">DEFVAR</tt></dt><dd>create a GC-visible private object
  </dd><dt><tt class="function">DEFFLAGSET</tt></dt><dd>define a <a href="http://www.eskimo.com/~scs/C-faq/top.html" target="_top"><span><b class="command">C</b></span></a> function which will remove
     several flag arguments from the <a href="vm.html" title="33.2. The virtual machine"><tt class="literal">STACK</tt></a> and return the combined flag
     value</dd></dl></div><p>See <tt class="filename">modules/syscalls</tt> and other included
 modules for more examples and file <tt class="filename">modprep.lisp</tt>
 for full documentation.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>If you manipulate Lisp objects, you need to watch for
  <a href="gc-safety.html" title="31.5. The burden of garbage-collection upon the rest of CLISP">GC-safety</a>.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="clisp-h"></a>30.2.5.2. clisp.h</h4></div></div><div></div></div><p>If your module is written in <a href="http://www.eskimo.com/~scs/C-faq/top.html" target="_top"><span><b class="command">C</b></span></a>, you will probably want
 to <tt class="literal">#include "clisp.h"</tt> to access <a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a> objects.
 You will certainly need to read <a href="modules.html#clisp-h" title="30.2.5.2. clisp.h"><tt class="filename">#P"clisp.h"</tt></a> and the code in
 <a href="modules.html#included-modules" title="30.2.6. Modules included in the distribution.">included modules</a>, but here are
 some important hints that you will need to keep in mind:
</p><div class="itemizedlist"><ul type="disc"><li>Lisp objects have type <span class="type">object</span>.
 </li><li>Variables of this type are invalidated by
   <a href="gc-safety.html" title="31.5. The burden of garbage-collection upon the rest of CLISP">memory allocation</a> and must be saved
   on the <a href="vm.html" title="33.2. The virtual machine"><tt class="literal">STACK</tt></a> using macros <tt class="function">pushSTASH()</tt>,
   <tt class="function">popSTACK()</tt> and <tt class="function">skipSTACK()</tt>.
 </li><li>Access object slots using the
   approprate <tt class="function">TheFoo()</tt> macro, e.g.,
   <tt class="function">TheCons(my_cons)-&gt;Car</tt>, but first check the
   type with <tt class="function">consp()</tt>.</li><li>Arguments are passed on the <a href="vm.html" title="33.2. The virtual machine"><tt class="literal">STACK</tt></a>, as illustrated
   in the <a href="modules.html#modprep" title="30.2.5.1. Modprep">above example</a>.</li><li>Wrap your system calls in
   <tt class="literal">begin_system_call()</tt>/<tt class="literal">end_system_call()</tt>
   pairs. These macros, defined in <a href="modules.html#clisp-h" title="30.2.5.2. clisp.h"><tt class="filename">#P"clisp.h"</tt></a>, save and restore
   registers used by <a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a> which could be clobbered by a system call.
 </li></ul></div><p>
</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="exporting"></a>30.2.5.3. Exporting</h4></div></div><div></div></div><p>If your module uses <a href="dffi.html" title="30.3. Extensions-2.3. The Foreign Function Call Facility"><strong class="package">“<span class="quote">FFI</span>”</strong></a> to interface to a <a href="http://www.eskimo.com/~scs/C-faq/top.html" target="_top"><span><b class="command">C</b></span></a> library,
 you might want to make your module package
 <a href="pack-dict.html#make-pack" title="11.4.1. Function MAKE-PACKAGE">case-sensitive</a> and use
 <tt class="filename">exporting.lisp</tt> in the <a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a> distribution to
 make all <a href="dffi.html" title="30.3. Extensions-2.3. The Foreign Function Call Facility"><strong class="package">“<span class="quote">FFI</span>”</strong></a> forms export the symbols they define.
 See <tt class="filename">modules/netica</tt>
 and <tt class="filename">modules/bindings/*</tt> for examples.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="included-modules"></a>30.2.6. Modules included in the distribution.</h3></div></div><div></div></div><div class="toc"><dl><dt><span class="section"><a href="modules.html#matlab">30.2.6.1. Matlab Interface</a></span></dt><dt><span class="section"><a href="modules.html#netica">30.2.6.2. Netica Interface</a></span></dt><dt><span class="section"><a href="modules.html#dir-key">30.2.6.3. Directory Access</a></span></dt><dt><span class="section"><a href="modules.html#berkeley-db">30.2.6.4. Berkeley DB access.</a></span></dt><dt><span class="section"><a href="modules.html#regexp">30.2.6.5. <span><b class="command">CLISP</b></span> <strong class="package">“<span class="quote">REGEXP</span>”</strong> module</a></span></dt><dt><span class="section"><a href="modules.html#pcre">30.2.6.6. Perl Compatible Regular Expressions.</a></span></dt><dt><span class="section"><a href="modules.html#syscalls">30.2.6.7. System Calls</a></span></dt><dt><span class="section"><a href="modules.html#oracle">30.2.6.8. Oracle Interface</a></span></dt><dt><span class="section"><a href="modules.html#fastcgi">30.2.6.9. The FastCGI Interface</a></span></dt><dt><span class="section"><a href="modules.html#rawsock">30.2.6.10. Raw Socket Access.</a></span></dt></dl></div><p>The following modules come with the distribution of
<a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a>:</p><div class="variablelist"><dl><dt>bindings</dt><dd><p>Call the operating system functions from <a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a>.
    The following platforms are supported:
   </p><div class="itemizedlist"><ul type="disc"><li><a href="http://www.linux.org/" target="_top"><strong>Linux</strong></a>/<a href="http://www.gnu.org" target="_top">GNU</a> <a href="http://www.gnu.org/software/libc/" target="_top">libc</a></li><li><a href="http://www.willows.com/" target="_top"><strong>Win32</strong></a></li></ul></div></dd><dt><a href="http://www.cliki.net/CLX" target="_top"><span><b class="command">CLX</b></span></a></dt><dd><p>Call
    <a href="http://www.the-labs.com/X11/XLib-Manual/" target="_top">Xlib</a>
    functions from <a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a>.  Two implementations are supplied:
   </p><div class="itemizedlist"><ul type="disc"><li>mit-clx, from MIT
     <a href="ftp://ftp.x.org/R5contrib/CLX.R5.02.tar.Z" target="_top">ftp://ftp.x.org/R5contrib/CLX.R5.02.tar.Z</a>
     - the standard implementation</li><li>new-clx, by <span class="author"><span class="firstname">Gilbert</span> <span class="surname">Baumann</span></span>
      - faster, with additional features, but not quite complete yet.
    </li></ul></div></dd><dt><a href="modules.html#oracle" title="30.2.6.8. Oracle Interface">oracle</a></dt><dd>Access
    <a href="http://www.oracle.com/" target="_top">Oracle</a> from <a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a>;
    by <span class="author"><span class="firstname">John</span> <span class="surname">Hinsdale</span></span>.</dd><dt><a href="modules.html#fastcgi" title="30.2.6.9. The FastCGI Interface">fastcgi</a></dt><dd>Access
    <a href="http://www.fastcgi.com/" target="_top">FastCGI</a> from <a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a>;
    by <span class="author"><span class="firstname">John</span> <span class="surname">Hinsdale</span></span>.</dd><dt><a href="modules.html#matlab" title="30.2.6.1. Matlab Interface">matlab</a></dt><dd>Do matrix computations via
    <a href="http://www.mathworks.com/products/matlab/" target="_top">MATLAB</a>.
 </dd><dt><a href="modules.html#netica" title="30.2.6.2. Netica Interface">netica</a></dt><dd>Work with Bayesian belief networks and influence
    diagrams using
    <a href="http://norsys.com/netica_c_api.htm" target="_top">Netica</a>.
 </dd><dt>postgresql</dt><dd>Access
    <a href="http://www.PostgreSQL.org/" target="_top">PostgreSQL</a> from <a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a>.
  </dd><dt>queens</dt><dd>Compute the number of solutions to the n-queens
    problem on a n*n checkboard (a toy example for the users to
    explore).</dd><dt><a href="modules.html#dir-key" title="30.2.6.3. Directory Access">dirkey</a></dt><dd>Directory Access</dd><dt><a href="modules.html#berkeley-db" title="30.2.6.4. Berkeley DB access.">berkeley-db</a></dt><dd><a href="http://www.sleepycat.com/docs/index.html" target="_top">Berkeley DB from Sleepycat Software</a>
    interface</dd><dt><a href="modules.html#regexp" title="30.2.6.5. CLISP “REGEXP” module">regexp</a></dt><dd>The <a href="regexp.html" target="_top">POSIX Regular
   Expressions</a> matching, compiling, executing.
 </dd><dt><a href="modules.html#pcre" title="30.2.6.6. Perl Compatible Regular Expressions.">pcre</a></dt><dd>The <a href="http://www.pcre.org/" target="_top">Perl
     Compatible Regular Expressions</a> matching, compiling,
    executing.</dd><dt><a href="modules.html#syscalls" title="30.2.6.7. System Calls">syscalls</a></dt><dd>Use some system calls in a platform-independent way.
 </dd><dt><a href="wildcard.html" target="_top">wildcard</a></dt><dd>Shell (<a href="http://www.opengroup.org/onlinepubs/007904975/utilities/sh.html" target="_top"><span><b class="command">/bin/sh</b></span></a>) globbing</dd><dt><a href="modules.html#rawsock" title="30.2.6.10. Raw Socket Access.">rawsock</a></dt><dd>Raw socket access.
 </dd></dl></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="matlab"></a>30.2.6.1. Matlab Interface</h4></div></div><div></div></div><p>This is an interface to the
 <a href="http://www.mathworks.com/access/helpdesk/help/techdoc/apiref/apiref.shtml" target="_top">Matlab C API</a>.
 The package <strong class="package">“<span class="quote">MATLAB</span>”</strong> is
 <a href="pack-dict.html#make-pack" title="11.4.1. Function MAKE-PACKAGE">case-sensitive</a>, so you would write
 <tt class="sexp">(matlab:engOpen ...)</tt>
 when you need to call
 <a href="http://www.mathworks.com/access/helpdesk/help/techdoc/apiref/engopen.html" target="_top"><tt class="function">engOpen()</tt></a>.
</p><p>Additionally, some higher level functionality is available
 (see <tt class="filename">modules/matlab/demo.lisp</tt> for sample
 usage)</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="netica"></a>30.2.6.2. Netica Interface</h4></div></div><div></div></div><p>This is an interface to the
 <a href="http://norsys.com/netica_c_api.htm" target="_top">Netica C API</a>.
 The package <strong class="package">“<span class="quote">NETICA</span>”</strong> is
 <a href="pack-dict.html#make-pack" title="11.4.1. Function MAKE-PACKAGE">case-sensitive</a>, you would write
 <tt class="sexp">(netica:GetNodeExpectedUtils_bn ...)</tt>
 when you need to call
 <a href="http://norsys.com/onLineAPIManual/functions/GetNodeExpectedUtils_bn.html" target="_top"><tt class="function">GetNodeExpectedUtils_bn()</tt></a>
</p><p>Additionally, some higher level functionality is available
 (see <tt class="filename">modules/netica/demo.lisp</tt> for a sample
 usage):</p><div class="variablelist"><dl><dt><tt class="sexp">(netica:start-netica <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a>
   :license :verbose)</tt></dt><dd>Call
   <a href="http://norsys.com/onLineAPIManual/functions/NewNeticaEnviron_ns.html" target="_top"><tt class="function">NewNeticaEnviron_ns()</tt></a> and
   <a href="http://norsys.com/onLineAPIManual/functions/InitNetica_bn.html" target="_top"><tt class="function">InitNetica_bn()</tt></a>
   and print some statistics; initialize
   <tt class="varname">netica:*env*</tt>.</dd><dt><tt class="sexp">(netica:check-errors <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a>
   :env :clear :severity)</tt></dt><dd>Show and, optionally,
   <a href="http://norsys.com/onLineAPIManual/functions/ClearError_ns.html" target="_top">clear</a>, the errors of
   the given <a href="http://norsys.com/onLineAPIManual/functions/ErrorSeverity_ns.html" target="_top">severity</a>
   and above.  You should call this function
   after <span class="emphasis"><em>every</em></span> call to a Netica function.
   Every wrapper function in this list calls it, so you do <span class="emphasis"><em>not</em></span> need to
   call it after a call to a wrapper function.
</dd><dt><tt class="sexp">(netica:error-message
   error)</tt></dt><dd>Convert netica error to a <a href="http://www.lisp.org/HyperSpec/Body/syscla_string.html" target="_top"><tt class="classname">STRING</tt></a> containing
   <a href="http://norsys.com/onLineAPIManual/functions/ErrorCategory_ns.html" target="_top">error category</a>,
   <a href="http://norsys.com/onLineAPIManual/functions/ErrorSeverity_ns.html" target="_top">error severity</a>,
   <a href="http://norsys.com/onLineAPIManual/functions/ErrorNumber_ns.html" target="_top">error number</a>,
   <a href="http://norsys.com/onLineAPIManual/functions/ErrorMessage_ns.html" target="_top">error message</a>.
</dd><dt><tt class="sexp">(netica:close-netica <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a>
   :env :verbose)</tt></dt><dd>Terminate the netica session.
   Sets <tt class="varname">netica:*env*</tt> to <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a> when it was closed.
</dd><dt><tt class="sexp">(netica:make-net <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a> :name
   :comment :title :env :verbose)</tt></dt><dd>Make a <a href="http://norsys.com/onLineAPIManual/functions/NewNet_bn.html" target="_top">new
    network</a> with a given name,
   <a href="http://norsys.com/onLineAPIManual/functions/SetNetTitle_bn.html" target="_top">title</a> and
   <a href="http://norsys.com/onLineAPIManual/functions/SetNetComment_bn.html" target="_top">comment</a>
   and return it.</dd><dt><tt class="sexp">(netica:net-info net)</tt></dt><dd>Print some information about the net
   (<a href="http://norsys.com/onLineAPIManual/functions/GetNetName_bn.html" target="_top">name</a>,
    <a href="http://norsys.com/onLineAPIManual/functions/GetNetTitle_bn.html" target="_top">title</a>,
    <a href="http://norsys.com/onLineAPIManual/functions/GetNetComment_bn.html" target="_top">comment</a>,
    <a href="http://norsys.com/onLineAPIManual/functions/GetNetFileName_bn.html" target="_top">file name</a> and
    <a href="http://norsys.com/onLineAPIManual/functions/GetNetNodes_bn.html" target="_top">nodes</a>).
</dd><dt><tt class="sexp">(netica:make-node <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a>
   :name :net :kind :levels :states :num-states :title :comment :parents
   :cpt :x :y :env :verbose)</tt></dt><dd>Make a <a href="http://norsys.com/onLineAPIManual/functions/NewNode_bn.html" target="_top">new
    node</a> with the given name and many other parameters.
</dd><dt><tt class="sexp">(netica:node-info node
   <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a> :header)</tt></dt><dd>Print some information about the node, preceded by
   the header.</dd><dt><tt class="sexp">(netica:get-beliefs node
   <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a> :env :verbose)</tt></dt><dd><a href="http://norsys.com/onLineAPIManual/functions/GetNodeBeliefs_bn.html" target="_top">Get
    the belief vector</a> for the node.
</dd><dt><tt class="sexp">(netica:enter-finding net node
   state <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a> :env :verbose)</tt></dt><dd><a href="http://norsys.com/onLineAPIManual/functions/EnterFinding_bn.html" target="_top">Enter a
    finding</a> by
   <a href="http://norsys.com/onLineAPIManual/functions/NodeNamed_bn.html" target="_top">node</a>
   and <a href="http://norsys.com/onLineAPIManual/functions/StateNamed_bn.html" target="_top">state</a>
   names.</dd><dt><tt class="sexp">(netica:save-net net <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a>
   :file :env :verbose)</tt></dt><dd><a href="http://norsys.com/onLineAPIManual/functions/WriteNet_bn.html" target="_top">Write</a>
   a network to a file.</dd><dt><tt class="sexp">(netica:read-net file <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a>
   :env :verbose)</tt></dt><dd><a href="http://norsys.com/onLineAPIManual/functions/ReadNet_bn.html" target="_top">Read</a>
   a network from a file.</dd><dt><tt class="sexp">(netica:with-open-dne-file (var
   file <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;REST</tt></a> opts) <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-4.html" target="_top"><tt class="literal">&amp;BODY</tt></a> body)</tt></dt><dd><a href="http://norsys.com/onLineAPIManual/functions/NewStreamFile_ns.html" target="_top">Open
    a netica stream</a>, execute <i class="replaceable"><tt>body</tt></i>,
   <a href="http://norsys.com/onLineAPIManual/functions/DeleteStream_ns.html" target="_top">close the stream</a>
   - just like <a href="http://www.lisp.org/HyperSpec/Body/mac_with-open-file.html" target="_top"><tt class="function">WITH-OPEN-FILE</tt></a>.</dd><dt><tt class="varname">netica:*verbose*</tt></dt><dd>The log <a href="http://www.lisp.org/HyperSpec/Body/syscla_stream.html" target="_top"><tt class="classname">STREAM</tt></a> or <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a>; the default value for
   the <tt class="literal">:VERBOSE</tt> argument.
</dd><dt><tt class="varname">netica:*license*</tt></dt><dd>The license key provided by
   <a href="http://norsys.com/" target="_top">Norsys</a>; the default value
   for the <tt class="literal">:LICENSE</tt> argument.
</dd><dt><tt class="varname">netica:*env*</tt></dt><dd>The Netica environment object; the default value
   for the <tt class="literal">:ENV</tt> argument.
</dd></dl></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="dir-key"></a>30.2.6.3. Directory Access</h4></div></div><div></div></div><p>This module provides some directory access from lisp,
 in package <a href="modules.html#dir-key" title="30.2.6.3. Directory Access"><strong class="package">“<span class="quote">LDAP</span>”</strong></a>.  3 types of directory keys
 may exist, depending on the compilation environment.</p><div class="variablelist"><a id="dir-key-type"></a><p class="title"><b>valid directory key types</b></p><dl><dt>:win32</dt><dd><a href="http://www.willows.com/" target="_top"><strong>Win32</strong></a> registry access
  </dd><dt>:gnome</dt><dd><a href="http://developer.gnome.org/doc/API/libgnome/gnome-gnome-config.html" target="_top">gnome-config</a> access
  </dd><dt>:ldap</dt><dd>LDAP interface via
   <a href="http://www.openldap.org" target="_top">OpenLDAP</a> or compatible
  </dd></dl></div><p>The following functions and macros are exported (please note that
these features are experimental and the API may be modified in the
future).</p><div class="variablelist"><dl><dt><a id="dir-key-open"></a><tt class="sexp">(<a href="modules.html#dir-key-open"><tt class="function">LDAP:DIR-KEY-OPEN</tt></a>
   <i class="replaceable"><tt>dkey</tt></i> <i class="replaceable"><tt>pathname</tt></i> <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a> (<tt class="constant">:DIRECTION</tt> <tt class="constant">:INPUT</tt>)
   <tt class="constant">:IF-DOES-NOT-EXIST</tt>)</tt></dt><dd>Open the directory key under <i class="replaceable"><tt>dkey</tt></i>, which should
   be either an open directory key or a valid <a href="modules.html#dir-key-type">directory key type</a>.
   The meaning of the <tt class="constant">:DIRECTION</tt> and <tt class="constant">:IF-DOES-NOT-EXIST</tt> keyword
   arguments is the same as for <a href="http://www.lisp.org/HyperSpec/Body/fun_open.html" target="_top"><tt class="function">OPEN</tt></a>.</dd><dt><a id="dir-key-close"></a><tt class="sexp">(<a href="modules.html#dir-key-close"><tt class="function">LDAP:DIR-KEY-CLOSE</tt></a> <i class="replaceable"><tt>dkey</tt></i>)</tt></dt><dd>Close the directory key.  The preferred way is to
   use the <a href="modules.html#with-dir-key-open"><tt class="function">LDAP:WITH-DIR-KEY-OPEN</tt></a> macro.</dd><dt><a id="with-dir-key-open"></a><tt class="sexp">(<a href="modules.html#with-dir-key-open"><tt class="function">LDAP:WITH-DIR-KEY-OPEN</tt></a> (<i class="replaceable"><tt>variable</tt></i> <i class="replaceable"><tt>dkey</tt></i> <i class="replaceable"><tt>pathname</tt></i> <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;REST</tt></a>
    {<i class="replaceable"><tt>option</tt></i>}*) <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-4.html" target="_top"><tt class="literal">&amp;BODY</tt></a> <i class="replaceable"><tt>body</tt></i>)</tt></dt><dd>Open the directory key (by calling <a href="modules.html#dir-key-open"><tt class="function">LDAP:DIR-KEY-OPEN</tt></a>
   on <i class="replaceable"><tt>dkey</tt></i>, <i class="replaceable"><tt>pathname</tt></i> and <i class="replaceable"><tt>option</tt></i>s), bind it to <i class="replaceable"><tt>variable</tt></i>,
   execute <i class="replaceable"><tt>body</tt></i>, then close it with <a href="modules.html#dir-key-close"><tt class="function">LDAP:DIR-KEY-CLOSE</tt></a>.
 </dd><dt><tt class="sexp">(<tt class="function">LDAP:DIR-KEY-TYPE</tt> <i class="replaceable"><tt>dkey</tt></i>)</tt></dt><dd>Return the <a href="modules.html#dir-key-type">directory key type</a> of the directory key
  </dd><dt><tt class="sexp">(<tt class="function">LDAP:DIR-KEY-PATH</tt>
                <i class="replaceable"><tt>dkey</tt></i>)</tt></dt><dd>Return the path of this directory key, which is the
   <i class="replaceable"><tt>pathname</tt></i> argument of <a href="modules.html#dir-key-open"><tt class="function">LDAP:DIR-KEY-OPEN</tt></a> if <i class="replaceable"><tt>dkey</tt></i> was a <a href="modules.html#dir-key-type">directory key type</a> or the
   concatenation of the <i class="replaceable"><tt>pathname</tt></i> argument and the
   <tt class="function">ldap:dir-key-path</tt> of <i class="replaceable"><tt>dkey</tt></i>.
   </dd><dt><tt class="sexp">(<tt class="function">LDAP:DIR-KEY-DIRECTION</tt> <i class="replaceable"><tt>dkey</tt></i>)</tt></dt><dd>One of <tt class="constant">:INPUT</tt>, <tt class="constant">:OUTPUT</tt> and <tt class="constant">:IO</tt>, indicating
   the permitted operation on this key and its derivatives.
   </dd><dt><tt class="sexp">(<tt class="function">LDAP:DIR-KEY-CLOSED-P</tt> <i class="replaceable"><tt>dkey</tt></i>)</tt></dt><dd>Check whether the key has been closed.
   It is not an error to close a closed key.
   </dd><dt><tt class="sexp">(<tt class="function">LDAP:DIR-KEY-SUBKEY-DELETE</tt>
     <i class="replaceable"><tt>dkey</tt></i> <i class="replaceable"><tt>subkey</tt></i>)</tt>
   <tt class="sexp">(<tt class="function">LDAP:DIR-KEY-VALUE-DELETE</tt>
     <i class="replaceable"><tt>dkey</tt></i> <i class="replaceable"><tt>attribute</tt></i>)</tt></dt><dd>Delete the specified subkey or attribute.
  </dd><dt><tt class="sexp">(<tt class="function">LDAP:DIR-KEY-SUBKEY</tt> <i class="replaceable"><tt>dkey</tt></i>)</tt>
  <tt class="sexp">(<tt class="function">LDAP:DIR-KEY-ATTRIBUTES</tt>
                <i class="replaceable"><tt>dkey</tt></i>)</tt></dt><dd>Return the list of the subkeys or attributes.
  </dd><dt><tt class="sexp">(<tt class="function">LDAP:DIR-KEY-VALUE</tt> <i class="replaceable"><tt>dkey</tt></i>
    <i class="replaceable"><tt>attribute</tt></i> <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;OPTIONAL</tt></a>
    <i class="replaceable"><tt>default</tt></i>)</tt></dt><dd>Return the value of the specified attribute,
   similar to <a href="http://www.lisp.org/HyperSpec/Body/acc_gethash.html" target="_top"><tt class="function">GETHASH</tt></a> and <a href="http://www.lisp.org/HyperSpec/Body/mac_setfcm_psetf.html" target="_top"><tt class="function">SETF</tt></a>able just like <a href="http://www.lisp.org/HyperSpec/Body/acc_gethash.html" target="_top"><tt class="function">GETHASH</tt></a>.
   </dd><dt><tt class="sexp">(<tt class="function">LDAP:DIR-KEY-INFO</tt> <i class="replaceable"><tt>dkey</tt></i>)</tt></dt><dd>Return some information about the directory key.
   This is highly platform-dependent and will probably be removed or
   replaced or modified in the future.</dd><dt><a id="with-dir-key-search"></a><tt class="sexp">(<a href="modules.html#with-dir-key-search"><tt class="function">LDAP:WITH-DIR-KEY-SEARCH</tt></a> (<i class="replaceable"><tt>key-iter</tt></i>
                 <i class="replaceable"><tt>atribute-iter</tt></i>
                 <i class="replaceable"><tt>dkey</tt></i> <i class="replaceable"><tt>pathname</tt></i> <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a> <tt class="constant">:scope</tt>)
                 <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-4.html" target="_top"><tt class="literal">&amp;BODY</tt></a> <i class="replaceable"><tt>body</tt></i>)</tt></dt><dd><p>This is the main way to iterate over the subtree
   under the key <i class="replaceable"><tt>dkey</tt></i>+<i class="replaceable"><tt>pathname</tt></i>.</p><p><i class="replaceable"><tt>key-iter</tt></i> is a non-<a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a> symbol
    and is bound via <a href="http://www.lisp.org/HyperSpec/Body/speope_fletcm_scm_macrolet.html" target="_top"><tt class="function">MACROLET</tt></a> to a macro, each call of which returns
    the next subkey.</p><p><i class="replaceable"><tt>atribute-iter</tt></i> is a symbol and is
    bound, when non-<a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a>, to a macro, each call of which returns two
   values - the next attribute and its value.</p><p>The <tt class="constant">:scope</tt> keyword argument specifies the
    scope of the search and can be
   </p><div class="variablelist"><dl><dt><tt class="constant">:self</tt></dt><dd>iterate over the key itself
     </dd><dt><tt class="constant">:level</tt></dt><dd>iterate over the children of the key
     </dd><dt><tt class="constant">:tree</tt></dt><dd>iterate over the subtree
     </dd></dl></div><p><a href="modules.html#with-dir-key-search"><tt class="function">LDAP:WITH-DIR-KEY-SEARCH</tt></a> is used to implement
    <tt class="function">LDAP:DIR-KEY-VALUES</tt>,
    <tt class="function">LDAP:DIR-KEY-CHILDREN</tt> and
    <tt class="function">LDAP:DIR-KEY-DUMP-TREE</tt> in
    <tt class="filename">dirkey.lisp</tt>.
    </p></dd></dl></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="berkeley-db"></a>30.2.6.4. Berkeley DB access.</h4></div></div><div></div></div><div class="toc"><dl><dt><span class="section"><a href="modules.html#bdb-db-environment">30.2.6.4.1. Database Environment</a></span></dt><dt><span class="section"><a href="modules.html#bdb-environment-config">30.2.6.4.2. Environment Configuration</a></span></dt><dt><span class="section"><a href="modules.html#bdb-operations">30.2.6.4.3. Database Operations</a></span></dt><dt><span class="section"><a href="modules.html#bdb-db-config">30.2.6.4.4. Database Configuration</a></span></dt><dt><span class="section"><a href="modules.html#bdb-bt-rn-config">30.2.6.4.5. Btree/Recno Configuration</a></span></dt><dt><span class="section"><a href="modules.html#bdb-hash-q-config">30.2.6.4.6. Hash/Queue Configuration</a></span></dt><dt><span class="section"><a href="modules.html#bdb-cursor">30.2.6.4.7. Database Cursor Operations</a></span></dt><dt><span class="section"><a href="modules.html#bdb-lock">30.2.6.4.8. Lock Subsystem</a></span></dt><dt><span class="section"><a href="modules.html#bdb-log">30.2.6.4.9. Log Subsystem</a></span></dt><dt><span class="section"><a href="modules.html#bdb-log-cursor">30.2.6.4.10. Log Cursor Operations</a></span></dt><dt><span class="section"><a href="modules.html#bdb-log-seq">30.2.6.4.11. Log Sequence Numbers</a></span></dt><dt><span class="section"><a href="modules.html#bdb-mem-pool">30.2.6.4.12. Memory Pool Subsystem</a></span></dt><dt><span class="section"><a href="modules.html#bdb-transaction">30.2.6.4.13. Transaction Subsystem</a></span></dt><dt><span class="section"><a href="modules.html#bdb-replication">30.2.6.4.14. Replication</a></span></dt></dl></div><p>This interface to <a href="http://www.sleepycat.com/docs/index.html" target="_top">Berkeley DB from Sleepycat Software</a> exports almost all
 functions in the official <a href="http://www.eskimo.com/~scs/C-faq/top.html" target="_top"><span><b class="command">C</b></span></a> API.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="bdb-db-environment"></a>30.2.6.4.1. Database Environment</h5></div></div><div></div></div><div class="variablelist"><dl><dt><tt class="sexp">(BDB:DB-VERSION)</tt></dt><dd>Return version information as 4 values: descriptive
    <a href="http://www.lisp.org/HyperSpec/Body/syscla_string.html" target="_top"><tt class="classname">STRING</tt></a> and 3 <a href="http://www.lisp.org/HyperSpec/Body/typ_fixnum.html" target="_top"><tt class="classname">FIXNUM</tt></a>s: major, minor and patch number (<a href="http://www.sleepycat.com/docs/api_c/env_version.html" target="_top"><tt class="function">db_version</tt></a>).
 </dd><dt><tt class="sexp">(BDB:ENV-CREATE <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a>
    :PASSWORD :ENCRYPT :HOST :CLIENT-TIMEOUT :SERVER-TIMEOUT)</tt></dt><dd>Create an environment handle (<a href="http://www.sleepycat.com/docs/api_c/env_create.html" target="_top"><tt class="function">db_env_create</tt></a>),
    possibly connecting to a remote host (<a href="http://www.sleepycat.com/docs/api_c/env_set_rpc_server.html" target="_top"><tt class="function">DB_ENV-&gt;set_rpc_server</tt></a>) and
    possibly using encryption with password (<a href="http://www.sleepycat.com/docs/api_c/env_set_encrypt.html" target="_top"><tt class="function">DB_ENV-&gt;set_encrypt</tt></a>).
 </dd><dt><tt class="sexp">(BDB:ENV-CLOSE dbe)</tt></dt><dd>Close an environment (<a href="http://www.sleepycat.com/docs/api_c/env_close.html" target="_top"><tt class="function">DB_ENV-&gt;close</tt></a>).
 </dd><dt><tt class="sexp">(BDB:DBREMOVE dbe file
    database <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a> :TRANSACTION :AUTO-COMMIT)</tt></dt><dd>Remove a database (<a href="http://www.sleepycat.com/docs/api_c/env_dbremove.html" target="_top"><tt class="function">DB_ENV-&gt;dbremove</tt></a>).
 </dd><dt><tt class="sexp">(BDB:DBREMOVE dbe file
    database newname <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a> :TRANSACTION :AUTO-COMMIT)</tt></dt><dd>Rename a database (<a href="http://www.sleepycat.com/docs/api_c/env_dbrename.html" target="_top"><tt class="function">DB_ENV-&gt;dbrename</tt></a>).
 </dd><dt><tt class="sexp">(BDB:ENV-OPEN dbe <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a>
    :HOME :JOIN :INIT-CDB :INIT-LOCK :INIT-LOG :INIT-MPOOL :INIT-TXN
    :RECOVER :RECOVER-FATAL :USE-ENVIRON :USE-ENVIRON-ROOT :CREATE
    :LOCKDOWN :PRIVATE :SYSTEM-MEM :THREAD :MODE)</tt></dt><dd>Open an environment (<a href="http://www.sleepycat.com/docs/api_c/env_open.html" target="_top"><tt class="function">DB_ENV-&gt;open</tt></a>).
 </dd><dt><tt class="sexp">(BDB:ENV-REMOVE dbe <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a>
    :HOME :FORCE :USE-ENVIRON :USE-ENVIRON-ROOT)</tt></dt><dd>Destroy an environment (<a href="http://www.sleepycat.com/docs/api_c/env_remove.html" target="_top"><tt class="function">DB_ENV-&gt;remove</tt></a>).
 </dd></dl></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="bdb-environment-config"></a>30.2.6.4.2. Environment Configuration</h5></div></div><div></div></div><div class="variablelist"><dl><dt><tt class="sexp">(BDB:ENV-SET-OPTIONS dbe
   <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a> :DATA-DIR :TMP-DIR :AUTO-COMMIT :CDB-ALLDB :DIRECT-DB
   :DIRECT-LOG :NOLOCKING :NOMMAP :NOPANIC :OVERWRITE :PANIC-ENVIRONMENT
   :REGION-INIT :TXN-NOSYNC :TXN-WRITE-NOSYNC :YIELDCPU :VERB-CHKPOINT
   :VERB-DEADLOCK :VERB-RECOVERY :VERB-REPLICATION :VERB-WAITSFOR
   :VERBOSE)</tt></dt><dd>Set some environment options using <a href="http://www.sleepycat.com/docs/api_c/env_set_flags.html" target="_top"><tt class="function">DB_ENV-&gt;set_flags</tt></a>,
   <a href="http://www.sleepycat.com/docs/api_c/env_set_verbose.html" target="_top"><tt class="function">DB_ENV-&gt;set_verbose</tt></a>, <a href="http://www.sleepycat.com/docs/api_c/env_set_tmp_dir.html" target="_top"><tt class="function">DB_ENV-&gt;set_tmp_dir</tt></a> and <a href="http://www.sleepycat.com/docs/api_c/env_set_data_dir.html" target="_top"><tt class="function">DB_ENV-&gt;set_data_dir</tt></a>.
</dd></dl></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="bdb-operations"></a>30.2.6.4.3. Database Operations</h5></div></div><div></div></div>
<!--DB->associate Associate a secondary index DB->err Error message with error string DB->errx Error message DB->join Perform a database join on cursors DB->key_range Return estimate of key location DB->verify Verify/salvage a database-->
<div class="variablelist"><dl><dt><tt class="sexp">(BDB:DB-CREATE dbe <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a>
   :XA)</tt></dt><dd>Create a database handle (<a href="http://www.sleepycat.com/docs/api_c/db_create.html" target="_top"><tt class="function">db_create</tt></a>).
</dd><dt><tt class="sexp">(BDB:DB-CLOSE dbe <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a>
   :NOSYNC)</tt></dt><dd>Close a database (<a href="http://www.sleepycat.com/docs/api_c/db_close.html" target="_top"><tt class="function">DB-&gt;close</tt></a>).
</dd><dt><tt class="sexp">(BDB:DB-DEL dbe key <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a>
   :TRANSACTION :AUTO-COMMIT)</tt></dt><dd>Delete items from a database (<a href="http://www.sleepycat.com/docs/api_c/db_del.html" target="_top"><tt class="function">DB-&gt;del</tt></a>).
</dd><dt><tt class="sexp">(BDB:DB-FD db)</tt></dt><dd>Return a file descriptor from a database (<a href="http://www.sleepycat.com/docs/api_c/db_fd.html" target="_top"><tt class="function">DB-&gt;fd</tt></a>).
</dd><dt><tt class="sexp">(BDB:DB-GET db key <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a>
   :CONSUME :CONSUME-WAIT :DIRTY-READ :RMW :TRANSACTION)</tt></dt><dd>Get items from a database (<a href="http://www.sleepycat.com/docs/api_c/db_get.html" target="_top"><tt class="function">DB-&gt;get</tt></a>).
</dd><dt><tt class="sexp">(BDB:DB-PUT db key val
   <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a> :APPEND :NODUPDATA :NOOVERWRITE :AUTO-COMMIT
   :TRANSACTION)</tt></dt><dd>Store items into a database (<a href="http://www.sleepycat.com/docs/api_c/db_put.html" target="_top"><tt class="function">DB-&gt;put</tt></a>).
</dd><dt><tt class="sexp">(BDB:DB-STAT db <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a>
   :FAST-STAT)</tt></dt><dd>Return database statistics (<a href="http://www.sleepycat.com/docs/api_c/db_get_byteswapped.html" target="_top"><tt class="function">DB-&gt;get_byteswapped</tt></a>,
   <a href="http://www.sleepycat.com/docs/api_c/db_get_type.html" target="_top"><tt class="function">DB-&gt;get_type</tt></a>, <a href="http://www.sleepycat.com/docs/api_c/db_stat.html" target="_top"><tt class="function">DB-&gt;stat</tt></a>).</dd><dt><tt class="sexp">(BDB:DB-OPEN db file <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a>
   :DATABASE :TYPE :MODE :CREATE :DIRTY-READ :EXCL :NOMMAP :RDONLY
   :THREAD :TRUNCATE :AUTO-COMMIT :TRANSACTION)</tt></dt><dd>Open a database (<a href="http://www.sleepycat.com/docs/api_c/db_open.html" target="_top"><tt class="function">DB-&gt;open</tt></a>).
</dd><dt><tt class="sexp">(BDB:DB-SYNC db)</tt></dt><dd>Flush a database to stable storage (<a href="http://www.sleepycat.com/docs/api_c/db_sync.html" target="_top"><tt class="function">DB-&gt;sync</tt></a>).
</dd><dt><tt class="sexp">(BDB:DB-TRUNCATE db <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a>
   :TRANSACTION :AUTO-COMMIT)</tt></dt><dd>Empty a database (<a href="http://www.sleepycat.com/docs/api_c/db_truncate.html" target="_top"><tt class="function">DB-&gt;truncate</tt></a>).
</dd><dt><tt class="sexp">(BDB:DB-UPGRADE, db file
   <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a> :DUPSORT)</tt></dt><dd>Upgrade a database (<a href="http://www.sleepycat.com/docs/api_c/db_upgrade.html" target="_top"><tt class="function">DB-&gt;upgrade</tt></a>).
</dd><dt><tt class="sexp">(BDB:DB-RENAME db file database
   newname)</tt></dt><dd>Rename a database (<a href="http://www.sleepycat.com/docs/api_c/db_rename.html" target="_top"><tt class="function">DB-&gt;rename</tt></a>).
</dd><dt><tt class="sexp">(BDB:DB-REMOVE db file
   database)</tt></dt><dd>Remove a database (<a href="http://www.sleepycat.com/docs/api_c/db_remove.html" target="_top"><tt class="function">DB-&gt;remove</tt></a>).
</dd></dl></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="bdb-db-config"></a>30.2.6.4.4. Database Configuration</h5></div></div><div></div></div>
<!--DB->set_alloc Set local space allocation functions DB->set_cache_priority Set the database cache priority DB->set_cachesize Set the database cache size DB->set_dup_compare Set a duplicate comparison function DB->set_encrypt Set the database cryptographic key DB->set_errcall Set error message callback DB->set_errfile Set error message FILE DB->set_errpfx Set error message prefix DB->set_feedback Set feedback callback DB->set_flags General database configuration DB->set_lorder Set the database byte order DB->set_pagesize Set the underlying database page size DB->set_paniccall Set panic callback-->
<div class="variablelist"><dl><dt><tt class="sexp">()</tt></dt><dd></dd></dl></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="bdb-bt-rn-config"></a>30.2.6.4.5. Btree/Recno Configuration</h5></div></div><div></div></div>
<!--DB->set_append_recno Set record append callback DB->set_bt_compare Set a Btree comparison function DB->set_bt_minkey Set the minimum number of keys per Btree page DB->set_bt_prefix Set a Btree prefix comparison function DB->set_re_delim Set the variable-length record delimiter DB->set_re_len Set the fixed-length record length DB->set_re_pad Set the fixed-length record pad byte DB->set_re_source Set the backing Recno text file-->
<div class="variablelist"><dl><dt><tt class="sexp">()</tt></dt><dd></dd></dl></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="bdb-hash-q-config"></a>30.2.6.4.6. Hash/Queue Configuration</h5></div></div><div></div></div>
<!--DB->set_h_ffactor Set the Hash table density DB->set_h_hash Set a hashing function DB->set_h_nelem Set the Hash table size DB->set_q_extentsize Set Queue database extent size-->
<div class="variablelist"><dl><dt><tt class="sexp">()</tt></dt><dd></dd></dl></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="bdb-cursor"></a>30.2.6.4.7. Database Cursor Operations</h5></div></div><div></div></div>
<!--DB->cursor Create a cursor handle DBcursor->c_close Close a cursor DBcursor->c_count Return count of duplicates DBcursor->c_del Delete by cursor DBcursor->c_dup Duplicate a cursor DBcursor->c_get, DBcursor->c_pget Retrieve by cursor DBcursor->c_put Store by cursor-->
<div class="variablelist"><dl><dt><tt class="sexp">()</tt></dt><dd></dd></dl></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="bdb-lock"></a>30.2.6.4.8. Lock Subsystem</h5></div></div><div></div></div>
<!--DB_ENV->set_lk_conflicts Set lock conflicts matrix DB_ENV->set_lk_detect Set automatic deadlock detection DB_ENV->set_lk_max_lockers Set maximum number of lockers DB_ENV->set_lk_max_locks Set maximum number of locks DB_ENV->set_lk_max_objects Set maximum number of lock objects DB_ENV->lock_detect Perform deadlock detection DB_ENV->lock_get Acquire a lock DB_ENV->lock_id Acquire a locker ID DB_ENV->lock_id_free Release a locker ID DB_ENV->lock_put Release a lock DB_ENV->lock_stat Return lock subsystem statistics DB_ENV->lock_vec Acquire/release locks-->
<div class="variablelist"><dl><dt><tt class="sexp">()</tt></dt><dd></dd></dl></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="bdb-log"></a>30.2.6.4.9. Log Subsystem</h5></div></div><div></div></div>
<!--DB_ENV->set_lg_bsize Set log buffer size DB_ENV->set_lg_dir Set the environment logging directory DB_ENV->set_lg_max Set log file size DB_ENV->set_lg_regionmax Set logging region size DB_ENV->log_archive List log and database files DB_ENV->log_file Map Log Sequence Numbers to log files DB_ENV->log_flush Flush log records DB_ENV->log_put Write a log record DB_ENV->log_stat Return log subsystem statistics-->
<div class="variablelist"><dl><dt><tt class="sexp">()</tt></dt><dd></dd></dl></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="bdb-log-cursor"></a>30.2.6.4.10. Log Cursor Operations</h5></div></div><div></div></div>
<!--DB_ENV->log_cursor Create a log cursor handle DB_LOGC->close Close a log cursor DB_LOGC->get Retrieve a log record-->
<div class="variablelist"><dl><dt><tt class="sexp">()</tt></dt><dd></dd></dl></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="bdb-log-seq"></a>30.2.6.4.11. Log Sequence Numbers</h5></div></div><div></div></div>
<!--log_compare Compare two Log Sequence Numbers-->
<div class="variablelist"><dl><dt><tt class="sexp">()</tt></dt><dd></dd></dl></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="bdb-mem-pool"></a>30.2.6.4.12. Memory Pool Subsystem</h5></div></div><div></div></div>
<!--DB_ENV->set_cachesize Set the environment cache size DB_ENV->set_mp_mmapsize Set maximum mapped-in database file size DB_ENV->memp_register Register input/output functions for a file in a memory pool DB_ENV->memp_stat Return memory pool statistics DB_ENV->memp_sync Flush pages from a memory pool DB_ENV->memp_trickle Trickle flush pages from a memory pool Memory Pool Files DB_ENV->memp_fcreate Open a file in a memory pool DB_MPOOLFILE->close Close a file in a memory pool DB_MPOOLFILE->get Get page from a file in a memory pool DB_MPOOLFILE->open Open a file in a memory pool DB_MPOOLFILE->put Return a page to a memory pool DB_MPOOLFILE->set Set memory pool page status DB_MPOOLFILE->sync Flush pages from a file in a memory pool DB_MPOOLFILE->set_clear_len Set file page bytes to be cleared DB_MPOOLFILE->set_fileid Set file unique identifier DB_MPOOLFILE->set_ftype Set file type DB_MPOOLFILE->set_lsn_offset Set file log-sequence-number offset DB_MPOOLFILE->set_pgcookie Set file cookie for pgin/pgout-->
<div class="variablelist"><dl><dt><tt class="sexp">()</tt></dt><dd></dd></dl></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="bdb-transaction"></a>30.2.6.4.13. Transaction Subsystem</h5></div></div><div></div></div>
<!--DB_ENV->set_tx_max Set maximum number of transactions DB_ENV->set_tx_timestamp Set recovery timestamp DB_ENV->txn_checkpoint Checkpoint the transaction subsystem DB_ENV->txn_recover Distributed transaction recovery DB_ENV->txn_stat Return transaction subsystem statistics DB_TXN->abort Abort a transaction DB_TXN->commit Commit a transaction DB_TXN->discard Discard a prepared but not resolved transaction handle DB_TXN->id Return a transaction's ID DB_TXN->prepare Prepare a transaction for commit DB_TXN->set_timeout Set transaction timeout-->
<div class="variablelist"><dl><dt><tt class="sexp">(BDB:TXN-BEGIN dbe <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a>
   :PARENT :DIRTY-READ :NOSYNC :NOWAIT :SYNC)</tt></dt><dd>Begin a transaction (<a href="http://www.sleepycat.com/docs/api_c/txn_begin.html" target="_top"><tt class="function">DB_ENV-&gt;txn_begin</tt></a>).
</dd><dt><tt class="sexp">(BDB:TXN-ABORT txn)</tt></dt><dd>Abort a transaction (<a href="http://www.sleepycat.com/docs/api_c/txn_abort.html" target="_top"><tt class="function">DB_TXN-&gt;abort</tt></a>).
</dd><dt><tt class="sexp">(BDB:TXN-COMMIT txn <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a>
   :NOSYNC :SYNC)</tt></dt><dd>Commit a transaction (<a href="http://www.sleepycat.com/docs/api_c/txn_commit.html" target="_top"><tt class="function">DB_TXN-&gt;commit</tt></a>).
</dd><dt><tt class="sexp">(BDB:TXN-DISCARD txn)</tt></dt><dd>Discard a transaction (<a href="http://www.sleepycat.com/docs/api_c/txn_discard.html" target="_top"><tt class="function">DB_TXN-&gt;discard</tt></a>).
</dd></dl></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="bdb-replication"></a>30.2.6.4.14. Replication</h5></div></div><div></div></div>
<!--DB_ENV->set_rep_transport Configure replication transport DB_ENV->rep_elect Hold a replication election DB_ENV->set_rep_limit Limit data sent in response to a single message DB_ENV->rep_process_message Process a replication message DB_ENV->rep_start Configure an environment for replication DB_ENV->rep_stat Replication statistics-->
<div class="variablelist"><dl><dt><tt class="sexp">()</tt></dt><dd></dd></dl></div></div>
<!--<section id="bdb-"><title></title> <variablelist> <varlistentry><term><literal role="sexp">()</literal></term> <listitem><simpara></simpara></listitem></varlistentry> </variablelist> </section>-->
</div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="regexp"></a>30.2.6.5. <a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a> <a href="modules.html#regexp" title="30.2.6.5. CLISP “REGEXP” module"><strong class="package">“<span class="quote">REGEXP</span>”</strong></a> module</h4></div></div><div></div></div><div class="toc"><dl><dt><span class="section"><a href="modules.html#re-example">30.2.6.5.1. Example</a></span></dt></dl></div><p>The <a href="modules.html#regexp" title="30.2.6.5. CLISP “REGEXP” module"><strong class="package">“<span class="quote">REGEXP</span>”</strong></a> module implements the
 <a href="regexp.html" target="_top">POSIX regular expressions</a>
by calling the standard <a href="http://www.eskimo.com/~scs/C-faq/top.html" target="_top"><span><b class="command">C</b></span></a> system facilities.
The syntax of these <a href="http://www.opengroup.org/onlinepubs/007904975/basedefs/xbd_chap09.html" target="_top">regular expression</a>s is described in many places,
such as your local <a href="http://www.opengroup.org/onlinepubs/007904975/basedefs/regex.h.html" target="_top"><tt class="filename">regex.h</tt></a> manual and <a href="http://www.gnu.org/software/emacs/" target="_top">Emacs</a> info pages.</p><p>When this module is present, <a href="http://www.lisp.org/HyperSpec/Body/var_stfeaturesst.html" target="_top"><tt class="varname">*FEATURES*</tt></a> contains the
 symbol <tt class="constant">:REGEXP</tt>.</p><div class="variablelist"><a id="re-api"></a><p class="title"><b>API</b></p><dl><dt><a id="re-match"></a><tt class="sexp">(<a href="modules.html#re-match"><tt class="function">REGEXP:MATCH</tt></a> <i class="replaceable"><tt>pattern</tt></i> <i class="replaceable"><tt>string</tt></i> <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a>
   (<tt class="constant">:START</tt> 0) <tt class="constant">:END</tt> <a href="modules.html#re-cflags"><tt class="constant">:EXTENDED</tt> <tt class="constant">:IGNORE-CASE</tt> <tt class="constant">:NEWLINE</tt> <tt class="constant">:NOSUB</tt></a> <a href="modules.html#re-eflags"><tt class="constant">:NOTBOL</tt> <tt class="constant">:NOTEOL</tt></a>)</tt></dt><dd><p>This macro returns as first value a <tt class="classname">REGEXP:MATCH</tt> structure
  containing the indices of the start and end of the first match for the
  <a href="http://www.opengroup.org/onlinepubs/007904975/basedefs/xbd_chap09.html" target="_top">regular expression</a> <i class="replaceable"><tt>pattern</tt></i> in <i class="replaceable"><tt>string</tt></i>; or <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a> if there is no match.
  Additionally, a <tt class="classname">REGEXP:MATCH</tt> structure is returned for every matched
  <tt class="literal">"\(...\)"</tt> group in <i class="replaceable"><tt>pattern</tt></i>, in the
  order that the open parentheses appear in <i class="replaceable"><tt>pattern</tt></i>.
  If <i class="replaceable"><tt>start</tt></i> is non-<a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a>, the search starts at that index in <i class="replaceable"><tt>string</tt></i>.
  If <i class="replaceable"><tt>end</tt></i> is non-<a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a>, only <tt class="sexp">(<a href="http://www.lisp.org/HyperSpec/Body/acc_subseq.html" target="_top"><tt class="function">SUBSEQ</tt></a>
  <i class="replaceable"><tt>string</tt></i> <i class="replaceable"><tt>start</tt></i> <i class="replaceable"><tt>end</tt></i>)</tt> is considered.
  </p><div class="example"><a id="ex-re-match"></a><p class="title"><b>Example 30.1. <a href="modules.html#re-match"><tt class="function">REGEXP:MATCH</tt></a></b></p><table border="0" bgcolor="#E0E0E0"><tr><td><pre class="programlisting">
    (<a href="modules.html#re-match"><tt class="function">REGEXP:MATCH</tt></a> "quick" "The quick brown fox jumped quickly.")
     <tt class="data">#S(<tt class="classname">REGEXP:MATCH</tt> :START 4 :END 9)</tt>
    (<a href="modules.html#re-match"><tt class="function">REGEXP:MATCH</tt></a> "quick" "The quick brown fox jumped quickly." :start 8)
     <tt class="data">#S(<tt class="classname">REGEXP:MATCH</tt> :START 27 :END 32)</tt>
    (<a href="modules.html#re-match"><tt class="function">REGEXP:MATCH</tt></a> "quick" "The quick brown fox jumped quickly." :start 8 :end 30)
     <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a>
    (<a href="modules.html#re-match"><tt class="function">REGEXP:MATCH</tt></a> "\\([a-z]*\\)[0-9]*\\(bar\\)" "foo12bar")
     <tt class="data">#S(<tt class="classname">REGEXP:MATCH</tt> :START 0 :END 8) ;</tt>
     <tt class="data">#S(<tt class="classname">REGEXP:MATCH</tt> :START 0 :END 3) ;</tt>
     <tt class="data">#S(<tt class="classname">REGEXP:MATCH</tt> :START 5 :END 8)</tt>
  </pre></td></tr></table></div><p>
</p></dd><dt><a id="re-match-access"></a><tt class="sexp">(<a href="modules.html#re-match-access"><tt class="function">REGEXP:MATCH-START</tt></a> <i class="replaceable"><tt>match</tt></i>)</tt><br /><tt class="sexp">(<a href="modules.html#re-match-access"><tt class="function">REGEXP:MATCH-END</tt></a> <i class="replaceable"><tt>match</tt></i>)</tt></dt><dd>Return the start and end the <i class="replaceable"><tt>match</tt></i>; <a href="http://www.lisp.org/HyperSpec/Body/mac_setfcm_psetf.html" target="_top"><tt class="function">SETF</tt></a>-able.
</dd><dt><a id="re-match-string"></a><tt class="sexp">(<a href="modules.html#re-match-string"><tt class="function">REGEXP:MATCH-STRING</tt></a> <i class="replaceable"><tt>string</tt></i> <i class="replaceable"><tt>match</tt></i>)</tt></dt><dd>Extracts the substring of <i class="replaceable"><tt>string</tt></i> corresponding
  to the given pair of start and end indices of <i class="replaceable"><tt>match</tt></i>.
  The result is shared with <i class="replaceable"><tt>string</tt></i>.
  If you want a freshly consed <a href="http://www.lisp.org/HyperSpec/Body/syscla_string.html" target="_top"><tt class="classname">STRING</tt></a>, use <a href="http://www.lisp.org/HyperSpec/Body/fun_copy-seq.html" target="_top"><tt class="function">COPY-SEQ</tt></a> or
  <tt class="sexp">(<a href="http://www.lisp.org/HyperSpec/Body/fun_coerce.html" target="_top"><tt class="function">COERCE</tt></a> (<a href="modules.html#re-match-string"><tt class="function">REGEXP:MATCH-STRING</tt></a> ...)
  '<a href="http://www.lisp.org/HyperSpec/Body/typ_simple-string.html" target="_top"><tt class="classname">SIMPLE-STRING</tt></a>)</tt>.
</dd><dt><a id="re-regexp-quote"></a><tt class="sexp">(<a href="modules.html#re-regexp-quote"><tt class="function">REGEXP:REGEXP-QUOTE</tt></a> <i class="replaceable"><tt>string</tt></i> <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;OPTIONAL</tt></a>
   <i class="replaceable"><tt>extended</tt></i>)</tt></dt><dd><p>This function returns a <a href="http://www.opengroup.org/onlinepubs/007904975/basedefs/xbd_chap09.html" target="_top">regular expression</a> <a href="http://www.lisp.org/HyperSpec/Body/syscla_string.html" target="_top"><tt class="classname">STRING</tt></a>
  that matches exactly <i class="replaceable"><tt>string</tt></i> and nothing else.
  This allows you to request an exact string match when calling a
  function that wants a <a href="http://www.opengroup.org/onlinepubs/007904975/basedefs/xbd_chap09.html" target="_top">regular expression</a>.
  </p><div class="example"><a id="ex-re-quote"></a><p class="title"><b>Example 30.2. <a href="modules.html#re-regexp-quote"><tt class="function">REGEXP:REGEXP-QUOTE</tt></a></b></p><table border="0" bgcolor="#E0E0E0"><tr><td><pre class="programlisting">
    (regexp-quote "^The cat$")
     <span class="returnvalue">"\\^The cat\\$"</span>
   </pre></td></tr></table></div><p>
  One use of <a href="modules.html#re-regexp-quote"><tt class="function">REGEXP:REGEXP-QUOTE</tt></a> is to combine an exact string match with
  context described as a <a href="http://www.opengroup.org/onlinepubs/007904975/basedefs/xbd_chap09.html" target="_top">regular expression</a>.
  When <i class="replaceable"><tt>extended</tt></i> is non-<a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a>, also
  quote <span class="keysym">#\+</span> and <span class="keysym">#\?</span>.
</p></dd><dt><a id="re-regexp-compile"></a><tt class="sexp">(<a href="modules.html#re-regexp-compile"><tt class="function">REGEXP:REGEXP-COMPILE</tt></a> <i class="replaceable"><tt>string</tt></i> <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a>
   <a href="modules.html#re-cflags"><tt class="constant">:EXTENDED</tt> <tt class="constant">:IGNORE-CASE</tt> <tt class="constant">:NEWLINE</tt> <tt class="constant">:NOSUB</tt></a>)</tt></dt><dd>Compile the <a href="http://www.opengroup.org/onlinepubs/007904975/basedefs/xbd_chap09.html" target="_top">regular expression</a> <i class="replaceable"><tt>string</tt></i> into an
  object suitable for <a href="modules.html#re-regexp-exec"><tt class="function">REGEXP:REGEXP-EXEC</tt></a>.</dd><dt><a id="re-regexp-exec"></a><tt class="sexp">(<a href="modules.html#re-regexp-exec"><tt class="function">REGEXP:REGEXP-EXEC</tt></a> <i class="replaceable"><tt>pattern</tt></i> <i class="replaceable"><tt>string</tt></i> <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a>
     (<tt class="constant">:START</tt> 0) <tt class="constant">:END</tt> <a href="modules.html#re-eflags"><tt class="constant">:NOTBOL</tt> <tt class="constant">:NOTEOL</tt></a>)</tt></dt><dd><p>Execute the <i class="replaceable"><tt>pattern</tt></i>, which must be a compiled
   <a href="http://www.opengroup.org/onlinepubs/007904975/basedefs/xbd_chap09.html" target="_top">regular expression</a> returned by <a href="modules.html#re-regexp-compile"><tt class="function">REGEXP:REGEXP-COMPILE</tt></a>, against the
   appropriate portion of the <i class="replaceable"><tt>string</tt></i>.</p><p>Negative <i class="replaceable"><tt>end</tt></i> means <tt class="sexp">(<a href="http://www.lisp.org/HyperSpec/Body/fun_pl.html" target="_top"><tt class="function">+</tt></a> (<a href="http://www.lisp.org/HyperSpec/Body/fun_length.html" target="_top"><tt class="function">LENGTH</tt></a>
    <i class="replaceable"><tt>string</tt></i>) <i class="replaceable"><tt>end</tt></i>)</tt></p><p>Returns <tt class="classname">REGEXP:MATCH</tt> structures as multiple values (one for each
   subexpression which successfully matched and one for the whole pattern),
   unless <tt class="literal">:BOOLEAN</tt> was non-<a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a>, in which case
   return <a href="http://www.lisp.org/HyperSpec/Body/convar_t.html" target="_top"><tt class="constant">T</tt></a> as an indicator of success, but do not allocate anything.
</p></dd><dt><a id="re-regexp-split"></a><tt class="sexp">(<a href="modules.html#re-regexp-split"><tt class="function">REGEXP:REGEXP-SPLIT</tt></a>  <i class="replaceable"><tt>pattern</tt></i> <i class="replaceable"><tt>string</tt></i> <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a>
     (<tt class="constant">:START</tt> 0) <tt class="constant">:END</tt> <a href="modules.html#re-cflags"><tt class="constant">:EXTENDED</tt> <tt class="constant">:IGNORE-CASE</tt> <tt class="constant">:NEWLINE</tt> <tt class="constant">:NOSUB</tt></a> <a href="modules.html#re-eflags"><tt class="constant">:NOTBOL</tt> <tt class="constant">:NOTEOL</tt></a>)</tt></dt><dd>Return a list of substrings of <i class="replaceable"><tt>string</tt></i> (all
  sharing the structure with <i class="replaceable"><tt>string</tt></i>) separated by <i class="replaceable"><tt>pattern</tt></i> (a
  <a href="http://www.opengroup.org/onlinepubs/007904975/basedefs/xbd_chap09.html" target="_top">regular expression</a> <a href="http://www.lisp.org/HyperSpec/Body/syscla_string.html" target="_top"><tt class="classname">STRING</tt></a> or a return value of <a href="modules.html#re-regexp-compile"><tt class="function">REGEXP:REGEXP-COMPILE</tt></a>)
 </dd><dt><a id="re-with-loop-split"></a><tt class="sexp">(<a href="modules.html#re-with-loop-split"><tt class="function">REGEXP:WITH-LOOP-SPLIT</tt></a> (<i class="replaceable"><tt>variable</tt></i> <i class="replaceable"><tt>stream</tt></i> <i class="replaceable"><tt>pattern</tt></i>
     <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a> (<tt class="constant">:START</tt> 0) <tt class="constant">:END</tt> <a href="modules.html#re-cflags"><tt class="constant">:EXTENDED</tt> <tt class="constant">:IGNORE-CASE</tt> <tt class="constant">:NEWLINE</tt> <tt class="constant">:NOSUB</tt></a> <a href="modules.html#re-eflags"><tt class="constant">:NOTBOL</tt> <tt class="constant">:NOTEOL</tt></a>)
     <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-4.html" target="_top"><tt class="literal">&amp;BODY</tt></a> <i class="replaceable"><tt>body</tt></i>)</tt></dt><dd>Read lines from <i class="replaceable"><tt>stream</tt></i>, split them with
  <a href="modules.html#re-regexp-split"><tt class="function">REGEXP:REGEXP-SPLIT</tt></a> on <i class="replaceable"><tt>pattern</tt></i>, and bind the resulting list to
  <i class="replaceable"><tt>variable</tt></i>.</dd><dt><a id="re-cflags"></a><a href="modules.html#re-cflags"><tt class="constant">:EXTENDED</tt> <tt class="constant">:IGNORE-CASE</tt> <tt class="constant">:NEWLINE</tt> <tt class="constant">:NOSUB</tt></a></dt><dd>These options control compilation of a pattern.
   See <a href="http://www.opengroup.org/onlinepubs/007904975/basedefs/regex.h.html" target="_top"><tt class="filename">regex.h</tt></a> for their meaning.
</dd><dt><a id="re-eflags"></a><a href="modules.html#re-eflags"><tt class="constant">:NOTBOL</tt> <tt class="constant">:NOTEOL</tt></a></dt><dd>These options constrol execution of a pattern.
   See <a href="http://www.opengroup.org/onlinepubs/007904975/basedefs/regex.h.html" target="_top"><tt class="filename">regex.h</tt></a> for their meaning.
</dd><dt><a id="re-matcher"></a><a href="modules.html#re-matcher"><tt class="function">REGEXP:REGEXP-MATCHER</tt></a></dt><dd>A valid value for <a href="environment-dict.html#apropos" title="25.2.11. Functions APROPOS &amp; APROPOS-LIST"><tt class="varname">CUSTOM:*APROPOS-MATCHER*</tt></a>.
   This will work only when your <a href="http://www.opengroup.org/onlinepubs/007904975/basedefs/xbd_chap07.html" target="_top">locale</a> is <a href="encoding.html#charset-UTF-8"><tt class="constant">CHARSET:UTF-8</tt></a>
   because <a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a> uses <a href="encoding.html#charset-UTF-8"><tt class="constant">CHARSET:UTF-8</tt></a> internally and POSIX constrains
   <a href="http://www.opengroup.org/onlinepubs/007904975/basedefs/regex.h.html" target="_top"><tt class="filename">regex.h</tt></a> to use the current <a href="http://www.opengroup.org/onlinepubs/007904975/basedefs/xbd_chap07.html" target="_top">locale</a>.
</dd></dl></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="re-example"></a>30.2.6.5.1. Example</h5></div></div><div></div></div><p>The following code computes the number of people who use a
 particular shell:</p><div class="example"><a id="re-example-lisp"></a><p class="title"><b>Example 30.3. shell-count.lisp</b></p><table border="0" bgcolor="#E0E0E0"><tr><td><pre class="programlisting">
#!/usr/local/bin/clisp -C
(<a href="http://www.lisp.org/HyperSpec/Body/mac_defpackage.html" target="_top"><tt class="function">DEFPACKAGE</tt></a> "REGEXP-TEST" (:use "LISP" "REGEXP"))
(<a href="http://www.lisp.org/HyperSpec/Body/mac_in-package.html" target="_top"><tt class="function">IN-PACKAGE</tt></a> "REGEXP-TEST")
(let ((h (make-hash-table :test #'equal :size 10)) (n 0))
  (with-open-file (f "/etc/passwd")
    (with-loop-split (s f ":")
      (incf (gethash (seventh s) h 0))))
  (with-hash-table-iterator (i h)
    (loop (multiple-value-bind (r k v) (i)
            (unless r (return))
            (format t "[~d] ~s~30t== ~5:d~%" (incf n) k v)))))
</pre></td></tr></table></div><p>For comparison, the same can be done by the following <a href="http://www.perl.com" target="_top"><span><b class="command">Perl</b></span></a>:</p><div class="example"><a id="re-example-perl"></a><p class="title"><b>Example 30.4. shell-count.perl</b></p><table border="0" bgcolor="#E0E0E0"><tr><td><pre class="programlisting">
#!/usr/local/bin/perl -w

use diagnostics;
use strict;

my $IN = $ARGV[0];
open(INF,"&lt; $IN") || die "$0: cannot read file [$IN]: $!\n;";
my %hash;
while (&lt;INF&gt;) {
  chop;
  my @all = split($ARGV[1]);
  my $shell = ($#all &gt;= 6 ? $all[6] : "");
  if ($hash{$shell}) { $hash{$shell} ++; }
  else { $hash{$shell} = 1; }
}
my $ii = 0;
for my $kk (keys(%hash)) {
  print "[",++$ii,"] \"",$kk,"\"  --  ",$hash{$kk},"\n";
}
close(INF);
</pre></td></tr></table></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="pcre"></a>30.2.6.6. Perl Compatible Regular Expressions.</h4></div></div><div></div></div><p>This is an interface to <a href="http://www.pcre.org/" target="_top">Perl
  Compatible Regular Expressions</a>.</p><p>When this module is present, <a href="http://www.lisp.org/HyperSpec/Body/var_stfeaturesst.html" target="_top"><tt class="varname">*FEATURES*</tt></a> contains the
 symbol <tt class="constant">:PCRE</tt>.</p><div class="variablelist"><a id="pcre-api"></a><p class="title"><b>PCRE module API</b></p><dl><dt><a id="pcre-version"></a><tt class="sexp">(PCRE:PCRE-VERSION)</tt></dt><dd>Return version information as 3 values: descriptive
    <a href="http://www.lisp.org/HyperSpec/Body/syscla_string.html" target="_top"><tt class="classname">STRING</tt></a> and 2 <a href="http://www.lisp.org/HyperSpec/Body/typ_fixnum.html" target="_top"><tt class="classname">FIXNUM</tt></a>s: major and minor numbers.
 </dd><dt><a id="pcre-config"></a><tt class="sexp">(PCRE:PCRE-CONFIG <i class="replaceable"><tt>type</tt></i>)</tt></dt><dd>Return some information about the PCRE build
    configuration (<i class="replaceable"><tt>type</tt></i> is one of <tt class="literal">:UTF8</tt>
    <tt class="literal">:NEWLINE</tt> <tt class="literal">:LINK-SIZE</tt>
    <tt class="literal">:POSIX-MALLOC-THRESHOLD</tt>
    <tt class="literal">:MATCH-LIMIT</tt>).</dd><dt><a id="pcre-compile"></a><tt class="sexp">(PCRE:PCRE-COMPILE <i class="replaceable"><tt>string</tt></i>
    <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a> :STUDY :IGNORE-CASE :MULTILINE :DOTALL :EXTENDED :ANCHORED
    :DOLLAR-ENDONLY :EXTRA :NOTBOL :NOTEOL :UNGREADY :NOTEMPTY
    :NO-AUTO-CAPTURE)</tt></dt><dd>Compile a pattern, optionally study it.
 </dd><dt><a id="pattern-info"></a>
   <tt class="sexp">(PCRE:PATTERN-INFO <i class="replaceable"><tt>pattern</tt></i>
    request)</tt></dt><dd>Return some information about the <i class="replaceable"><tt>pattern</tt></i>,
    such as <tt class="literal">:OPTIONS</tt> <tt class="literal">:SIZE</tt>
    <tt class="literal">:CAPTURECOUNT</tt> <tt class="literal">:BACKREFMAX</tt>
    <tt class="literal">:FIRSTBYTE</tt> <tt class="literal">:FIRSTTABLE</tt>
    <tt class="literal">:LASTLITERAL</tt> <tt class="literal">:NAMEENTRYSIZE</tt>
    <tt class="literal">:NAMECOUNT</tt> <tt class="literal">:NAMETABLE</tt>
    <tt class="literal">:STUDYSIZE</tt>.</dd><dt><a id="pcre-name-to-index"></a><tt class="sexp">(PCRE:PCRE-NAME-TO-INDEX
    <i class="replaceable"><tt>pattern</tt></i> <i class="replaceable"><tt>name</tt></i>)</tt></dt><dd>Convert the name of the sub-pattern to an index in
    the return vector.</dd><dt><a id="pcre-exec"></a><tt class="sexp">(PCRE:PCRE-EXEC <i class="replaceable"><tt>pattern</tt></i> <i class="replaceable"><tt>string</tt></i>
    <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a> :BOOLEAN :OFFSET :ANCHORED :NOTBOL :NOTEOL
    :NOTEMPTY)</tt></dt><dd>Execute the compiled <i class="replaceable"><tt>pattern</tt></i> against the
    <i class="replaceable"><tt>string</tt></i> at the given <i class="replaceable"><tt>offset</tt></i> with the given options.
    Returns <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a> if no matches or a <a href="http://www.lisp.org/HyperSpec/Body/syscla_vector.html" target="_top"><tt class="classname">VECTOR</tt></a> of <a href="http://www.lisp.org/HyperSpec/Body/fun_length.html" target="_top"><tt class="function">LENGTH</tt></a>
    <tt class="literal">CAPTURECOUNT+1</tt> of <span class="type">PCRE:MATCH</span> structures,
    unless <tt class="literal">:BOOLEAN</tt> was non-<a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a>, in which case
    return <a href="http://www.lisp.org/HyperSpec/Body/convar_t.html" target="_top"><tt class="constant">T</tt></a> as an indicator of success, but do not allocate anything.
 </dd><dt><a id="pcre-match-access"></a><tt class="sexp">(PCRE:MATCH-START <i class="replaceable"><tt>match</tt></i>)</tt><br /><tt class="sexp">(PCRE:MATCH-END <i class="replaceable"><tt>match</tt></i>)</tt></dt><dd>Return the start and end of the <i class="replaceable"><tt>match</tt></i>. <a href="http://www.lisp.org/HyperSpec/Body/mac_setfcm_psetf.html" target="_top"><tt class="function">SETF</tt></a>-able.
 </dd><dt><a id="match-substring"></a><tt class="sexp">(PCRE:MATCH-SUBSTRING
    <i class="replaceable"><tt>match</tt></i> <i class="replaceable"><tt>string</tt></i>)</tt></dt><dd>Return the substring of <i class="replaceable"><tt>string</tt></i> bounded by <i class="replaceable"><tt>match</tt></i>.
 </dd><dt><a id="match-strings"></a><tt class="sexp">(PCRE:MATCH-STRINGS
    return-vector <i class="replaceable"><tt>string</tt></i>)</tt></dt><dd>Return all substrings for all matches found
    by <tt class="function">PCRE:PCRE-EXEC</tt>.
 </dd><dt><a id="match-string"></a><tt class="sexp">(PCRE:MATCH-STRING return-vector which
    <i class="replaceable"><tt>string</tt></i> <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;OPTIONAL</tt></a> <i class="replaceable"><tt>pattern</tt></i>)</tt></dt><dd>Return the substring that matches the given sub-pattern.
    If <i class="replaceable"><tt>which</tt></i> is a name of the sub-pattern (as
    opposed to its number), <i class="replaceable"><tt>pattern</tt></i> must be supplied.
 </dd><dt><a id="pcre-matcher"></a><tt class="sexp">(PCRE:PCRE-MATCHER <i class="replaceable"><tt>pattern</tt></i>)</tt></dt><dd>A valid value for <a href="environment-dict.html#apropos" title="25.2.11. Functions APROPOS &amp; APROPOS-LIST"><tt class="varname">CUSTOM:*APROPOS-MATCHER*</tt></a>.
 </dd></dl></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="syscalls"></a>30.2.6.7. System Calls</h4></div></div><div></div></div><p>The <a href="modules.html#syscalls" title="30.2.6.7. System Calls"><strong class="package">“<span class="quote">POSIX</span>”</strong></a> module makes some system calls available from lisp.
 Not all of these system calls are actually POSIX, so this package has a
 nickname <strong class="package">“<span class="quote">OS</span>”</strong>.</p><p>When this module is present, <a href="http://www.lisp.org/HyperSpec/Body/var_stfeaturesst.html" target="_top"><tt class="varname">*FEATURES*</tt></a> contains the
 symbol <tt class="constant">:SYSCALLS</tt>.</p><div class="variablelist"><dl><dt><tt class="sexp">(<tt class="function">POSIX:RESOLVE-HOST-IPADDR</tt>
    <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;OPTIONAL</tt></a> <i class="replaceable"><tt>host</tt></i>)</tt></dt><dd>Returns the <span class="type">HOSTENT</span> structure (name,
   list of aliases, list of IP addresses as dotted quads (for IPv4) or
   coloned octets (for IPv6), address type - IPv4 or IPv6).
   When <i class="replaceable"><tt>host</tt></i> is omitted or <tt class="constant">:DEFAULT</tt>, return the data for the
   current host. When <i class="replaceable"><tt>host</tt></i> is given and is <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a>, all the
   host database is returned as a list (this would be the contents of the
   <tt class="filename">/etc/hosts</tt> file on a <a href="http://www.UNIX-systems.org/online.html" target="_top"><strong>UNIX</strong></a> system or
   <tt class="filename">${windir}/system32/etc/hosts</tt> on a Win32 system).
   This is an interface to <a href="http://www.opengroup.org/onlinepubs/007904975/functions/gethostbyname.html" target="_top"><tt class="function">gethostbyname</tt></a>/<a href="http://www.opengroup.org/onlinepubs/007904975/functions/gethostbyaddr.html" target="_top"><tt class="function">gethostbyaddr</tt></a>.
  </dd><dt><a id="file-stat"></a><tt class="sexp">(<tt class="function">POSIX:FILE-STAT</tt> <i class="replaceable"><tt>pathname</tt></i>
      <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;OPTIONAL</tt></a> <i class="replaceable"><tt>link-p</tt></i>)</tt></dt><dd><p>Return the <span class="type">FILE-STAT</span> structure.
   <i class="replaceable"><tt>pathname</tt></i> can be a <a href="http://www.lisp.org/HyperSpec/Body/syscla_stream.html" target="_top"><tt class="classname">STREAM</tt></a>, a <a href="http://www.lisp.org/HyperSpec/Body/syscla_pathname.html" target="_top"><tt class="classname">PATHNAME</tt></a>, a <a href="http://www.lisp.org/HyperSpec/Body/syscla_string.html" target="_top"><tt class="classname">STRING</tt></a> or a
   <a href="http://www.lisp.org/HyperSpec/Body/syscla_number.html" target="_top"><tt class="classname">NUMBER</tt></a> (on a <a href="http://www.UNIX-systems.org/online.html" target="_top"><strong>UNIX</strong></a> system, meaning <a href="http://www.opengroup.org/onlinepubs/007904975/basedefs/xbd_chap03.html#tag_03_165" target="_top">file descriptor</a>).
   The first slot of the structure returned is the string or the
   number on which <a href="http://www.opengroup.org/onlinepubs/007904975/functions/stat.html" target="_top"><tt class="function">stat</tt></a>/<a href="http://www.opengroup.org/onlinepubs/007904975/functions/fstat.html" target="_top"><tt class="function">fstat</tt></a>/<a href="http://www.opengroup.org/onlinepubs/007904975/functions/lstat.html" target="_top"><tt class="function">lstat</tt></a> was called.
   The other slots are numbers, members of the <span class="type">struct stat</span>:
    </p><div class="variablelist"><dl><dt>dev</dt><dd>Device ID of device containing file.
     </dd><dt>ino</dt><dd>File serial number.
     </dd><dt>mode</dt><dd>Mode of file.
     </dd><dt>nlink</dt><dd>Number of hard links to the file.
     </dd><dt>uid</dt><dd>User ID of file.
     </dd><dt>gid</dt><dd>Group ID of file.
     </dd><dt>rdev</dt><dd>Device ID (if file is character or block
        special).</dd><dt>size</dt><dd>For regular files, the file size in bytes.
        For symbolic links, the length in bytes of the pathname contained
        in the symbolic link.
        For a shared memory object, the length in bytes.
        For a typed memory object, the length in bytes.
        For other file types, the use of this field is unspecified.
     </dd><dt>atime</dt><dd>Time of last access (as the number of seconds
        since 1900-01-01).</dd><dt>mtime</dt><dd>Time of last data modification (as the number of
        seconds since 1900-01-01).</dd><dt>ctime</dt><dd>Time of last status change (as the number of
        seconds since 1900-01-01).</dd><dt>blksize</dt><dd>A file system-specific preferred I/O block size
        for this object.  In some file system types, this may vary from
        file to file.</dd><dt>blocks</dt><dd>Number of blocks allocated for this object.
     </dd></dl></div><p>
    All slots are read-only.
   </p><p>If the system does not support a particular
    field (e.g., <a href="http://www.willows.com/" target="_top"><strong>Win32</strong></a> prior to 2000 does not have hard links), <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a>
    (or the default, like 1 for the number of hard links for old
    <a href="http://www.willows.com/" target="_top"><strong>Win32</strong></a>) is returned.
   </p><p>[<a href="http://www.UNIX-systems.org/online.html" target="_top"><strong>UNIX</strong></a> systems only at this time, patches are welcome.]
 </p></dd><dt><a id="set-file-stat"></a><tt class="sexp">(<tt class="function">POSIX:SET-FILE-STAT</tt> <i class="replaceable"><tt>pathname</tt></i>
    <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a> <i class="replaceable"><tt>mode</tt></i> <i class="replaceable"><tt>uid</tt></i>
    <i class="replaceable"><tt>gid</tt></i>)</tt></dt><dd><p>Set some file attributes using <a href="http://www.opengroup.org/onlinepubs/007904975/functions/chmod.html" target="_top"><tt class="function">chmod</tt></a> and <a href="http://www.opengroup.org/onlinepubs/007904975/functions/chown.html" target="_top"><tt class="function">chown</tt></a>.
   </p><p>[<a href="http://www.UNIX-systems.org/online.html" target="_top"><strong>UNIX</strong></a> systems only at this time, patches ar welcome.]
 </p></dd><dt><a id="stat-vfs"></a><tt class="sexp">(<tt class="function">POSIX:STAT-VFS</tt>
    <i class="replaceable"><tt>pathname</tt></i>)</tt></dt><dd><p>Return the <span class="type">STAT-VFS</span> structure.
   <i class="replaceable"><tt>pathname</tt></i> can be a <a href="http://www.lisp.org/HyperSpec/Body/syscla_stream.html" target="_top"><tt class="classname">STREAM</tt></a>, a <a href="http://www.lisp.org/HyperSpec/Body/syscla_pathname.html" target="_top"><tt class="classname">PATHNAME</tt></a>, a <a href="http://www.lisp.org/HyperSpec/Body/syscla_string.html" target="_top"><tt class="classname">STRING</tt></a> or a
   <a href="http://www.lisp.org/HyperSpec/Body/syscla_number.html" target="_top"><tt class="classname">NUMBER</tt></a> (on a <a href="http://www.UNIX-systems.org/online.html" target="_top"><strong>UNIX</strong></a> system, meaning <a href="http://www.opengroup.org/onlinepubs/007904975/basedefs/xbd_chap03.html#tag_03_165" target="_top">file descriptor</a>).
   The first slot of the structure returned is the string
   or the number on which <a href="http://www.opengroup.org/onlinepubs/007904975/functions/statvfs.html" target="_top"><tt class="function">statvfs</tt></a>/<a href="http://www.opengroup.org/onlinepubs/007904975/functions/fstatvfs.html" target="_top"><tt class="function">fstatvfs</tt></a> was called.
   The other slots are members of the <span class="type">struct statvfs</span>:
   </p><div class="variablelist"><dl><dt>bsize</dt><dd>File system block size.
    </dd><dt>frsize</dt><dd>Fundamental file system block size.
    </dd><dt>blocks</dt><dd>Total number of blocks on file system in units
       of <tt class="literal">frsize</tt>.</dd><dt>bfree</dt><dd>Total number of free blocks.
    </dd><dt>bavail</dt><dd>Number of free blocks available to
       non-privileged processes.</dd><dt>files</dt><dd>Total number of file serial numbers.
    </dd><dt>ffree</dt><dd>Total number of free file serial numbers.
    </dd><dt>favail</dt><dd>Number of file serial numbers available to
       non-privileged processes.</dd><dt>fsid</dt><dd>File system ID.</dd><dt>flag</dt><dd>List of platform-dependent values, such as <tt class="constant">:READ-ONLY</tt>.
    </dd><dt>namemax</dt><dd>Maximum filename length.
   </dd></dl></div><p>
   All slots are read-only.
  </p><p>[<a href="http://www.UNIX-systems.org/online.html" target="_top"><strong>UNIX</strong></a> systems only at this time, patches are welcome.]
 </p></dd><dt><a id="file-info"></a><tt class="sexp">(<tt class="function">OS:FILE-INFO</tt>
    <i class="replaceable"><tt>pathname</tt></i>)</tt></dt><dd><p>Return the <span class="type">FILE-INFO</span> structure.
   <i class="replaceable"><tt>pathname</tt></i> should be a <a href="filename-dict.html#path-des">pathname designator</a>. The 8 slots are attributes, ctime,
   atime, wtime, high and low sizes, name and short name.
   </p><p>[<a href="http://www.willows.com/" target="_top"><strong>Win32</strong></a> systems only at this time, patches are welcome.]
  </p></dd><dt><tt class="sexp">(<tt class="function">POSIX:USER-DATA</tt>
    <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;OPTIONAL</tt></a> <i class="replaceable"><tt>user</tt></i>)</tt></dt><dd><p>Return the <span class="type">PASSWD</span> structure (name,
   encoded password, UID, GID, full name, home directory, shell).
   When <i class="replaceable"><tt>user</tt></i> is <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a>, return all users.
   When <i class="replaceable"><tt>user</tt></i> is <tt class="constant">:DEFAULT</tt> or
   not supplied, return the information about the current user.
   If the system does not support a particular field (e.g., Win32 does
   not have a concept of a shell), <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a> (or the default, like
   <tt class="filename">c:\command.com</tt> for DOS) is returned.
   </p><p>[<a href="http://www.UNIX-systems.org/online.html" target="_top"><strong>UNIX</strong></a> systems only at this time, patches are welcome.]
  </p></dd><dt><tt class="sexp">(<tt class="function">POSIX:UNAME</tt>)</tt></dt><dd>Return a structure describing the OS, derived from
    <a href="http://www.opengroup.org/onlinepubs/007904975/functions/uname.html" target="_top"><tt class="function">uname</tt></a>.</dd><dt><tt class="sexp">(<tt class="function">POSIX:SYSCONF</tt>)</tt><br /><tt class="sexp">(<tt class="function">POSIX:CONFSTR</tt>)</tt></dt><dd>Return a structure describing the system
    configuration, derived from <a href="http://www.opengroup.org/onlinepubs/007904975/functions/sysconf.html" target="_top"><tt class="function">sysconf</tt></a> and <a href="http://www.opengroup.org/onlinepubs/007904975/functions/confstr.html" target="_top"><tt class="function">confstr</tt></a> respectively.
 </dd><dt><tt class="sexp">(<tt class="function">POSIX:LIMITS</tt>)</tt></dt><dd>Return a structure describing the resource limits,
    derived from <a href="http://www.opengroup.org/onlinepubs/007904975/functions/getrlimit.html" target="_top"><tt class="function">getrlimit</tt></a>.</dd><dt><tt class="sexp">(<tt class="function">POSIX:USAGE</tt>)</tt></dt><dd>Return 2 structures describing the resource usage by
    the lisp process and its children, derived from <a href="http://www.opengroup.org/onlinepubs/007904975/functions/getrusage.html" target="_top"><tt class="function">getrusage</tt></a>.
  </dd><dt><tt class="sexp">(<tt class="function">POSIX:ERF</tt>
       <i class="replaceable"><tt>real</tt></i>)</tt><br /><tt class="sexp">(<tt class="function">POSIX:ERFC</tt>
       <i class="replaceable"><tt>real</tt></i>)</tt><br /><tt class="sexp">(<tt class="function">POSIX:J0</tt>
       <i class="replaceable"><tt>real</tt></i>)</tt><br /><tt class="sexp">(<tt class="function">POSIX:J1</tt>
       <i class="replaceable"><tt>real</tt></i>)</tt><br /><tt class="sexp">(<tt class="function">POSIX:JN</tt>
       <i class="replaceable"><tt>integer</tt></i> <i class="replaceable"><tt>real</tt></i>)</tt><br /><tt class="sexp">(<tt class="function">POSIX:Y0</tt>
       <i class="replaceable"><tt>real</tt></i>)</tt><br /><tt class="sexp">(<tt class="function">POSIX:Y1</tt>
       <i class="replaceable"><tt>real</tt></i>)</tt><br /><tt class="sexp">(<tt class="function">POSIX:YN</tt>
       <i class="replaceable"><tt>integer</tt></i> <i class="replaceable"><tt>real</tt></i>)</tt><br /><tt class="sexp">(<tt class="function">POSIX:GAMMA</tt>
       <i class="replaceable"><tt>real</tt></i>)</tt><br /><tt class="sexp">(<tt class="function">POSIX:LGAMMA</tt>
       <i class="replaceable"><tt>real</tt></i>)</tt></dt><dd>Compute the error functions, Bessel functions and
   Gamma.  These functions are required by the POSIX standard and should
   be available in libm.so.  Please note that these functions do not
   provide lisp-style error handling and precision, and do all the
   computations at the double float level.
 </dd><dt><a id="stream-lock"></a>
   <tt class="sexp">(<tt class="function">POSIX:STREAM-LOCK</tt> <i class="replaceable"><tt>stream</tt></i>
    <i class="replaceable"><tt>lock-p</tt></i> <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a>
    (:BLOCK <a href="http://www.lisp.org/HyperSpec/Body/convar_t.html" target="_top"><tt class="constant">T</tt></a>) (:SHARED <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a>) (:START 0) (:END <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a>))</tt></dt><dd>This is an interface to the <a href="http://www.opengroup.org/onlinepubs/007904975/functions/fcntl.html" target="_top"><tt class="function">fcntl</tt></a> system call.
   It sets or removes a file lock for the (portion of the) file associated
   with <i class="replaceable"><tt>stream</tt></i>, depending on <i class="replaceable"><tt>lock-p</tt></i>.
   When <i class="replaceable"><tt>block</tt></i> is <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a>, the call is non-blocking,
   and when the file is already locked, it <a href="http://www.lisp.org/HyperSpec/Body/fun_signal.html" target="_top"><tt class="function">SIGNAL</tt></a>s an <a href="http://www.lisp.org/HyperSpec/Body/contyp_error.html" target="_top"><tt class="classname">ERROR</tt></a>.
   When <i class="replaceable"><tt>shared</tt></i> is non-<a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a>,
   then lock can be shared between several callers.
   Several processes can set a <i class="replaceable"><tt>shared</tt></i>
   (i.e., <span class="emphasis"><em>read</em></span>) lock, but only one can set
   an <span class="emphasis"><em>exclusive</em></span> (i.e., <span class="emphasis"><em>write</em></span>,
   or non-<i class="replaceable"><tt>shared</tt></i>) lock.
 </dd><dt><a id="mknod"></a><tt class="sexp">(<tt class="function">POSIX:MKNOD</tt> <i class="replaceable"><tt>pathname</tt></i> <i class="replaceable"><tt>type</tt></i>
    <i class="replaceable"><tt>mode</tt></i>)</tt></dt><dd>Create a special file using <a href="http://www.opengroup.org/onlinepubs/007904975/functions/mknod.html" target="_top"><tt class="function">mknod</tt></a>.
   Use <tt class="literal">:FIFO</tt> to create pipes
   and <tt class="literal">:SOCK</tt> to create sockets.
 </dd><dt><a id="convert-modes"></a><tt class="sexp">(<tt class="function">POSIX:CONVERT-MODE</tt> <i class="replaceable"><tt>mode</tt></i>)</tt></dt><dd>Convert between numeric, (e.g., <tt class="literal">0644</tt>)
   and symbolic (e.g., <tt class="sexp">(:RUSR :WUSR :RGRP :ROTH)</tt>)
   file modes.</dd><dt><a id="umask"></a><tt class="sexp">(<tt class="function">UMASK</tt> <i class="replaceable"><tt>mode</tt></i>)</tt></dt><dd>Change process mask using <a href="http://www.opengroup.org/onlinepubs/007904975/functions/umask.html" target="_top"><tt class="function">umask</tt></a>.
 </dd><dt><a id="copy-file"></a>
   <tt class="sexp">(<tt class="function">POSIX:COPY-FILE</tt>
    <i class="replaceable"><tt>source-path</tt></i>
    <i class="replaceable"><tt>destination-path</tt></i>
    <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a> :METHOD :PRESERVE :IF-EXISTS :IF-DOES-NOT-EXIST)</tt></dt><dd><p>This is an interface to the <a href="http://www.opengroup.org/onlinepubs/007904975/functions/symlink.html" target="_top"><tt class="function">symlink</tt></a>
    (when <i class="replaceable"><tt>method</tt></i> is <tt class="constant">:SYMLINK</tt>),
    <a href="http://www.opengroup.org/onlinepubs/007904975/functions/link.html" target="_top"><tt class="function">link</tt></a> (when it is <tt class="constant">:HARDLINK</tt>), and <a href="http://www.opengroup.org/onlinepubs/007904975/functions/rename.html" target="_top"><tt class="function">rename</tt></a>
    (when it is <tt class="constant">:RENAME</tt>) system calls, as well as,
    you guessed it, a generic file copy utility
    (when <i class="replaceable"><tt>method</tt></i> is <tt class="constant">:COPY</tt>).
   </p><p>Both <i class="replaceable"><tt>source-path</tt></i> and
    <i class="replaceable"><tt>destination-path</tt></i> may be wild.
 </p></dd><dt><a id="dup-handle"></a>
   <tt class="sexp">(<tt class="function">POSIX:DUPLICATE-HANDLE</tt>
    <i class="replaceable"><tt>fd1</tt></i>
    <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;OPTIONAL</tt></a> <i class="replaceable"><tt>fd2</tt></i>)</tt></dt><dd>This is an interface to the <a href="http://www.opengroup.org/onlinepubs/007904975/functions/dup.html" target="_top"><tt class="function">dup/dup2</tt></a> system calls on
   <a href="http://www.UNIX-systems.org/online.html" target="_top"><strong>UNIX</strong></a> systems and to <tt class="function">DuplicateHandle</tt> system
   call on <a href="http://www.willows.com/" target="_top"><strong>Win32</strong></a>.</dd><dt><tt class="sexp">(OS:SHORTCUT-INFO
    <i class="replaceable"><tt>pathname</tt></i>)</tt></dt><dd>Return information about a <a href="http://www.willows.com/" target="_top"><strong>Win32</strong></a> shortcut
    (<tt class="filename">#P".lnk"</tt>) file contents in a
    <span class="type">SHORTCUT-INFO</span> structure.</dd><dt><tt class="sexp">(OS:MAKE-SHORTCUT
    <i class="replaceable"><tt>pathname</tt></i> <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;KEY</tt></a> :WORKING-DIRECTORY :ARGUMENTS :SHOW-COMMAND :ICON
    :DESCRIPTION :HOT-KEY :PATH)</tt></dt><dd>Create (or modify the properties of an existing one)
    a <a href="http://www.willows.com/" target="_top"><strong>Win32</strong></a> shortcut (<tt class="filename">#P".lnk"</tt>) file.
 </dd><dt><tt class="sexp">(OS:SYSTEM-INFO)</tt></dt><dd>Return <a href="http://www.willows.com/" target="_top"><strong>Win32</strong></a> system information in a
    <span class="type">SYSTEM-INFO</span> structure.</dd><dt><tt class="sexp">(OS:VERSION)</tt></dt><dd>Return <a href="http://www.willows.com/" target="_top"><strong>Win32</strong></a> version information in a
    <span class="type">VERSION</span> structure.</dd><dt><tt class="sexp">(POSIX:CRYPT <i class="replaceable"><tt>key</tt></i>
    <i class="replaceable"><tt>salt</tt></i>)</tt></dt><dd>Call <a href="http://www.opengroup.org/onlinepubs/007904975/functions/crypt.html" target="_top"><tt class="function">crypt</tt></a>, arguments are <a href="http://www.lisp.org/HyperSpec/Body/syscla_string.html" target="_top"><tt class="classname">STRING</tt></a>s.
 </dd><dt><tt class="sexp">(POSIX:ENCRYPT <i class="replaceable"><tt>block</tt></i>
    <i class="replaceable"><tt>decrypt-p</tt></i>)</tt><br /><tt class="sexp">(POSIX:SETKEY <i class="replaceable"><tt>key</tt></i>)</tt></dt><dd>Call <a href="http://www.opengroup.org/onlinepubs/007904975/functions/encrypt.html" target="_top"><tt class="function">encrypt</tt></a> and <a href="http://www.opengroup.org/onlinepubs/007904975/functions/setkey.html" target="_top"><tt class="function">setkey</tt></a>, respectively.
    <i class="replaceable"><tt>block</tt></i> and <i class="replaceable"><tt>key</tt></i> are of type
    <tt class="type">(<a href="http://www.lisp.org/HyperSpec/Body/fun_vector.html" target="_top"><tt class="function">VECTOR</tt></a> (<a href="http://www.lisp.org/HyperSpec/Body/typ_unsigned-byte.html" target="_top"><tt class="classname">UNSIGNED-BYTE</tt></a> 8) 8)</tt>.
    <i class="replaceable"><tt>decrypt-p</tt></i> is <a href="http://www.lisp.org/HyperSpec/Body/typ_boolean.html" target="_top"><tt class="classname">BOOLEAN</tt></a>.
 </dd></dl></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="oracle"></a>30.2.6.8. <a href="http://www.oracle.com" target="_top">Oracle</a> Interface</h4></div></div><div></div></div><div class="toc"><dl><dt><span class="section"><a href="modules.html#ora-functionality">30.2.6.8.1. Functions and Macros in
  package ORACLE</a></span></dt><dt><span class="section"><a href="modules.html#ora-example">30.2.6.8.2. Oracle Example</a></span></dt><dt><span class="section"><a href="modules.html#ora-config">30.2.6.8.3. Oracle Configuration</a></span></dt><dt><span class="section"><a href="modules.html#ora-build">30.2.6.8.4. Building the Oracle Interface</a></span></dt></dl></div><p>
The <a href="http://www.oracle.com" target="_top">Oracle</a> module allows a <a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a> program to act as client to an
<a href="http://www.oracle.com" target="_top">Oracle</a> database server.  The module includes full
SQL support, transactions (including auto-commit), support for most
<a href="http://www.oracle.com" target="_top">Oracle</a> data types (LONG, BLOB, CLOB, RAW, etc.), automatic conversion
between <a href="http://www.oracle.com" target="_top">Oracle</a> and <a href="http://www.lisp.org" target="_top"><span><b class="command">Common Lisp</b></span></a> data types, database connection caching and
retry, concurrent connections to multiple databases, proper handling
of <a href="http://www.oracle.com" target="_top">Oracle</a> errors, and more.  </p><p>The module can be used to build sophisticated <a href="http://www.oracle.com" target="_top">Oracle</a> database
applications in <a href="http://www.lisp.org" target="_top"><span><b class="command">Common Lisp</b></span></a>.</p><p>When this module is present, <a href="http://www.lisp.org/HyperSpec/Body/var_stfeaturesst.html" target="_top"><tt class="varname">*FEATURES*</tt></a> contains the
 symbol <tt class="constant">:ORACLE</tt>.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ora-functionality"></a>30.2.6.8.1. Functions and Macros in
  package <strong class="package">“<span class="quote">ORACLE</span>”</strong></h5></div></div><div></div></div><p>Access to <a href="http://www.oracle.com" target="_top">Oracle</a> is via these functions and macros in
package <strong class="package">“<span class="quote">ORACLE</span>”</strong>.
When any <a href="http://www.oracle.com" target="_top">Oracle</a> function fails, the general Lisp function
<a href="http://www.lisp.org/HyperSpec/Body/fun_error.html" target="_top"><tt class="function">ERROR</tt></a> is called, with the condition string set to
include the <a href="http://www.oracle.com" target="_top">Oracle</a> error number, the <a href="http://www.oracle.com" target="_top">Oracle</a> message text,
and other context of the error (e.g., the text and parse location of a
SQL query).</p>
<!--List of functions an macros-->
<div class="variablelist">
<!--CONNECT--><dl><dt><tt class="sexp">(ORACLE:CONNECT
<i class="replaceable"><tt>user</tt></i>
<i class="replaceable"><tt>password</tt></i>
<i class="replaceable"><tt>server</tt></i>
<a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;OPTIONAL</tt></a>
<i class="replaceable"><tt>schema</tt></i>
<i class="replaceable"><tt>auto-commit</tt></i>
<i class="replaceable"><tt>prefetch-buffer-bytes</tt></i>
<i class="replaceable"><tt>long-len</tt></i>
<i class="replaceable"><tt>truncate-ok</tt></i>)</tt></dt><dd><p>

Connect to an <a href="http://www.oracle.com" target="_top">Oracle</a> database.  All subsequent operations will affect
this database until the next call to <tt class="function">CONNECT</tt>.  A
single program can access different <a href="http://www.oracle.com" target="_top">Oracle</a> schemas concurrently by
repeated calls to <tt class="function">CONNECT</tt>.  Database connections
are cached and re-used: if you call <tt class="function">CONNECT</tt> again
with the same <i class="replaceable"><tt>user</tt></i>,
<i class="replaceable"><tt>schema</tt></i>, and
<i class="replaceable"><tt>server</tt></i>, the previous <a href="http://www.oracle.com" target="_top">Oracle</a> connection will
be re-used.  <tt class="function">CONNECT</tt> may not be called inside
<tt class="function">WITH-TRANSACTION</tt>.

Returns: <a href="http://www.lisp.org/HyperSpec/Body/convar_t.html" target="_top"><tt class="constant">T</tt></a> if a cached connection was re-used, <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a> if a new
connection was created (and cached).

The meaning of the arguments is as follows:
</p><div class="variablelist"><p class="title"><b>Arguments for <tt class="function">CONNECT</tt></b></p><dl><dt><i class="replaceable"><tt>user</tt></i></dt><dd><a href="http://www.oracle.com" target="_top">Oracle</a> user ID</dd><dt><i class="replaceable"><tt>password</tt></i></dt><dd>Password for user, or <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a> if
   <i class="replaceable"><tt>user</tt></i> has no password (!).
</dd><dt><i class="replaceable"><tt>server</tt></i></dt><dd><a href="http://www.oracle.com" target="_top">Oracle</a> server ID (SID).
</dd><dt><i class="replaceable"><tt>schema</tt></i></dt><dd><a href="http://www.oracle.com" target="_top">Oracle</a> default schema (default: <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a>).
   If <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a>, same as user.  This allows you to log on with one user's
   id/password but see the database as if you were some other user.
</dd><dt><i class="replaceable"><tt>auto-commit</tt></i></dt><dd>Flag: whether to commit after every operation
   (default: <a href="http://www.lisp.org/HyperSpec/Body/convar_t.html" target="_top"><tt class="constant">T</tt></a>). Set this to <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a> if you intend to do transactions
   and call <tt class="function">COMMIT</tt> explicitly.  However,
   <tt class="function">WITH-TRANSACTION</tt> is probably easier.
</dd><dt><i class="replaceable"><tt>prefetch-buffer-bytes</tt></i></dt><dd>Number of bytes to cache from SQL SELECT fetches
   (default: 64 Kbytes) If you are very short of memory, or have a slow
   connection to <a href="http://www.oracle.com" target="_top">Oracle</a>, you can reduce this to 10k or so.
   Alternatively, if you have a fast connection to <a href="http://www.oracle.com" target="_top">Oracle</a> and
   regularly do large queries, you can increase throughput by increasing
   this value.</dd><dt><i class="replaceable"><tt>long-len</tt></i></dt><dd>Number of bytes to fetch for "long" (LONG, [BC]LOB)
   types.  Long data that exceeds this size will raise an error, or be
   truncated depending on the value of <i class="replaceable"><tt>truncate-ok</tt></i>
   (below).  Setting <i class="replaceable"><tt>long-len</tt></i> to zero and
   <i class="replaceable"><tt>truncate-ok</tt></i> to <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a> will disable long
   fetching entirely.  If <i class="replaceable"><tt>long-len</tt></i> is <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a>
   or negative, defaults to 500k bytes.</dd><dt><i class="replaceable"><tt>truncate-ok</tt></i></dt><dd>Flag: if set, allow truncation of LONG columns to
   <i class="replaceable"><tt>long-len</tt></i> bytes on fetch; otherwise, fetches
   of LONG columns exceeding <i class="replaceable"><tt>long-len</tt></i> bytes
   will raise an error.  Default: <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a>.</dd></dl></div></dd>
<!--DISCONNECT--><dt><tt class="sexp">(ORACLE:DISCONNECT)</tt></dt><dd>
Disconnect from the database currently connected.  No more calls can
be made until <tt class="function">CONNECT</tt> is called again.  The
connection is closed and removed from the connection cache.  Does
nothing if there is no connection.  <tt class="function">DISCONNECT</tt>
may not be called inside <tt class="function">WITH-TRANSACTION</tt>.
Returns <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a>.
</dd>
<!--RUN-SQL--><dt><tt class="sexp">(ORACLE:RUN-SQL
<i class="replaceable"><tt>sql</tt></i>
<a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;OPTIONAL</tt></a>
<i class="replaceable"><tt>params</tt></i>
<i class="replaceable"><tt>is-select</tt></i>)</tt></dt><dd><p>Execute a SQL statement.  Must be <tt class="function">CONNECT</tt>ed
to a database.  Returns the number of rows affected by the SQL operation,
for non-SELECT statements, zero for SELECT statements.  For
destructive database operations (INSERT, UPDATE, DELETE), the results
are committed to the database immediately if
<i class="replaceable"><tt>auto-commit</tt></i> when establishing the current
connection; see <tt class="function">CONNECT</tt>.  The meaning of the
arguments is as follows: </p><div class="variablelist"><p class="title"><b>Arguments for <tt class="function">RUN-SQL</tt></b></p><dl><dt><i class="replaceable"><tt>sql</tt></i></dt><dd>Text of SQL statement, as a string.
   The <i class="replaceable"><tt>sql</tt></i> statement may contain
   <a href="http://www.oracle.com" target="_top">Oracle</a> "named parameters," e.g. ":myparam" whose values will
   be substituted from the parameters given
   in <i class="replaceable"><tt>params</tt></i>.
</dd><dt><i class="replaceable"><tt>params</tt></i></dt><dd>A mapping of the names of the bind-parameters in the
   query to their values.  The set of named parameters in the query must
   match exactly the keys mapped by <i class="replaceable"><tt>params</tt></i>.
   The mapping may be passed as either (1) a hash table whose keys are
   the named parameters or (2) a list of pairs, ((name value) (name
   value) ...).  Parameter values passed from Lisp are converted to the
   appropriate <a href="http://www.oracle.com" target="_top">Oracle</a> data types (see <tt class="function">FETCH</tt>).
</dd><dt><i class="replaceable"><tt>is-select</tt></i></dt><dd>Flag: whether the statement is a SELECT query.  You
   usually do not need to set this as it is detected by default based on
   the SQL text.  However, there are situations, such as when a SELECT
   query begins with comment, that you need to specify it explicitly.
</dd></dl></div></dd>
<!--DO-ROWS--><dt><tt class="sexp">(ORACLE:DO-ROWS
<i class="replaceable"><tt>vars</tt></i> <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-4.html" target="_top"><tt class="literal">&amp;BODY</tt></a> <i class="replaceable"><tt>body</tt></i>)</tt></dt><dd><p> Macro which loops over a SQL SELECT result,
   evaluating, for each row in the result, the forms in <i class="replaceable"><tt>body</tt></i>,
   binding symbols given in <i class="replaceable"><tt>vars</tt></i> to
   corresponding database columns in the SELECT result.  The
   argument <i class="replaceable"><tt>vars</tt></i> must be a non-empty list of
   symbols matching a subset of the columns of an active SELECT query.
   If a SELECT column is an <a href="http://www.oracle.com" target="_top">Oracle</a> expression such as
   <tt class="literal">SUBSTR(mycol, 1, 10)</tt>, it is recommended to use a
   column alias, e.g., <tt class="literal">SELECT SUBSTR(mycol, 1, 10) AS
    myvar</tt>, in which case the column alias will be used as the
   symbol bound to the column value.</p><p>As <tt class="function">DO-ROWS</tt> expands into a <a href="http://www.lisp.org/HyperSpec/Body/mac_docm_dost.html" target="_top"><tt class="function">DO*</tt></a>
   loop, it may be terminated prematurely, before all rows are fetched,
   by using <a href="http://www.lisp.org/HyperSpec/Body/mac_return.html" target="_top"><tt class="function">RETURN</tt></a> anywhere in <i class="replaceable"><tt>body</tt></i>.</p><p>It is allowed to call <tt class="function">CONNECT</tt> in the
   <i class="replaceable"><tt>body</tt></i> of the loop, but only to switch the connection to a database
   other than the one that was used to do the SELECT.  This is useful
   for reading from one database while writing to another.
  </p><p>In <i class="replaceable"><tt>vars</tt></i>, instead of a single
   symbol, a pair (<i class="replaceable"><tt>bound-var</tt></i>
   <i class="replaceable"><tt>"column-name"</tt></i>) may be specified, which
   will cause values from the SELECTed column or alias ,
   <i class="replaceable"><tt>column-name</tt></i>, to be bound to Lisp variable,
   <i class="replaceable"><tt>bound-var</tt></i>.  This is for unusual cases
   where a Lisp variable cannot be created with the same name as the
   column (e.g., a column named "T"), or when it is inconvenient or
   impossible to alias the column with <tt class="literal">SELECT ... AS</tt>.
</p></dd>
<!--FETCH--><dt><tt class="sexp">(ORACLE:FETCH
   <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;OPTIONAL</tt></a> <i class="replaceable"><tt>result-type</tt></i>)</tt></dt><dd><p>Fetch a single row of data.  Returns a row of values
   corresponding to the columns of an active SELECT statment.  The row
   data is returned in one of three different forms, depending on the
   value of the symbol <i class="replaceable"><tt>result-type</tt></i>:
</p><div class="variablelist"><p class="title"><b>Return values for <tt class="function">FETCH</tt></b></p><dl><dt><tt class="classname">ARRAY</tt></dt><dd>Values will be returned in an <a href="http://www.lisp.org/HyperSpec/Body/syscla_array.html" target="_top"><tt class="classname">ARRAY</tt></a> with the
    same number of columns as in the SELECT statement, in the same
    order.  This is the default.</dd><dt><tt class="classname">PAIRS</tt></dt><dd>A list of pairs, <tt class="literal">((column, value)
     ...)</tt> is be returned.  The number and order of pairs is
    the same as the columns in the SELECT statement.
 </dd><dt><tt class="classname">HASH</tt></dt><dd>A <a href="http://www.lisp.org/HyperSpec/Body/syscla_hash-table.html" target="_top"><tt class="classname">HASH-TABLE</tt></a> whose keys are the column names
    and whose values are the column values in the row.  The SELECT
    columns <span class="emphasis"><em>must be unique</em></span> and be valid Lisp
    symbols to use this option. If you are SELECTing an expression, you
    probably want to use a column alias: <tt class="literal">SELECT &lt;expr&gt; AS
    some_alias ...</tt></dd></dl></div><p>The following data type conversions are done between <a href="http://www.oracle.com" target="_top">Oracle</a>
 datatypes and <a href="http://www.lisp.org" target="_top"><span><b class="command">Common Lisp</b></span></a> data types:
 </p><div class="informaltable"><table border="1"><colgroup><col /><col /></colgroup><thead><tr><th><a href="http://www.oracle.com" target="_top">Oracle</a> type</th><th>Converts to/from <a href="http://www.lisp.org" target="_top"><span><b class="command">Common Lisp</b></span></a> type</th></tr></thead><tbody><tr><td>Numeric (NUMBER, INTEGER, FLOAT)</td><td>The appropriate <a href="http://www.lisp.org" target="_top"><span><b class="command">Common Lisp</b></span></a> numeric type (<a href="http://www.lisp.org/HyperSpec/Body/typ_fixnum.html" target="_top"><tt class="classname">FIXNUM</tt></a>, <a href="http://www.lisp.org/HyperSpec/Body/typ_bignum.html" target="_top"><tt class="classname">BIGNUM</tt></a>,
      <a href="http://www.lisp.org/HyperSpec/Body/syscla_float.html" target="_top"><tt class="classname">FLOAT</tt></a>)</td></tr><tr><td>String (CHAR, VARCHAR, VARCHAR2)</td><td>A <a href="http://www.lisp.org" target="_top"><span><b class="command">Common Lisp</b></span></a><a href="http://www.lisp.org/HyperSpec/Body/syscla_string.html" target="_top"><tt class="classname">STRING</tt></a>.  Note that CHAR will be padded out to its
      full, fixed length as defined in <a href="http://www.oracle.com" target="_top">Oracle</a>; VARCHAR will be a
      string of variable length.  Also note that <a href="http://www.oracle.com" target="_top">Oracle</a> has no
      "zero-length string" value - it returns the SQL special value
      <tt class="constant">NULL</tt> which is converted to <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a> (see below).</td></tr><tr><td>DATE</td><td>A string of the form "YYYY-MM-DD HH:MM:SS" where HH is
      24-hour form.  If you want dates formatted differently, convert
      them to strings in <a href="http://www.oracle.com" target="_top">Oracle</a> using <tt class="literal">SELECT
       TO_CHAR(mydate, '<i class="replaceable"><tt>template</tt></i>') AS
       mydate</tt>; the result will then be returned as a string,
      formatted as per <i class="replaceable"><tt>template</tt></i>.</td></tr><tr><td>RAW, LONG RAW</td><td>A hexadecimal string, with two hex digits for each byte of
      <a href="http://www.oracle.com" target="_top">Oracle</a> data.  Note that this means the Lisp string will be
      twice the size, in bytes, as the <a href="http://www.oracle.com" target="_top">Oracle</a> data.</td></tr><tr><td>"Large" types (LONG, BLOB, CLOB)</td><td>A Lisp string of (arbitrary, possibly binary) data.  Note
      that truncation may occur; see the <tt class="function">CONNECT</tt>
      parameters <i class="replaceable"><tt>long-len</tt></i>
      and <i class="replaceable"><tt>truncate-ok</tt></i>.</td></tr><tr><td><tt class="constant">NULL</tt></td><td>The <a href="http://www.lisp.org" target="_top"><span><b class="command">Common Lisp</b></span></a> value <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a></td></tr></tbody></table></div><p>
</p></dd>
<!--FETCH-ALL--><dt><tt class="sexp">(ORACLE:FETCH-ALL
<a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;OPTIONAL</tt></a>
<i class="replaceable"><tt>max-rows</tt></i>
<i class="replaceable"><tt>result-type</tt></i>
<i class="replaceable"><tt>item-type</tt></i>)</tt></dt><dd><p>Fetch some or all the rows from a query and return
result as a sequence of sequences.  Arguments are all optional:
<i class="replaceable"><tt>max-rows</tt></i> limits the result to
that numbers of rows;
<i class="replaceable"><tt>result-type</tt></i> is the type of
sequence of the rows, either
'<tt class="classname">ARRAY</tt> (the default) or
'<tt class="classname">LIST</tt>;
<i class="replaceable"><tt>item-type</tt></i> is the type of
sequence of the column values for each row, either
'<tt class="classname">ARRAY</tt> (the default) or
'<tt class="classname">LIST</tt>.
Each row fetched always contains the full set of column values SELECTed.
</p><p>
<tt class="function">FETCH-ALL</tt> is often useful in conjunction with
<tt class="function">MAP</tt> or <tt class="function">REDUCE</tt> to iterate
over an entire SELECT result to construct a single Lisp value.

</p></dd>
<!--PEEK--><dt><tt class="sexp">(ORACLE:PEEK
<a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;OPTIONAL</tt></a>
<i class="replaceable"><tt>result-type</tt></i>)</tt></dt><dd>

Peek at next row of data (without fetching it).  Returns a row ala
<tt class="function">FETCH</tt>, except does not advance to the next row.
Repeated calls to <tt class="function">PEEK</tt> will thus return the same
row of data.  Returns <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a> if at EOF.  If data is available, returns
row data just as <tt class="function">FETCH</tt> (see
<tt class="function">FETCH</tt> for data format and conversions done).
Optional argument <i class="replaceable"><tt>result-type</tt></i> is the type
of sequence of the column values for the returned row, either
'<tt class="classname">ARRAY</tt> (the default) or
'<tt class="classname">LIST</tt>.  <tt class="function">PEEK</tt> is a useful look-ahead
for database reporting functions that may need to "break" on changes in
data to print headers, summaries, etc.
</dd>
<!--COLUMNS--><dt><tt class="sexp">(ORACLE:COLUMNS)</tt></dt><dd><p>Returns information on the columns of a SELECT
  result, in the form of an array of SQLCOL structures, one for each
  result column in the most recent SELECT statement.  It is not
  necessary to have called <tt class="function">FETCH</tt> before requesting
  column information on the query, however the query must have been
  compiled and executed with <tt class="function">RUN-SQL</tt>.  Each SQLCOL
  structure has these slots:
</p><div class="variablelist"><p class="title"><b>Slots of <tt class="classname">SQLCOL</tt></b></p><dl><dt>NAME</dt><dd>The <a href="http://www.oracle.com" target="_top">Oracle</a> column name or the expression
    selected.  If the query used a column alias, <tt class="literal">SELECT
     <i class="replaceable"><tt>expr</tt></i> AS
     <i class="replaceable"><tt>alias</tt></i></tt>, then
    <i class="replaceable"><tt>alias</tt></i> will be returned as the column name.
 </dd><dt>TYPE</dt><dd><a href="http://www.oracle.com" target="_top">Oracle</a> data type (VARCHAR, NUMBER, DATE, ...)
 </dd><dt>SIZE</dt><dd><a href="http://www.oracle.com" target="_top">Oracle</a> data length (useful mostly for
    character types)</dd><dt>SCALE</dt><dd>For numeric types, number of digits to right of
    decimal</dd><dt>PRECISION</dt><dd>For numeric types, total number of significant
    digits</dd><dt>NULL_OK</dt><dd><a href="http://www.lisp.org/HyperSpec/Body/convar_t.html" target="_top"><tt class="constant">T</tt></a> if <tt class="constant">NULL</tt>s allowed, <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a> if <tt class="constant">NULL</tt>s are
    not allowed.</dd></dl></div><p>To access the values of the SQLCOL structures, use the standard
 accessor functions, e.g., <tt class="literal">(ORACLE:SQLCOL-NAME (elt
  (ORACLE:COLUMNS) 0))</tt></p></dd>
<!--EOF--><dt><tt class="sexp">(ORACLE:EOF)</tt></dt><dd>
Returns EOF status.  A SELECT query cursor is considered at EOF if the next
FETCH would return no data.  Must be connected to a database, and have
an active SELECT statement.
</dd>
<!--INSERT-ROW--><dt><tt class="sexp">(ORACLE:INSERT-ROW
<i class="replaceable"><tt>table</tt></i>
<i class="replaceable"><tt>values</tt></i>)</tt></dt><dd>
Inserts a single row into <i class="replaceable"><tt>table</tt></i>.
Second argument <i class="replaceable"><tt>values</tt></i> is a map of
column names to values: either a hash table whose keys are the column
names, or a list of (name, value) pairs.  Columns missing from the map
will be given the default <a href="http://www.oracle.com" target="_top">Oracle</a> value, or <tt class="constant">NULL</tt>.
Returns the number of rows inserted (i.e., always 1).
</dd>
<!--UPDATE-ROW--><dt><tt class="sexp">(ORACLE:UPDATE-ROW
<i class="replaceable"><tt>table</tt></i>
<i class="replaceable"><tt>condition</tt></i>
<i class="replaceable"><tt>vals</tt></i>
<a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;OPTIONAL</tt></a>
<i class="replaceable"><tt>params</tt></i>)</tt></dt><dd>
Updates rows in <i class="replaceable"><tt>table</tt></i>.  Second argument
<i class="replaceable"><tt>condition</tt></i> is a string expression for a WHERE
clause (without the "WHERE") which determines which rows are updated.
Third argument <i class="replaceable"><tt>vals</tt></i> is a map of columns to
be updated to their new values: a hash table whose keys are column
names, or list of (name, value) pairs.  Optional
<i class="replaceable"><tt>params</tt></i> specifies values for named
parameters that may occur in <i class="replaceable"><tt>condition</tt></i>,
e.g., when the condition is a match on a primary key, e.g.: <tt class="literal">"pk_column
= :pk_val"</tt>.  Returns the number of rows updated.
</dd>
<!--ROW-COUNT--><dt><tt class="sexp">(ORACLE:ROW-COUNT)</tt></dt><dd>
For SELECT statements, returns the number of rows
<tt class="function">FETCH</tt>ed (<span class="emphasis"><em>not</em></span>
<tt class="function">PEEK</tt>ed) so far.  For other statements (e.g.,
INSERT, UPDATE, DELETE), returns the number of rows affected by the
last operation (e.g., inserted, updated, deleted).  Must be connected
to a database and have an active SQL statement.
</dd>
<!--WITH-TRANSACTION--><dt><tt class="sexp">(ORACLE:WITH-TRANSACTION
<a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-4.html" target="_top"><tt class="literal">&amp;BODY</tt></a>
<i class="replaceable"><tt>body</tt></i>)</tt></dt><dd>

Evaluates the forms in <i class="replaceable"><tt>body</tt></i> atomically as a
database transaction, ensuring that either all the database operations
done in <i class="replaceable"><tt>body</tt></i> complete successfully, or none
of them do.  If pending (un-committed) changes exist when this macro
is entered, they are <span class="emphasis"><em>rolled back</em></span> (undone), so
that the database is affected only by the subsequent updates inside
<i class="replaceable"><tt>body</tt></i>.  Nesting of
<tt class="function">WITH-TRANSACTION</tt> blocks is not allowed and will
raise an error.  There is no effect on the status of
<i class="replaceable"><tt>auto-commit</tt></i> given in
<tt class="function">CONNECT</tt>; it resumes its previous state when the
macro exits.  The value of the <tt class="function">WITH-TRANSACTION</tt>
expression is that of the last form in <i class="replaceable"><tt>body</tt></i>.
</dd>
<!--COMMIT--><dt><tt class="sexp">(ORACLE:COMMIT)</tt></dt><dd>
Commits (makes permanent) any pending changes to the database.  The
<i class="replaceable"><tt>auto-commit</tt></i> parameter to
<tt class="function">CONNECT</tt> must not have been set to use this
function, nor can it be called inside a
<tt class="function">WITH-TRANSACTION</tt> block. Always returns NIL.
</dd>
<!--ROLLBACK--><dt><tt class="sexp">(ORACLE:ROLLBACK)</tt></dt><dd>
Rolls back (undoes and abandons) any pending changes to the database.
The <i class="replaceable"><tt>auto-commit</tt></i> parameter to
<tt class="function">CONNECT</tt> must not have been set to use this
function, nor can it be called inside a
<tt class="function">WITH-TRANSACTION</tt> block. Always returns NIL.
</dd>
<!--AUTO-COMMIT--><dt><tt class="sexp">(ORACLE:AUTO-COMMIT)</tt></dt><dd>
Toggles the state of <i class="replaceable"><tt>auto-commit</tt></i> initially
given to <tt class="function">CONNECT</tt> for the current connection.
With <i class="replaceable"><tt>auto-commit</tt></i> enabled, modifications to
the database are committed (made permanent) after each destructive SQL
operation made with calls to <tt class="function">RUN-SQL</tt>,
<tt class="function">INSERT-ROW</tt>, <tt class="function">UPDATE_ROW</tt>, etc.
With <i class="replaceable"><tt>auto-commit</tt></i> disabled, transactional
integrity is under the programmer's control and is managed either by
(1) explicitly calling <tt class="function">COMMIT</tt> or
<tt class="function">ROLLBACK</tt> to commit or undo the pending
operations, or (2) wrapping code blocks with database operations
inside the <tt class="function">WITH-TRANSACTION</tt> macro.
<tt class="function">AUTO-COMMIT</tt> returns the previous status of
<i class="replaceable"><tt>auto-commit</tt></i>.
<tt class="function">AUTO-COMMIT</tt> may not be called inside
<tt class="function">WITH-TRANSACTION</tt>.
</dd>
<!--=-=-==-=-==-=-==-=-==-=-==-=-= End of functions section-->
</dl></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ora-example"></a>30.2.6.8.2. <a href="http://www.oracle.com" target="_top">Oracle</a> Example</h5></div></div><div></div></div><p>
Below is a simple example script which uses <a href="http://www.oracle.com" target="_top">Oracle</a>'s demo database
schema, <tt class="literal">SCOTT</tt>.

</p><table border="0" bgcolor="#E0E0E0"><tr><td><pre class="programlisting">(setf server "orcl") ; Change this to your server's SID
(oracle:connect "scott" "tiger" server)

(oracle:run-sql "SELECT deptno, dname, loc FROM dept ORDER BY DNAME")
(oracle:do-rows (deptno dname loc)
  (format t "Dept. no is '~A', " deptno)
  (format t "Dept. name is '~A', " dname)
  (format t "Dept. loc is '~A'~%" loc))

(oracle:update-row "dept" "dname = :acctval" '(("dname" "NEWACCT")) '(("acctval" "ACCOUNTING")))

(oracle:run-sql "SELECT deptno, dname, loc FROM dept ORDER BY DNAME")
(oracle:do-rows (deptno dname loc)
  (format t "Dept. no is '~A', " deptno)
  (format t "Dept. name is '~A', " dname)
  (format t "Dept. loc is '~A'~%" loc))

(oracle:update-row "dept" "dname = :acctval" '(("dname" "ACCOUNTING")) '(("acctval" "NEWACCT")))
</pre></td></tr></table><p>
</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ora-config"></a>30.2.6.8.3. <a href="http://www.oracle.com" target="_top">Oracle</a> Configuration</h5></div></div><div></div></div><p>Obviously, a working <a href="http://www.oracle.com" target="_top">Oracle</a> environment is required.  It is
recommended that you first be able to log on and use the <a href="http://www.oracle.com" target="_top">Oracle</a>
SQL*Plus application to test your environment
<span class="emphasis"><em>before</em></span> attempting <a href="http://www.oracle.com" target="_top">Oracle</a> access via the
<a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a> module.
At a minimum you will need to set environment variables
<tt class="envar">ORACLE_HOME</tt> to the <a href="http://www.oracle.com" target="_top">Oracle</a> base directory and
<tt class="envar">LD_LIBRARY_PATH</tt> to include
<tt class="literal">$<tt class="envar">ORACLE_HOME</tt>/lib</tt> and possibly other
directories.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ora-build"></a>30.2.6.8.4. Building the <a href="http://www.oracle.com" target="_top">Oracle</a> Interface</h5></div></div><div></div></div><p>The module uses the <a href="http://www.oracle.com" target="_top">Oracle</a> Call Interface (<a href="http://www.vivtek.com/oracle.html" target="_top">OCI</a>)
<a href="http://www.eskimo.com/~scs/C-faq/top.html" target="_top"><span><b class="command">C</b></span></a> library.  To build the module you will need the <a href="http://www.oracle.com" target="_top">Oracle</a>
<a href="http://www.vivtek.com/oracle.html" target="_top">OCI</a> headers and link libraries; as a quick check, make sure
you have the file <tt class="filename">oci.h</tt> somewhere
under <tt class="envar">ORACLE_HOME</tt>, probably
in <tt class="filename">$<tt class="envar">ORACLE_HOME</tt>/rdbms/demo/oci.h</tt>.</p><p>

To build the module into <a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a>, specify
<span><b class="command">./configure ... --with-module=oracle ...</b></span>
at build time.
Thereafter, to load the <a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a> linking set which contains the module,
you need to run <a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a> with the option
<a href="clisp.html#opt-link-set"><tt class="option">-K
  full</tt></a>.
You can test that you really have the <a href="http://www.oracle.com" target="_top">Oracle</a>-enabled <a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a> by
evaluating <tt class="sexp">(<a href="http://www.lisp.org/HyperSpec/Body/fun_describe.html" target="_top"><tt class="function">DESCRIBE</tt></a> 'oracle:connect)</tt>
It may be necessary to edit the Makefile in the
<tt class="filename">modules/oracle</tt> subdirectory of the distribution
prior to running <span><b class="command">./configure</b></span>.


</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="fastcgi"></a>30.2.6.9. The <a href="http://www.fastcgi.com" target="_top">FastCGI</a> Interface</h4></div></div><div></div></div><div class="toc"><dl><dt><span class="section"><a href="modules.html#fcgi-overview">30.2.6.9.1. Overview of FastCGI</a></span></dt><dt><span class="section"><a href="modules.html#fcgi-functionality">30.2.6.9.2. Functions in Package FASTCGI</a></span></dt><dt><span class="section"><a href="modules.html#fcgi-example">30.2.6.9.3. FastCGI Example</a></span></dt><dt><span class="section"><a href="modules.html#fcgi-build">30.2.6.9.4. Building and configuring the
  FastCGI Interface</a></span></dt></dl></div><p>
The <a href="http://www.fastcgi.com" target="_top">FastCGI</a> module speeds up <a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a> CGI
scripts launched by a Web server.  Working with a
<a href="http://www.fastcgi.com" target="_top">FastCGI</a>-enabled Web server such as <a href="http://www.apache.org/" target="_top">Apache</a> with
<a href="http://www.fastcgi.com/mod_fastcgi/docs/mod_fastcgi.html" target="_top">mod_fastcgi</a>, a <a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a> program using the <a href="http://www.fastcgi.com" target="_top">FastCGI</a>
protocol will run many times faster than a conventional CGI program.
The performance improvements stem from the fact that the script's
process remains running across <a href="http://www.w3.org/Protocols/" target="_top"><span><b class="command">HTTP</b></span></a> requests, eliminating startup
overhead and allowing for caching of data structures and other resources.  This
is the same approach used is in other languages (e.g., <a href="http://perl.apache.org" target="_top">mod_perl</a> for Perl).  </p><p>When this module is present, <a href="http://www.lisp.org/HyperSpec/Body/var_stfeaturesst.html" target="_top"><tt class="varname">*FEATURES*</tt></a> contains the
 symbol <tt class="constant">:FASTCGI</tt>.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="fcgi-overview"></a>30.2.6.9.1. Overview of <a href="http://www.fastcgi.com" target="_top">FastCGI</a></h5></div></div><div></div></div><p>
Traditional CGI programs work by doing input/output with the Web
server via the following channels:
</p><div class="orderedlist"><ol type="1"><li>
Examining environment variables; e.g., <tt class="envar">HTTP_USER_AGENT</tt> is the
variable set by the Web server to name the browser used
</li><li>
Reading from standard input.  E.g., to get input data in a "method=POST" request
</li><li>
Writing an <a href="http://www.w3.org/Protocols/" target="_top"><span><b class="command">HTTP</b></span></a> response document (usually "Content-type:
text/html") to the standard output, for eventual transmission
back to the browser client
</li><li>
Writing error messages to the standard error, usually captured
by the Web server and logged in its log files.
</li></ol></div><p>
</p><p>
<a href="http://www.fastcgi.com" target="_top">FastCGI</a> involves replacing calls the standard routines to do
the above with calls in the <strong class="package">“<span class="quote">FASTCGI</span>”</strong> package.  These calls will then
work exactly as before when the program is invoked as a CGI, but will
also work when invoked by a <a href="http://www.fastcgi.com" target="_top">FastCGI</a>-enabled Web server.
</p><p>
<a href="http://www.fastcgi.com" target="_top">FastCGI</a> programs persist across <a href="http://www.w3.org/Protocols/" target="_top"><span><b class="command">HTTP</b></span></a> requests, and thus incur
startup overhead costs only once.  For Lisp Web programs, this overhead
can be substantial: code must be
compiled and loaded, files and databases must be opened, etc.  Further,
because the program stays running from <a href="http://www.w3.org/Protocols/" target="_top"><span><b class="command">HTTP</b></span></a> request to <a href="http://www.w3.org/Protocols/" target="_top"><span><b class="command">HTTP</b></span></a> request,
it can cache information in memory such as database connections
or large in-memory data structures.

</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="fcgi-functionality"></a>30.2.6.9.2. Functions in Package <strong class="package">“<span class="quote">FASTCGI</span>”</strong></h5></div></div><div></div></div><p>Access to
<a href="http://www.fastcgi.com" target="_top">FastCGI</a> is via these functions in package <strong class="package">“<span class="quote">FASTCGI</span>”</strong>.

</p><div class="variablelist">
<!--IS-CGI--><dl><dt><tt class="sexp">(FASTCGI:IS-CGI)</tt></dt><dd>
Returns <a href="http://www.lisp.org/HyperSpec/Body/convar_t.html" target="_top"><tt class="constant">T</tt></a> if the <a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a> program has been launched as a traditional
CGI rather than in <a href="http://www.fastcgi.com" target="_top">FastCGI</a>.  In traditional CGI, program I/O is
via operating system environment variables and standard file streams.
Under <a href="http://www.fastcgi.com" target="_top">FastCGI</a>, I/O is done directly with the Web server via
the <a href="http://www.fastcgi.com" target="_top">FastCGI</a> protocol.
</dd>
<!--ACCEPT--><dt>
<tt class="sexp">(FASTCGI:ACCEPT)</tt> <i class="replaceable"><tt>cgi-forms</tt></i>
<tt class="sexp">(FASTCGI:FINISH)</tt>
</dt><dd><p>
In <a href="http://www.fastcgi.com" target="_top">FastCGI</a> mode, the program loops,
<tt class="function">ACCEPT</tt>ing to begin the execution of an <a href="http://www.w3.org/Protocols/" target="_top"><span><b class="command">HTTP</b></span></a>
request, and <tt class="function">FINISH</tt>ing to signal that the script
is finished writing its response to the <a href="http://www.w3.org/Protocols/" target="_top"><span><b class="command">HTTP</b></span></a> request.  <tt class="function">ACCEPT</tt>
blocks until the next <a href="http://www.w3.org/Protocols/" target="_top"><span><b class="command">HTTP</b></span></a> request comes in, returning <a href="http://www.lisp.org/HyperSpec/Body/convar_t.html" target="_top"><tt class="constant">T</tt></a> if there is
a new request to handle, and <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a> if no more <a href="http://www.w3.org/Protocols/" target="_top"><span><b class="command">HTTP</b></span></a> requests will
occur, usually because the Web server itself has terminated, in which
case the <a href="http://www.fastcgi.com" target="_top">FastCGI</a> server loop should also exit.
</p><p>
A typical <a href="http://www.fastcgi.com" target="_top">FastCGI</a> top-level server loop looks like:
</p><table border="0" bgcolor="#E0E0E0"><tr><td><pre class="programlisting">    (do ()
	((not (fastcgi:accept)))
	(run-my-script)
        (fastcgi:finish))
</pre></td></tr></table><p>

</p></dd>
<!--GETENV--><dt><tt class="sexp">(FASTCGI:GETENV
<i class="replaceable"><tt>varname</tt></i>)</tt></dt><dd>
Use in place of <a href="getenv.html" title="30.9. Extensions-2.9. Operating System&#10;  Environment."><tt class="function">EXT:GETENV</tt></a> to get the value of the environment variable
named <i class="replaceable"><tt>varname</tt></i>, which should be a string.
Unlike <a href="getenv.html" title="30.9. Extensions-2.9. Operating System&#10;  Environment."><tt class="function">EXT:GETENV</tt></a>, which accesses the actual host operating system environment,
<tt class="function">FASTCGI:GETENV</tt> obtains its environment via
the Web server, over its FastCGI communications channel.
For more information, see the <a href="http://www.fastcgi.com" target="_top">FastCGI</a> Web site.
Returns <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><tt class="constant">NIL</tt></a> if <i class="replaceable"><tt>varname</tt></i> is not defined in
the operating system environment.  See <a href="http://www.cgi101.com/class/ch3/text.html" target="_top">here</a> for a
list of useful variables.  You must first have called
<tt class="function">ACCEPT</tt> and not yet have called
<tt class="function">FINISH</tt>.  </dd>
<!--WRITE-STDOUT--><dt><tt class="sexp">(FASTCGI:WRITE-STDOUT
<i class="replaceable"><tt>string</tt></i>)</tt></dt><dd>
Use in place of standard Lisp calls which print to standard output
(i.e., as part of the <a href="http://www.w3.org/Protocols/" target="_top"><span><b class="command">HTTP</b></span></a> response).
You must first have called <tt class="function">ACCEPT</tt> and not yet have
called <tt class="function">FINISH</tt>.
</dd>
<!--WRITE-STDERR--><dt><tt class="sexp">(FASTCGI:WRITE-STDERR
<i class="replaceable"><tt>string</tt></i>)</tt></dt><dd>
Use in place of standard Lisp calls which print to
standard error. Rather than being part of
the <a href="http://www.w3.org/Protocols/" target="_top"><span><b class="command">HTTP</b></span></a> response, data written to standard error are usually
collected by the Web server in its error log.  This is useful
for diagnostic purposes.
</dd>
<!--SLURP-STDIN--><dt><tt class="sexp">(FASTCGI:SLURP-STDIN)</tt></dt><dd>
Reads in the entirety of standard input and returns it as a string.
This is usually done for <a href="http://www.w3.org/Protocols/" target="_top"><span><b class="command">HTTP</b></span></a> requests with
<tt class="literal">METHOD="post"</tt>, when the data are passed to the CGI
script via standard input rather than via the environment variable
<tt class="envar">QUERY_STRING</tt>.  There is no way to read standard input
in pieces, which could be a problem, say, for <a href="http://www.w3.org/Protocols/" target="_top"><span><b class="command">HTTP</b></span></a> uploads of very large files.
</dd>
<!--OUT-->
<dt><tt class="sexp">(FASTCGI:OUT
<i class="replaceable"><tt>tree</tt></i>)</tt></dt><dd>
Like <tt class="function">WRITE-STDOUT</tt>, except that
<i class="replaceable"><tt>tree</tt></i>
may be an arbitrarily nested list structure containing (at the leaves)
numbers and strings.  For example,
<tt class="literal">(FASTCGI:OUT '("foo" (" " 10 " " 20)))</tt>
will write the string <tt class="literal">"foo 10 20"</tt>.  This function
is useful when building strings in memory for display.
</dd></dl></div><p>

</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="fcgi-example"></a>30.2.6.9.3. <a href="http://www.fastcgi.com" target="_top">FastCGI</a> Example</h5></div></div><div></div></div><p>

Below is a simple example CGI script using <a href="http://www.fastcgi.com" target="_top">FastCGI</a>.

</p><table border="0" bgcolor="#E0E0E0"><tr><td><pre class="programlisting">#!/usr/local/bin/clisp -q -K full

(defun newline () (format nil "~%"))
(do ((count 1 (1+ count)))
	((not (fastcgi:accept)) nil)

    (fastcgi:out "Content-type: text/plain" (newline) (newline))
    (fastcgi:out
     "I am running in mode: " (if (fastcgi:is-cgi) "CGI" "FastCGI") (newline)
     "This is execution no.: " count (newline)
     "The browser string is '" (fastcgi:getenv "HTTP_USER_AGENT") "'" (newline))

    (fastcgi:finish))
</pre></td></tr></table><p>

</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="fcgi-build"></a>30.2.6.9.4. Building and configuring the
  <a href="http://www.fastcgi.com" target="_top">FastCGI</a> Interface</h5></div></div><div></div></div><p>
It is necessary to download the <a href="http://www.fastcgi.com" target="_top">FastCGI</a> developers' kit, build it,
and install it, before building <a href="http://clisp.cons.org" target="_top"><span><b class="command">CLISP</b></span></a> with <a href="http://www.fastcgi.com" target="_top">FastCGI</a> support.
You also need to upgrade your Web server to speak the <a href="http://www.fastcgi.com" target="_top">FastCGI</a>
protocol.  For <a href="http://www.apache.org/" target="_top">Apache</a> this means building in <a href="http://www.fastcgi.com/mod_fastcgi/docs/mod_fastcgi.html" target="_top">mod_fastcgi</a>, either statically
or dynamically, and then adding a line to your <a href="http://www.apache.org/" target="_top">Apache</a> config like:
</p><table border="0" bgcolor="#E0E0E0"><tr><td><pre class="programlisting">    Addhandler fastcgi-script .fcgi
</pre></td></tr></table><p>
After that, you can convert <tt class="filename">foo.cgi</tt> by linking it
to a script names <tt class="filename">foo.fcgi</tt>.  Since a <a href="http://www.fastcgi.com" target="_top">FastCGI</a>
script is also a valid CGI script, it can be run unmodified in either
mode.
</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="rawsock"></a>30.2.6.10. Raw Socket Access.</h4></div></div><div></div></div><p>This is the raw socket interface, as described in <a href="http://www.opengroup.org/onlinepubs/007904975/basedefs/syssocket.h.html" target="_top"><tt class="filename">sys/socket.h</tt></a>.
Sockets are represented by their <a href="http://www.lisp.org/HyperSpec/Body/typ_fixnum.html" target="_top"><tt class="classname">FIXNUM</tt></a> <a href="http://www.opengroup.org/onlinepubs/007904975/basedefs/xbd_chap03.html#tag_03_165" target="_top">file descriptor</a>s.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="rawsock-use-sockets"></a>Use <tt class="classname">SOCKET:SOCKET-STREAM</tt> instead!</h3><p>This interface is very low-level, and you probably do not need
 it - unless you are doing something <span class="emphasis"><em>very</em></span> unusual.
 If you are interested in TCP/IP (Internet) sockets, you should use
 <a href="socket.html" title="30.5. Extensions-2.5. Socket Streams"><tt class="classname">SOCKET:SOCKET-STREAM</tt></a>s, <span class="emphasis"><em>not</em></span> this package.</p></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="rawsock-not-streams"></a>Do not use <tt class="function">EXT:MAKE-STREAM</tt>!</h3><p>You can turn such a raw socket into a usual lisp <a href="http://www.lisp.org/HyperSpec/Body/syscla_stream.html" target="_top"><tt class="classname">STREAM</tt></a>
  using <a href="stream-dict.html#make-stream" title="21.3.2. Function EXT:MAKE-STREAM"><tt class="function">EXT:MAKE-STREAM</tt></a>, but you should be <span class="emphasis"><em>extremely</em></span>
  careful with such dubious actions!  See the <tt class="email">&lt;<a href="mailto:clisp-devel/at/sf.net"><a href="http://lists.sourceforge.net/lists/listinfo/clisp-devel" target="_top">clisp-devel/at/sf.net</a></a>&gt;</tt>
  <a href="http://sourceforge.net/mailarchive/message.php?msg_id=7203955" target="_top">mailing list archives</a> for more details.</p></div><p>We implement access to
 </p><table class="simplelist" border="0" summary="Simple list"><tr><td><a href="http://www.opengroup.org/onlinepubs/007904975/functions/accept.html" target="_top"><tt class="function">accept</tt></a></td><td><a href="http://www.opengroup.org/onlinepubs/007904975/functions/getsockname.html" target="_top"><tt class="function">getsockname</tt></a></td><td><a href="http://www.opengroup.org/onlinepubs/007904975/functions/recvmsg.html" target="_top"><tt class="function">recvmsg</tt></a></td><td><a href="http://www.opengroup.org/onlinepubs/007904975/functions/socket.html" target="_top"><tt class="function">socket</tt></a></td></tr><tr><td><a href="http://www.opengroup.org/onlinepubs/007904975/functions/bind.html" target="_top"><tt class="function">bind</tt></a></td><td><a href="http://www.opengroup.org/onlinepubs/007904975/functions/listen.html" target="_top"><tt class="function">listen</tt></a></td><td><a href="http://www.opengroup.org/onlinepubs/007904975/functions/send.html" target="_top"><tt class="function">send</tt></a></td><td><a href="http://www.opengroup.org/onlinepubs/007904975/functions/socketpair.html" target="_top"><tt class="function">socketpair</tt></a></td></tr><tr><td><a href="http://www.opengroup.org/onlinepubs/007904975/functions/connect.html" target="_top"><tt class="function">connect</tt></a></td><td><a href="http://www.opengroup.org/onlinepubs/007904975/functions/recv.html" target="_top"><tt class="function">recv</tt></a></td><td><a href="http://www.opengroup.org/onlinepubs/007904975/functions/sendmsg.html" target="_top"><tt class="function">sendmsg</tt></a></td><td><a href="http://www.opengroup.org/onlinepubs/007904975/functions/shutdown.html" target="_top"><tt class="function">shutdown</tt></a></td></tr><tr><td><a href="http://www.opengroup.org/onlinepubs/007904975/functions/getpeername.html" target="_top"><tt class="function">getpeername</tt></a></td><td><a href="http://www.opengroup.org/onlinepubs/007904975/functions/recvfrom.html" target="_top"><tt class="function">recvfrom</tt></a></td><td><a href="http://www.opengroup.org/onlinepubs/007904975/functions/sendto.html" target="_top"><tt class="function">sendto</tt></a></td><td> </td></tr></table><p>
 using same-named lisp functions in package
 <strong class="package">“<span class="quote">RAWSOCK</span>”</strong>.
 Additionally,</p><div class="itemizedlist"><ul type="disc"><li><tt class="function">RAWSOCK:SOCK-READ</tt>
    calls <a href="http://www.opengroup.org/onlinepubs/007904975/functions/read.html" target="_top"><tt class="function">read</tt></a>;</li><li><tt class="function">RAWSOCK:SOCK-WRITE</tt>
    calls <a href="http://www.opengroup.org/onlinepubs/007904975/functions/write.html" target="_top"><tt class="function">write</tt></a>;</li><li><tt class="function">RAWSOCK:SOCK-CLOSE</tt>
   calls <a href="http://www.opengroup.org/onlinepubs/007904975/functions/close.html" target="_top"><tt class="function">close</tt></a>.</li></ul></div><p>We do not interface to <a href="http://www.opengroup.org/onlinepubs/007904975/functions/getsockopt.html" target="_top"><tt class="function">getsockopt</tt></a> and <a href="http://www.opengroup.org/onlinepubs/007904975/functions/setsockopt.html" target="_top"><tt class="function">setsockopt</tt></a>,
 they are available through <a href="socket.html#so-opt"><tt class="function">SOCKET:SOCKET-OPTIONS</tt></a>.</p><p>We do not interface to <a href="http://www.opengroup.org/onlinepubs/007904975/functions/select.html" target="_top"><tt class="function">select</tt></a>,
 it is available through <a href="socket.html#so-status"><tt class="function">SOCKET:SOCKET-STATUS</tt></a>.</p><p>We do not interface to <a href="http://www.opengroup.org/onlinepubs/007904975/functions/poll.html" target="_top"><tt class="function">poll</tt></a> yet, patches are welcome.</p><div class="variablelist"><a id="rawsock-add-on"></a><p class="title"><b>Additional Functions</b></p><dl><dt><tt class="sexp">(RAWSOCK:MAKE-SOCKADDR
    <i class="replaceable"><tt>family</tt></i>
    <i class="replaceable"><tt>data</tt></i>)</tt></dt><dd>create a <span class="type">sockaddr</span> object.
 </dd><dt><tt class="sexp">(RAWSOCK:SOCKADDR-FAMILY
    <i class="replaceable"><tt>sockaddr</tt></i>)</tt></dt><dd>return the numeric family of a
    <span class="type">sockaddr</span> object.</dd><dt><tt class="sexp">(RAWSOCK:SOCKADDR-DATA
    <i class="replaceable"><tt>sockaddr</tt></i>)</tt></dt><dd>return a <a href="http://www.lisp.org/HyperSpec/Body/glo_f.html#fresh" target="_top">fresh</a> data vector of a
    <span class="type">sockaddr</span> object.</dd><dt><tt class="sexp">(RAWSOCK:OPEN-UNIX-SOCKET
    <i class="replaceable"><tt>pathname</tt></i> <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><tt class="literal">&amp;OPTIONAL</tt></a> <i class="replaceable"><tt>type</tt></i>)</tt></dt><dd>open a <a href="http://www.UNIX-systems.org/online.html" target="_top"><strong>UNIX</strong></a> socket special file.
 </dd></dl></div></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="screen.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="platform.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="dffi.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">30.1. Extensions-2.1. Random Screen Access </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 30.3. Extensions-2.3. The Foreign Function Call Facility</td></tr></table></div><div class="custom-footer"><hr width="100%" /><table width="100%"><tr><td align="left"><a href="http://clisp.cons.org"><img src="clisp.png" width="48" height="48" alt="[CLISP home]" /></a></td><td align="center"><a href="http://www.gnu.org"><img src="http://www.gnu.org/graphics/gnubanner.jpg" width="468" height="60" alt="[Come and see what GNU creates for YOU]" /></a></td><td align="right"><a href="http://sourceforge.net"><img src="http://sourceforge.net/sflogo.php?group_id=1355&amp;amp;type=2" width="125" height="37" alt="[SourceForge]" /></a></td></tr></table></div></body></html>
