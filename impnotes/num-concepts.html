<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:cf="http://docbook.sourceforge.net/xmlns/chunkfast/1.0"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>12.2. Number Concepts
   [CLHS-12.1]</title><link rel="stylesheet" href="impnotes.css" type="text/css" /><link rev="made" href="mailto:clisp-list@sf.net" /><meta name="generator" content="DocBook XSL Stylesheets V2005-07-12_04:47_snapshot" /><link rel="start" href="index.html" title="Implementation Notes for GNU CLISP." /><link rel="up" href="numbers.html" title="Chapter 12. Numbers&#10;   [CLHS-12]" /><link rel="prev" href="num-types.html" title="12.1. Numeric Types" /><link rel="next" href="num-dict.html" title="12.3. The Numbers Dictionary&#10;   [CLHS-12.2]" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">12.2. Number Concepts
   [CLHS-12.1]</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="num-types.html">Prev</a> </td><th width="60%" align="center">Chapter 12. Numbers
   [CLHS-12]</th><td width="20%" align="right"> <a accesskey="n" href="num-dict.html">Next</a></td></tr></table><hr /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="num-concepts"></a>12.2. Number Concepts
   <a href="http://www.lisp.org/HyperSpec/Body/sec_12-1.html" target="_top">[CLHS-12.1]</a></h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="num-concepts.html#byte-type">12.2.1. Byte Operations on Integers
   [CLHS-12.1.1.3.2]</a></span></dt><dt><span class="section"><a href="num-concepts.html#float-subst">12.2.2. Rule of Float Substitutability
   [CLHS-12.1.3.3]</a></span></dt><dt><span class="section"><a href="num-concepts.html#float-comp">12.2.3. Floating-point Computations
   [CLHS-12.1.4]</a></span></dt><dd><dl><dt><span class="section"><a href="num-concepts.html#flocont">12.2.3.1. Rule of Float Precision Contagion
   [CLHS-12.1.4.4]</a></span></dt><dt><span class="section"><a href="num-concepts.html#floratcont">12.2.3.2. Rule of Float and Rational Contagion
   [CLHS-12.1.4.1]</a></span></dt></dl></dd><dt><span class="section"><a href="num-concepts.html#complex-comp">12.2.4. Complex Computations
   [CLHS-12.1.5]</a></span></dt><dt><span class="section"><a href="num-concepts.html#complex-rational">12.2.5. Rule of
   Canonical Representation for Complex Rationals
   [CLHS-12.1.5.3]</a></span></dt></dl></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="byte-type"></a>12.2.1. Byte Operations on Integers
   <a href="http://www.lisp.org/HyperSpec/Body/sec_12-1-1-3-2.html" target="_top">[CLHS-12.1.1.3.2]</a></h3></div></div></div><p>Byte specifiers are objects of built-in type <a href="num-concepts.html#byte-type" title="12.2.1. Byte Operations on Integers&#10;   [CLHS-12.1.1.3.2]"><span class="type">BYTE</span></a>,
 not <a href="http://www.lisp.org/HyperSpec/Body/syscla_integer.html" target="_top"><code class="classname">INTEGER</code></a>s.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="float-subst"></a>12.2.2. Rule of Float Substitutability
   <a href="http://www.lisp.org/HyperSpec/Body/sec_12-1-3-3.html" target="_top">[CLHS-12.1.3.3]</a></h3></div></div></div><p>When a mathematical function may return an exact (<a href="http://www.lisp.org/HyperSpec/Body/syscla_rational.html" target="_top"><code class="classname">RATIONAL</code></a>) or
 inexact (<a href="http://www.lisp.org/HyperSpec/Body/syscla_float.html" target="_top"><code class="classname">FLOAT</code></a>) result, it always returns the exact result.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="float-comp"></a>12.2.3. Floating-point Computations
   <a href="http://www.lisp.org/HyperSpec/Body/sec_12-1-4.html" target="_top">[CLHS-12.1.4]</a></h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="num-concepts.html#flocont">12.2.3.1. Rule of Float Precision Contagion
   [CLHS-12.1.4.4]</a></span></dt><dt><span class="section"><a href="num-concepts.html#floratcont">12.2.3.2. Rule of Float and Rational Contagion
   [CLHS-12.1.4.1]</a></span></dt></dl></div><p>There are four floating point types: <a href="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html" target="_top"><code class="classname">SHORT-FLOAT</code></a>,
 <a href="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html" target="_top"><code class="classname">SINGLE-FLOAT</code></a>, <a href="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html" target="_top"><code class="classname">DOUBLE-FLOAT</code></a> and <a href="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html" target="_top"><code class="classname">LONG-FLOAT</code></a>:
</p><div class="informaltable"><a id="floating-types-table"></a><table border="1"><colgroup><col /><col /><col /><col /><col /></colgroup><thead><tr><th align="center">type</th><th align="center">sign</th><th align="center">mantissa</th><th align="center">exponent</th><th align="center">comment</th></tr></thead><tbody><tr><td align="center"><a href="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html" target="_top"><code class="classname">SHORT-FLOAT</code></a></td><td align="center">1 bit</td><td align="center">16+1 bits</td><td align="center">8 bits</td><td align="center">immediate</td></tr><tr><td align="center"><a href="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html" target="_top"><code class="classname">SINGLE-FLOAT</code></a></td><td align="center">1 bit</td><td align="center">23+1 bits</td><td align="center">8 bits</td><td align="center"><a href="http://grouper.ieee.org/groups/754/" target="_top">IEEE 754</a></td></tr><tr><td align="center"><a href="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html" target="_top"><code class="classname">DOUBLE-FLOAT</code></a></td><td align="center">1 bit</td><td align="center">52+1 bits</td><td align="center">11 bits</td><td align="center"><a href="http://grouper.ieee.org/groups/754/" target="_top">IEEE 754</a></td></tr><tr><td align="center"><a href="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html" target="_top"><code class="classname">LONG-FLOAT</code></a></td><td align="center">1 bit</td><td align="center">&gt;=64 bits</td><td align="center">32 bits</td><td align="center">variable
 length</td></tr></tbody></table></div><p>The single and double float formats are those of the <a href="http://grouper.ieee.org/groups/754/" target="_top">IEEE 754</a>
 “<span class="quote">Standard for Binary Floating-Point Arithmetic</span>”,
 except that <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> does not support features like
 <code class="literal">±0</code>, <code class="literal">±inf</code>,
 <code class="literal">NaN</code>, gradual underflow, etc.
 <a href="http://www.lisp.org" target="_top"><span><strong class="command">Common Lisp</strong></span></a> does not make use of these features, so, to reduce portability
 problems, <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> by design returns the same floating point results on
 all platforms (<a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> has a floating-point emulation built in for
 platforms that do not support <a href="http://grouper.ieee.org/groups/754/" target="_top">IEEE 754</a>).  Note that
 </p><div class="itemizedlist"><ul type="disc"><li>When you got a <code class="literal">NaN</code>
    in your program, your program is broken, so you will spend time
    determining where the <code class="literal">NaN</code> came from.
    It is better to <a href="http://www.lisp.org/HyperSpec/Body/fun_signal.html" target="_top"><code class="function">SIGNAL</code></a> an <a href="http://www.lisp.org/HyperSpec/Body/contyp_error.html" target="_top"><code class="classname">ERROR</code></a> in this case.</li><li>When you got unnormalized floats in your program,
    your results will have a greatly reduced accuracy anyway.
    Since <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> has the means to cope with this - <a href="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html" target="_top"><code class="classname">LONG-FLOAT</code></a>s of
    <a href="num-concepts.html#lfd">variable precision</a> - it does not
    need unnormalized floats.</li></ul></div><p>
 This is why <a href="system-dict.html#features" class="olink"><code class="varname">*FEATURES*</code></a> does not contain the
 <code class="constant">:IEEE-FLOATING-POINT</code> keyword.</p><p><a id="lfd"></a><b>Arbitrary Precision Floats. </b><a href="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html" target="_top"><code class="classname">LONG-FLOAT</code></a>s have variable mantissa length, which is a
 multiple of 16 (or 32, depending on the word size of the processor).
 The default length used when <a href="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html" target="_top"><code class="classname">LONG-FLOAT</code></a>s are <a href="http://www.lisp.org/HyperSpec/Body/fun_readcm_re_g-whitespace.html" target="_top"><code class="function">READ</code></a> is given by the
 <a href="http://www.lisp.org/HyperSpec/Body/glo_p.html#place" target="_top">place</a> <code class="code">(<a href="num-concepts.html#lfd"><code class="function">EXT:LONG-FLOAT-DIGITS</code></a>)</code>.  It can be set by <code class="code">(<a href="http://www.lisp.org/HyperSpec/Body/mac_setfcm_psetf.html" target="_top"><code class="function">SETF</code></a> (<a href="num-concepts.html#lfd"><code class="function">EXT:LONG-FLOAT-DIGITS</code></a>) <em class="replaceable"><code>n</code></em>)</code>,
 where <em class="replaceable"><code>n</code></em> is a positive <a href="http://www.lisp.org/HyperSpec/Body/syscla_integer.html" target="_top"><code class="classname">INTEGER</code></a>.  E.g., <code class="code">(<a href="http://www.lisp.org/HyperSpec/Body/mac_setfcm_psetf.html" target="_top"><code class="function">SETF</code></a> (<a href="num-concepts.html#lfd"><code class="function">EXT:LONG-FLOAT-DIGITS</code></a>)
 3322)</code> sets the default precision of <a href="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html" target="_top"><code class="classname">LONG-FLOAT</code></a>s to about
 1000 decimal digits.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="flocont"></a>12.2.3.1. Rule of Float Precision Contagion
   <a href="http://www.lisp.org/HyperSpec/Body/sec_12-1-4-4.html" target="_top">[CLHS-12.1.4.4]</a></h4></div></div></div><p>The floating point contagion is controlled by the variable
 <a href="num-concepts.html#flocont" title="12.2.3.1. Rule of Float Precision Contagion&#10;   [CLHS-12.1.4.4]"><code class="varname">CUSTOM:*FLOATING-POINT-CONTAGION-ANSI*</code></a>.  When it is non-<a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>, contagion is done as per the
 [<span class="citation"><a href="references.html#ansi-cl">ANSI CL standard</a></span>]: <a href="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html" target="_top"><code class="classname">SHORT-FLOAT</code></a> → <a href="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html" target="_top"><code class="classname">SINGLE-FLOAT</code></a> →
 <a href="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html" target="_top"><code class="classname">DOUBLE-FLOAT</code></a> → <a href="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html" target="_top"><code class="classname">LONG-FLOAT</code></a>.</p><div class="variablelist"><dl><dt>Rationale:</dt><dd>See it pragmatically: save what you can and let
  others worry about the rest.</dd><dt>Brief:</dt><dd><a href="http://www.lisp.org" target="_top"><span><strong class="command">Common Lisp</strong></span></a> knows the number's precision, not accuracy, so
  preserving the precision can be accomplished reliably, while anything
  relating to the accuracy is just a speculation - only the user
  (programmer) knows what it is in each case.
 </dd><dt>Detailed:</dt><dd>A computer float is an approximation of a real number.
  One can think of it as a random variable with the mean equal to
  itself and standard deviation equal to half the last significant digit.
  E.g., <code class="literal">1.5</code> is actually <code class="literal">1.5±0.05</code>.
  Consider adding <code class="literal">1.5</code> and <code class="literal">1.75</code>.
  [<span class="citation"><a href="references.html#ansi-cl">ANSI CL standard</a></span>] requires that <code class="code">(<a href="http://www.lisp.org/HyperSpec/Body/fun_pl.html" target="_top"><code class="function">+</code></a> 1.5 1.75)</code>
  return <code class="literal">3.25</code>, while traditional <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> would return
  <code class="literal">3.3</code>.  The implied random variables are:
  <code class="literal">3.25±0.005</code> and <code class="literal">3.3±0.05</code>.
  Note that the traditional <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> way <span class="strong"><strong>does</strong></span>
  lie about the mean: the mean <span class="strong"><strong>is</strong></span> <code class="literal">3.25</code> and
  nothing else, while the standard way
  <span class="strong"><strong>could</strong></span> be lying about the deviation
  (accuracy): if the implied accuracy of <code class="literal">1.5 (0.05)</code>
  is its actual accuracy, then the accuracy of the result cannot be
  smaller that that.  Therefore, since <a href="http://www.lisp.org" target="_top"><span><strong class="command">Common Lisp</strong></span></a> has no way of knowing the
  actual accuracy, [<span class="citation"><a href="references.html#ansi-cl">ANSI CL standard</a></span>] (and all the other standard engineering
  programming languages, like <a href="http://www.eskimo.com/~scs/C-faq/top.html" target="_top"><span><strong class="command">C</strong></span></a>, FORTRAN etc) decides that
  keeping the accuracy correct is the business of the programmer, while
  the language should preserve what it can - the precision.
  </dd><dt>Experience:</dt><dd> Rounding errors accumulate, and if a computation
  is conducted with insufficient precision, an outright incorrect
  result can be returned.
  (E.g., <code class="code">E(x<sup>2</sup>) -
  E(x)<sup>2</sup></code> can be negative!)
  The user should not mix floats of different precision (that's what
  <a href="num-concepts.html#warn-fpc" title="Variable CUSTOM:*WARN-ON-FLOATING-POINT-CONTAGION*"><code class="varname">CUSTOM:*WARN-ON-FLOATING-POINT-CONTAGION*</code></a> is for), but one should not be penalized for this too
  harshly.</dd></dl></div><p>When <a href="num-concepts.html#flocont" title="12.2.3.1. Rule of Float Precision Contagion&#10;   [CLHS-12.1.4.4]"><code class="varname">CUSTOM:*FLOATING-POINT-CONTAGION-ANSI*</code></a> is <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>, the traditional <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> method is used,
 namely the result of an arithmetic operation whose arguments are of
 different float types is rounded to the float format of the shortest
 (least precise) of the arguments: <a href="http://www.lisp.org/HyperSpec/Body/syscla_rational.html" target="_top"><code class="classname">RATIONAL</code></a> →
 <a href="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html" target="_top"><code class="classname">LONG-FLOAT</code></a> → <a href="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html" target="_top"><code class="classname">DOUBLE-FLOAT</code></a> → <a href="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html" target="_top"><code class="classname">SINGLE-FLOAT</code></a>
 → <a href="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html" target="_top"><code class="classname">SHORT-FLOAT</code></a> (in contrast to <a href="http://www.lisp.org/HyperSpec/Body/sec_12-1-4-4.html" target="_top">12.1.4.4 Rule of Float Precision
 Contagion</a>!)</p><div class="variablelist"><dl><dt>Rationale:</dt><dd> See it mathematically.  Add intervals:
  <code class="code">{1.0 ± 1e-8} + {1.0 ± 1e-16} = {2.0 ±
  1e-8}</code>.  So, if we add <code class="literal">1.0s0</code> and
  <code class="literal">1.0d0</code>, we should get <code class="literal">2.0s0</code>.
  </dd><dt>Brief:</dt><dd>Do not suggest accuracy of a result by giving it a
  precision that is greater than its accuracy.
  </dd><dt>Example:</dt><dd><code class="code">(<a href="http://www.lisp.org/HyperSpec/Body/fun_-.html" target="_top"><code class="function">-</code></a> (<a href="http://www.lisp.org/HyperSpec/Body/fun_pl.html" target="_top"><code class="function">+</code></a> 1.7 <a href="http://www.lisp.org/HyperSpec/Body/convar_pi.html" target="_top"><code class="constant">PI</code></a>) <a href="http://www.lisp.org/HyperSpec/Body/convar_pi.html" target="_top"><code class="constant">PI</code></a>)</code>
  should not return <code class="literal">1.700000726342836417234L0</code>, it
  should return <code class="literal">1.7f0</code> (or
  <code class="literal">1.700001f0</code> if there were rounding errors).
  </dd><dt>Experience:</dt><dd>If in a computation using thousands of <a href="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html" target="_top"><code class="classname">SHORT-FLOAT</code></a>s,
  a <a href="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html" target="_top"><code class="classname">LONG-FLOAT</code></a> (like <a href="http://www.lisp.org/HyperSpec/Body/convar_pi.html" target="_top"><code class="constant">PI</code></a>) happens to be used, the long precision
  should not propagate throughout all the intermediate values.
  Otherwise, the long result would look precise, but its accuracy is
  only that of a <a href="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html" target="_top"><code class="classname">SHORT-FLOAT</code></a>; furthermore much computation time
  would be lost by calculating with <a href="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html" target="_top"><code class="classname">LONG-FLOAT</code></a>s when only
  <a href="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html" target="_top"><code class="classname">SHORT-FLOAT</code></a>s would be needed.
  </dd></dl></div><div class="simplesect" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="warn-fpc"></a>Variable <a href="num-concepts.html#warn-fpc" title="Variable CUSTOM:*WARN-ON-FLOATING-POINT-CONTAGION*"><code class="varname">CUSTOM:*WARN-ON-FLOATING-POINT-CONTAGION*</code></a></h5></div></div></div><p>If the variable <a href="num-concepts.html#warn-fpc" title="Variable CUSTOM:*WARN-ON-FLOATING-POINT-CONTAGION*"><code class="varname">CUSTOM:*WARN-ON-FLOATING-POINT-CONTAGION*</code></a> is non-<a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>, a <a href="http://www.lisp.org/HyperSpec/Body/contyp_warning.html" target="_top"><code class="classname">WARNING</code></a> is emitted for
 every coercion involving different floating-point types.
 As explained above, float precision contagion is not a good idea.
 You can avoid the contagion by doing all your computations with the
 same floating-point type (and using <a href="http://www.lisp.org/HyperSpec/Body/fun_float.html" target="_top"><code class="function">FLOAT</code></a> to convert all constants,
 e.g., <a href="http://www.lisp.org/HyperSpec/Body/convar_pi.html" target="_top"><code class="constant">PI</code></a>, to your preferred type).</p><p>This variable helps you eliminate all occurrences of float
 precision contagion: set it to <a href="http://www.lisp.org/HyperSpec/Body/convar_t.html" target="_top"><code class="constant">T</code></a> to have <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> <a href="http://www.lisp.org/HyperSpec/Body/fun_signal.html" target="_top"><code class="function">SIGNAL</code></a> a
 <a href="http://www.lisp.org/HyperSpec/Body/contyp_warning.html" target="_top"><code class="classname">WARNING</code></a> on float precision contagion; set it to <a href="http://www.lisp.org/HyperSpec/Body/fun_error.html" target="_top"><code class="function">ERROR</code></a> to have
 <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> <a href="http://www.lisp.org/HyperSpec/Body/fun_signal.html" target="_top"><code class="function">SIGNAL</code></a> an <a href="http://www.lisp.org/HyperSpec/Body/contyp_error.html" target="_top"><code class="classname">ERROR</code></a> on float precision contagion, so that you
 can look at the stack backtrace.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="floratcont"></a>12.2.3.2. Rule of Float and Rational Contagion
   <a href="http://www.lisp.org/HyperSpec/Body/sec_12-1-4-1.html" target="_top">[CLHS-12.1.4.1]</a></h4></div></div></div><p>The contagion between floating point and rational numbers is controlled
 by the variable <a href="num-concepts.html#floratcont" title="12.2.3.2. Rule of Float and Rational Contagion&#10;   [CLHS-12.1.4.1]"><code class="varname">CUSTOM:*FLOATING-POINT-RATIONAL-CONTAGION-ANSI*</code></a>.  When it is non-<a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>, contagion is done as per
 the [<span class="citation"><a href="references.html#ansi-cl">ANSI CL standard</a></span>]: <a href="http://www.lisp.org/HyperSpec/Body/syscla_rational.html" target="_top"><code class="classname">RATIONAL</code></a> → <a href="http://www.lisp.org/HyperSpec/Body/syscla_float.html" target="_top"><code class="classname">FLOAT</code></a>.</p><p>When <a href="num-concepts.html#floratcont" title="12.2.3.2. Rule of Float and Rational Contagion&#10;   [CLHS-12.1.4.1]"><code class="varname">CUSTOM:*FLOATING-POINT-RATIONAL-CONTAGION-ANSI*</code></a> is <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>, the traditional <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> method is used,
 namely if the result is mathematically an exact rational number, this
 rational number is returned (in contrast to <a href="http://www.lisp.org/HyperSpec/Body/sec_12-1-4-1.html" target="_top">12.1.4.1 Rule of Float and Rational
 Contagion</a>!)</p><p><a href="num-concepts.html#floratcont" title="12.2.3.2. Rule of Float and Rational Contagion&#10;   [CLHS-12.1.4.1]"><code class="varname">CUSTOM:*FLOATING-POINT-RATIONAL-CONTAGION-ANSI*</code></a> has an effect only in those few cases when the mathematical
 result is exact although one of the arguments is a floating-point number,
 such as <code class="code">(<a href="http://www.lisp.org/HyperSpec/Body/fun_st.html" target="_top"><code class="function">*</code></a> 0 1.618)</code>, <code class="code">(<a href="http://www.lisp.org/HyperSpec/Body/fun_sl.html" target="_top"><code class="function">/</code></a> 0 1.618)</code>,
 <code class="code">(<a href="http://www.lisp.org/HyperSpec/Body/fun_asincm_acoscm_atan.html" target="_top"><code class="function">ATAN</code></a> 0 1.0)</code>, <code class="code">(<a href="http://www.lisp.org/HyperSpec/Body/fun_expcm_expt.html" target="_top"><code class="function">EXPT</code></a> 2.0 0)</code>,
 <code class="code">(<a href="http://www.lisp.org/HyperSpec/Body/fun_phase.html" target="_top"><code class="function">PHASE</code></a> 2.718)</code>.</p><div class="simplesect" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="warn-fprc"></a>Variable <a href="num-concepts.html#warn-fprc" title="Variable CUSTOM:*WARN-ON-FLOATING-POINT-RATIONAL-CONTAGION*"><code class="varname">CUSTOM:*WARN-ON-FLOATING-POINT-RATIONAL-CONTAGION*</code></a></h5></div></div></div><p>If the variable <a href="num-concepts.html#warn-fprc" title="Variable CUSTOM:*WARN-ON-FLOATING-POINT-RATIONAL-CONTAGION*"><code class="varname">CUSTOM:*WARN-ON-FLOATING-POINT-RATIONAL-CONTAGION*</code></a> is non-<a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>, a <a href="http://www.lisp.org/HyperSpec/Body/contyp_warning.html" target="_top"><code class="classname">WARNING</code></a> is emitted for
 every avoidable coercion from a rational number to a floating-point number.
 You can avoid such coercions by calling <a href="http://www.lisp.org/HyperSpec/Body/fun_float.html" target="_top"><code class="function">FLOAT</code></a> to convert the particular
 rational numbers to your preferred floating-point type.</p><p>This variable helps you eliminate all occurrences of avoidable
 coercions to a floating-point number when a rational number result
 would be possible: set it to <a href="http://www.lisp.org/HyperSpec/Body/convar_t.html" target="_top"><code class="constant">T</code></a> to have <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> <a href="http://www.lisp.org/HyperSpec/Body/fun_signal.html" target="_top"><code class="function">SIGNAL</code></a> a <a href="http://www.lisp.org/HyperSpec/Body/contyp_warning.html" target="_top"><code class="classname">WARNING</code></a>
 in such situations; set it to <a href="http://www.lisp.org/HyperSpec/Body/fun_error.html" target="_top"><code class="function">ERROR</code></a> to have <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> <a href="http://www.lisp.org/HyperSpec/Body/fun_signal.html" target="_top"><code class="function">SIGNAL</code></a> an
 <a href="http://www.lisp.org/HyperSpec/Body/contyp_error.html" target="_top"><code class="classname">ERROR</code></a> in such situations, so that you can look at the stack
 backtrace.</p></div><div class="simplesect" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="phasecont"></a>Variable <a href="num-concepts.html#phasecont" title="Variable CUSTOM:*PHASE-ANSI*"><code class="varname">CUSTOM:*PHASE-ANSI*</code></a></h5></div></div></div><p>A similar variable, <a href="num-concepts.html#phasecont" title="Variable CUSTOM:*PHASE-ANSI*"><code class="varname">CUSTOM:*PHASE-ANSI*</code></a>, controls the return
 value of <a href="http://www.lisp.org/HyperSpec/Body/fun_phase.html" target="_top"><code class="function">PHASE</code></a> when the argument is an exact nonnegative <a href="http://www.lisp.org/HyperSpec/Body/syscla_real.html" target="_top"><code class="classname">REAL</code></a>.
 Namely, if <a href="num-concepts.html#phasecont" title="Variable CUSTOM:*PHASE-ANSI*"><code class="varname">CUSTOM:*PHASE-ANSI*</code></a> is non-<a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>, it returns a floating-point zero;
 if <a href="num-concepts.html#phasecont" title="Variable CUSTOM:*PHASE-ANSI*"><code class="varname">CUSTOM:*PHASE-ANSI*</code></a> is <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>, it returns an exact zero.  Example:
 <code class="code">(<a href="http://www.lisp.org/HyperSpec/Body/fun_phase.html" target="_top"><code class="function">PHASE</code></a> 2/3)</code></p></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="complex-comp"></a>12.2.4. Complex Computations
   <a href="http://www.lisp.org/HyperSpec/Body/sec_12-1-5.html" target="_top">[CLHS-12.1.5]</a></h3></div></div></div><p>Complex numbers can have a real part and an imaginary part of
 different types. For example, <code class="code">(<a href="http://www.lisp.org/HyperSpec/Body/fun_sqrtcm_isqrt.html" target="_top"><code class="function">SQRT</code></a> -9.0)</code> evaluates to
 the number <span class="data"><code class="literal">#C(0 3.0)</code></span>,
 which has a real part of exactly <code class="literal">0</code>,
 not only <span class="data"><code class="literal">0.0</code></span>
 (which would mean “<span class="quote">approximately 0</span>”).</p><p>The type specifier for this is <span class="type"><code class="literal">(<a href="http://www.lisp.org/HyperSpec/Body/syscla_complex.html" target="_top"><code class="classname">COMPLEX</code></a> <a href="http://www.lisp.org/HyperSpec/Body/syscla_integer.html" target="_top"><code class="classname">INTEGER</code></a>
 <a href="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html" target="_top"><code class="classname">SINGLE-FLOAT</code></a>)</code></span>, and <span class="type"><code class="literal">(<a href="http://www.lisp.org/HyperSpec/Body/syscla_complex.html" target="_top"><code class="classname">COMPLEX</code></a> <code class="varname">type-of-real-part</code>
 <code class="varname">type-of-imaginary-part</code>)</code></span> in general.</p><p>The type specifier <span class="type"><code class="literal">(<a href="http://www.lisp.org/HyperSpec/Body/syscla_complex.html" target="_top"><code class="classname">COMPLEX</code></a>
 <em class="replaceable"><code>type</code></em>)</code></span> is equivalent to <span class="type"><code class="literal">(<a href="http://www.lisp.org/HyperSpec/Body/syscla_complex.html" target="_top"><code class="classname">COMPLEX</code></a> <em class="replaceable"><code>type</code></em> <em class="replaceable"><code>type</code></em>)</code></span>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="complex-rational"></a>12.2.5. Rule of
   Canonical Representation for Complex Rationals
   <a href="http://www.lisp.org/HyperSpec/Body/sec_12-1-5-3.html" target="_top">[CLHS-12.1.5.3]</a></h3></div></div></div><p>Complex numbers can have a real part and an imaginary part of
 different types.  If the imaginary part is <a href="http://www.lisp.org/HyperSpec/Body/fun_eql.html" target="_top"><code class="function">EQL</code></a> to <code class="literal">0</code>,
 the number is automatically converted to a real number.</p><p>This has the advantage that
 <code class="code">(<a href="http://www.lisp.org/HyperSpec/Body/speope_letcm_letst.html" target="_top"><code class="function">LET</code></a> ((x (<a href="http://www.lisp.org/HyperSpec/Body/fun_sqrtcm_isqrt.html" target="_top"><code class="function">SQRT</code></a> -9.0))) (* x x))</code> - instead of
 evaluating to <span class="data"><code class="literal">#C(-9.0 0.0)</code></span>, with <em class="replaceable"><code>x</code></em>
 = <span class="data"><code class="literal">#C(0.0 3.0)</code></span> - evaluates to
 <span class="data"><code class="literal">#C(-9.0 0)</code></span> =
 <span class="data"><code class="literal">-9.0</code></span>,
 with <em class="replaceable"><code>x</code></em> = <span class="data"><code class="literal">#C(0 3.0)</code></span>.</p></div></div><div class="bookinfo"><hr width="100%" /><table width="100%" summary="impnotes meta info"><th><td align="left">These notes document <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> version 2.34.</td><td align="right">Last modified: 2005-07-20</td></th></table></div><div class="custom-footer"><hr width="100%" /><table width="100%"><tr><td align="left"><a href="http://clisp.cons.org"><img src="clisp.png" width="48" height="48" alt="[CLISP home]" /></a></td><td align="center"><a href="http://www.gnu.org"><img src="http://www.gnu.org/graphics/gnubanner.jpg" width="468" height="60" alt="[Come and see what GNU creates for YOU]" /></a></td><td align="right"><a href="http://sourceforge.net"><img width="125" height="37" alt="[SourceForge]" src="http://sflogo.sourceforge.net/sflogo.php?group_id=1355&amp;type=2&amp;page=num-concepts" /></a></td></tr></table></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="num-types.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="numbers.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="num-dict.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">12.1. Numeric Types </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 12.3. The Numbers Dictionary
   [CLHS-12.2]</td></tr></table></div></body></html>
