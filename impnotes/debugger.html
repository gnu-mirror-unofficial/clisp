<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>25.1. Debugging Utilities
   [CLHS-25.1.2]</title><link rel="stylesheet" href="impnotes.css" type="text/css" /><link rev="made" href="mailto:clisp-list@sf.net" /><meta name="generator" content="DocBook XSL Stylesheets V1.68.1" /><link rel="start" href="index.html" title="Implementation Notes for GNU CLISP" /><link rel="up" href="environment.html" title="Chapter 25. Environment&#10;   [CLHS-25]" /><link rel="prev" href="environment.html" title="Chapter 25. Environment&#10;   [CLHS-25]" /><link rel="next" href="environment-dict.html" title="25.2. The Environment Dictionary&#10;   [CLHS-25.2]" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">25.1. Debugging Utilities
   [CLHS-25.1.2]</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="environment.html">Prev</a> </td><th width="60%" align="center">Chapter 25. Environment
   [CLHS-25]</th><td width="20%" align="right"> <a accesskey="n" href="environment-dict.html">Next</a></td></tr></table><hr /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="debugger"></a>25.1. Debugging Utilities
   <a href="http://www.lisp.org/HyperSpec/Body/sec_25-1-2.html" target="_top">[CLHS-25.1.2]</a></h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="debugger.html#user-commands">25.1.1. User-customizable Commands</a></span></dt></dl></div><p>The debugger may be invoked through the functions
 <a href="http://www.lisp.org/HyperSpec/Body/fun_invoke-debugger.html" target="_top"><code class="function">INVOKE-DEBUGGER</code></a>, <a href="http://www.lisp.org/HyperSpec/Body/fun_break.html" target="_top"><code class="function">BREAK</code></a>, <a href="http://www.lisp.org/HyperSpec/Body/fun_signal.html" target="_top"><code class="function">SIGNAL</code></a>, <a href="http://www.lisp.org/HyperSpec/Body/fun_error.html" target="_top"><code class="function">ERROR</code></a>, <a href="http://www.lisp.org/HyperSpec/Body/fun_cerror.html" target="_top"><code class="function">CERROR</code></a>, <a href="http://www.lisp.org/HyperSpec/Body/fun_warn.html" target="_top"><code class="function">WARN</code></a>.
 The stepper is invoked through the macro <a href="http://www.lisp.org/HyperSpec/Body/mac_step.html" target="_top"><code class="function">STEP</code></a>.
 Debugger and stepper execute subordinate <a href="http://www.lisp.org/HyperSpec/Body/sec_25-1-1.html" target="_top">read-eval-print loop</a> (called "break loops")
 which are similar to the main <a href="http://www.lisp.org/HyperSpec/Body/sec_25-1-1.html" target="_top">read-eval-print loop</a> except for the
 <a href="prompt.html" title="30.9. The Prompt">prompt</a> and the set of available commands.
 Commands must be typed literally, in any case,
 without surrounding quotes or <a href="http://www.lisp.org/HyperSpec/Body/sec_2-1-4-7.html" target="_top">whitespace</a>.
 Each command has a keyword abbreviation,
 indicated in the second column.</p><div class="table"><a id="debugger-main-deb-step"></a><p class="title"><b>Table 25.1. Commands common to the main loop, the debugger and the stepper</b></p><table summary="Commands common to the main loop, the debugger and the stepper" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th align="center">command</th><th align="center">abbreviation</th><th align="center">operation</th></tr></thead><tbody><tr><td align="center"><span><strong class="command">Help</strong></span></td><td align="center"><span><strong class="command">:h</strong></span></td><td align="center">prints a list of available commands</td></tr></tbody></table></div><div class="table"><a id="debugger-deb-step"></a><p class="title"><b>Table 25.2. Commands common to the debugger and the stepper</b></p><table summary="Commands common to the debugger and the stepper" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th align="center">command</th><th align="center">abbreviation</th><th align="center">operation</th></tr></thead><tbody><tr><td align="center"><span><strong class="command">Abort</strong></span></td><td align="center"><span><strong class="command">:a</strong></span></td><td align="center">abort to the next most recent <a href="http://www.lisp.org/HyperSpec/Body/sec_25-1-1.html" target="_top">read-eval-print loop</a></td></tr><tr><td align="center"><span><strong class="command">Unwind</strong></span></td><td align="center"><span><strong class="command">:uw</strong></span></td><td align="center">abort to the next most recent <a href="http://www.lisp.org/HyperSpec/Body/sec_25-1-1.html" target="_top">read-eval-print loop</a></td></tr><tr><td align="center"><span><strong class="command">Quit</strong></span></td><td align="center"><span><strong class="command">:q</strong></span></td><td align="center">quit to the top <a href="http://www.lisp.org/HyperSpec/Body/sec_25-1-1.html" target="_top">read-eval-print loop</a></td></tr></tbody></table></div><p>The stack is organized into frames and other stack elements.
 Usually every invocation of an interpreted function and every
 evaluation of an interpreted form corresponds to one stack frame.
 Special forms such as <a href="http://www.lisp.org/HyperSpec/Body/speope_letcm_letst.html" target="_top"><code class="function">LET</code></a>, <a href="http://www.lisp.org/HyperSpec/Body/speope_letcm_letst.html" target="_top"><code class="function">LET*</code></a>, <a href="http://www.lisp.org/HyperSpec/Body/speope_unwind-protect.html" target="_top"><code class="function">UNWIND-PROTECT</code></a> and <a href="http://www.lisp.org/HyperSpec/Body/speope_catch.html" target="_top"><code class="function">CATCH</code></a>
 produce special kinds of stack frames.</p><p><a id="cur-frame"></a>In a break loop there is a
 <strong class="first"><em class="firstterm"><a href="debugger.html#cur-frame">current stack frame</a></em></strong>, which is initially the most recent
 stack frame but can be moved using the debugger
 commands <span><strong class="command">Up</strong></span> and <span><strong class="command">Down</strong></span>.</p><p>Evaluation of forms in a break loop occurs in the <a href="http://www.lisp.org/HyperSpec/Body/sec_3-1-1-3.html" target="_top">lexical environment</a> of the
 <a href="debugger.html#cur-frame">current stack frame</a> and <span class="emphasis"><em>at the same time</em></span> in the <a href="http://www.lisp.org/HyperSpec/Body/sec_3-1-1-2.html" target="_top">dynamic environment</a>
 of the debugger's caller.  This means that to inspect or modify a
 <a href="http://www.lisp.org/HyperSpec/Body/sec_3-1-2-1-1-1.html" target="_top">lexical variable</a> all you have to do is to move the <a href="debugger.html#cur-frame">current stack frame</a> to be just
 below the frame that corresponds to the form or the function call that
 binds that variable.</p><p>There is a current <strong class="first"><em class="firstterm">stack mode</em></strong> which defines
 in how much detail the stack is shown by the stack-related debugger
 commands.</p><div class="table"><a id="debugger-deb-step-1"></a><p class="title"><b>Table 25.3. Commands common to the debugger and the stepper</b></p><table summary="Commands common to the debugger and the stepper" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th align="center">command</th><th align="center">abbreviation</th><th align="center">operation</th></tr></thead><tbody><tr><td align="center"><span><strong class="command">Error</strong></span></td><td align="center"><span><strong class="command">:e</strong></span></td><td align="center">print the last error object.</td></tr><tr><td align="center"><span><strong class="command">Inspect</strong></span></td><td align="center"><span><strong class="command">:i</strong></span></td><td align="center">inspect the last error object.</td></tr><tr><td align="center"><span><strong class="command">Mode-1</strong></span></td><td align="center"><span><strong class="command">:m1</strong></span></td><td align="center">sets the current mode to 1: all the stack elements are considered.
    This mode works fine for debugging compiled functions.</td></tr><tr><td align="center"><span><strong class="command">Mode-2</strong></span></td><td align="center"><span><strong class="command">:m2</strong></span></td><td align="center">sets the current mode to 2: all the frames are considered.
     </td></tr><tr><td align="center"><span><strong class="command">Mode-3</strong></span></td><td align="center"><span><strong class="command">:m3</strong></span></td><td align="center">sets the current mode to 3: only lexical frames (frames that
    correspond to special forms that modify the <a href="http://www.lisp.org/HyperSpec/Body/sec_3-1-1-3.html" target="_top">lexical environment</a>) are
    considered.</td></tr><tr><td align="center"><span><strong class="command">Mode-4</strong></span></td><td align="center"><span><strong class="command">:m4</strong></span></td><td align="center">sets the current mode to 4 (the default): only <a href="http://www.lisp.org/HyperSpec/Body/fun_eval.html" target="_top"><code class="function">EVAL</code></a> and
    <a href="http://www.lisp.org/HyperSpec/Body/fun_apply.html" target="_top"><code class="function">APPLY</code></a> frames are considered. Every evaluation of a form in the
    interpreter corresponds to an EVAL frame.</td></tr><tr><td align="center"><span><strong class="command">Mode-5</strong></span></td><td align="center"><span><strong class="command">:m5</strong></span></td><td align="center">sets the current mode to 5: only <a href="http://www.lisp.org/HyperSpec/Body/fun_apply.html" target="_top"><code class="function">APPLY</code></a> frames are
         considered. Every invocation of an interpreted function
         corresponds to one <a href="http://www.lisp.org/HyperSpec/Body/fun_apply.html" target="_top"><code class="function">APPLY</code></a> frame.</td></tr><tr><td align="center"><span><strong class="command">Where</strong></span></td><td align="center"><span><strong class="command">:w</strong></span></td><td align="center">shows the <a href="debugger.html#cur-frame">current stack frame</a>.</td></tr><tr><td align="center"><span><strong class="command">Up</strong></span></td><td align="center"><span><strong class="command">:u</strong></span></td><td align="center">goes up one frame, i.e., to the caller if in mode-5
    </td></tr><tr><td align="center"><span><strong class="command">Down</strong></span></td><td align="center"><span><strong class="command">:d</strong></span></td><td align="center">does down one frame, i.e., to the callee if in mode-5
    </td></tr><tr><td align="center"><span><strong class="command">Top</strong></span></td><td align="center"><span><strong class="command">:t</strong></span></td><td align="center">goes to top frame, i.e., to the top-level form if in mode-4
    </td></tr><tr><td align="center"><span><strong class="command">Bottom</strong></span></td><td align="center"><span><strong class="command">:b</strong></span></td><td align="center">goes to bottom (most recent) frame, i.e., most probably to the
         form or function that caused the debugger to be entered.
    </td></tr><tr><td align="center"><span><strong class="command">Backtrace</strong></span></td><td align="center"><span><strong class="command">:bt</strong></span></td><td align="center">lists the stack in current mode, bottom frame first, top frame
     last.</td></tr><tr><td align="center"><span><strong class="command">Backtrace-1</strong></span></td><td align="center"><span><strong class="command">:bt1</strong></span></td><td align="center">lists the stack in mode 1.</td></tr><tr><td align="center"><span><strong class="command">Backtrace-2</strong></span></td><td align="center"><span><strong class="command">:bt2</strong></span></td><td align="center">lists the stack in mode 2.</td></tr><tr><td align="center"><span><strong class="command">Backtrace-3</strong></span></td><td align="center"><span><strong class="command">:bt3</strong></span></td><td align="center">lists the stack in mode 3.</td></tr><tr><td align="center"><span><strong class="command">Backtrace-4</strong></span></td><td align="center"><span><strong class="command">:bt4</strong></span></td><td align="center">lists the stack in mode 4.</td></tr><tr><td align="center"><span><strong class="command">Backtrace-5</strong></span></td><td align="center"><span><strong class="command">:bt5</strong></span></td><td align="center">lists the stack in mode 5.</td></tr><tr><td align="center"><span><strong class="command">Frame-limit</strong></span></td><td align="center"><span><strong class="command">:fl</strong></span></td><td align="center">set the frame-limit: this many frames will be printed in a
     backtrace at most.</td></tr><tr><td align="center"><span><strong class="command">Backtrace-l</strong></span></td><td align="center"><span><strong class="command">:bl</strong></span></td><td align="center">limit of frames to print will be prompted for.</td></tr></tbody></table></div><p>If the <a href="debugger.html#cur-frame">current stack frame</a> is an <a href="http://www.lisp.org/HyperSpec/Body/fun_eval.html" target="_top"><code class="function">EVAL</code></a> or <a href="http://www.lisp.org/HyperSpec/Body/fun_apply.html" target="_top"><code class="function">APPLY</code></a> frame, the
  following commands are available as well:</p><div class="table"><a id="debugger-eval-apply"></a><p class="title"><b>Table 25.4. Commands specific to <a href="http://www.lisp.org/HyperSpec/Body/fun_eval.html" target="_top"><code class="function">EVAL</code></a>/<a href="http://www.lisp.org/HyperSpec/Body/fun_apply.html" target="_top"><code class="function">APPLY</code></a></b></p><table summary="Commands specific to EVAL/APPLY" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th align="center">command</th><th align="center">abbreviation</th><th align="center">operation</th></tr></thead><tbody><tr><td align="center"><span><strong class="command">Break+</strong></span></td><td align="center"><span><strong class="command">:br+</strong></span></td><td align="center">sets a breakpoint in the current frame.  When the corresponding
     form or function will be left, the debugger will be entered again, with
     the variable <a href="environment-dict.html#trace-val"><code class="varname">EXT:*TRACE-VALUES*</code></a> containing a list of its values.</td></tr><tr><td align="center"><span><strong class="command">Break-</strong></span></td><td align="center"><span><strong class="command">:br-</strong></span></td><td align="center">removes a breakpoint from the current frame.</td></tr><tr><td align="center"><span><strong class="command">Redo</strong></span></td><td align="center"><span><strong class="command">:rd</strong></span></td><td align="center">re-evaluates the corresponding form or function call. This
     command can be used to restart parts of a computation without
     aborting it entirely.</td></tr><tr><td align="center"><span><strong class="command">Return</strong></span></td><td align="center"><span><strong class="command">:rt</strong></span></td><td align="center">leaves the current frame.  You will be prompted for the return
     values.</td></tr></tbody></table></div><div class="table"><a id="debugger-deb"></a><p class="title"><b>Table 25.5. Commands specific to the debugger</b></p><table summary="Commands specific to the debugger" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th align="center">command</th><th align="center">abbreviation</th><th align="center">operation</th></tr></thead><tbody><tr><td align="center"><span><strong class="command">Continue</strong></span></td><td align="center"><span><strong class="command">:c</strong></span></td><td align="center">continues evaluation of the program.</td></tr></tbody></table></div><div class="table"><a id="debugger-step"></a><p class="title"><b>Table 25.6. Commands specific to the stepper</b></p><table summary="Commands specific to the stepper" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th align="center">command</th><th align="center">abbreviation</th><th align="center">operation</th></tr></thead><tbody><tr><td align="center"><span><strong class="command">Step</strong></span></td><td align="center"><span><strong class="command">:s</strong></span></td><td align="center">step into a form: evaluate this form in single step mode
   </td></tr><tr><td align="center"><span><strong class="command">Next</strong></span></td><td align="center"><span><strong class="command">:n</strong></span></td><td align="center">step over a form: evaluate this form at once
   </td></tr><tr><td align="center"><span><strong class="command">Over</strong></span></td><td align="center"><span><strong class="command">:o</strong></span></td><td align="center">step over this level: evaluate at once up to the next return
   </td></tr><tr><td align="center"><span><strong class="command">Continue</strong></span></td><td align="center"><span><strong class="command">:c</strong></span></td><td align="center">switch off single step mode, continue evaluation
   </td></tr></tbody></table></div><p>The stepper is usually used like this: If some form returns a
 strange value or results in an error, call <code class="code">(<a href="http://www.lisp.org/HyperSpec/Body/mac_step.html" target="_top"><code class="function">STEP</code></a>
 <em class="replaceable"><code>form</code></em>)</code> and navigate using the
 commands <span><strong class="command">Step</strong></span> and <span><strong class="command">Next</strong></span> until you
 reach the form you regard as responsible.  If you are too fast (execute
 <span><strong class="command">Next</strong></span> once and get the error), there is no way back;
 you have to restart the entire stepper session.  If you are too slow
 (stepped into a function or a form which certainly is OK), a couple of
 <span><strong class="command">Next</strong></span> commands or one <span><strong class="command">Over</strong></span> command
 will help.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="user-commands"></a>25.1.1. User-customizable Commands</h3></div></div></div><p>You can set <strong class="first"><em class="firstterm"><a href="debugger.html#user-commands" title="25.1.1. User-customizable Commands"><code class="varname">CUSTOM:*USER-COMMANDS*</code></a></em></strong> to a list of
 <a href="http://www.lisp.org/HyperSpec/Body/syscla_function.html" target="_top"><code class="classname">FUNCTION</code></a>s, each returning a <a href="http://www.lisp.org/HyperSpec/Body/syscla_list.html" target="_top"><code class="classname">LIST</code></a>
 of <strong class="first"><em class="firstterm">bindings</em></strong>, i.e., either a
</p><div class="variablelist"><dl><dt><a href="http://www.lisp.org/HyperSpec/Body/syscla_string.html" target="_top"><code class="classname">STRING</code></a></dt><dd>the help string printed by <span><strong class="command">Help</strong></span>
  in addition to the standard <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> help</dd><dt><a href="http://www.lisp.org/HyperSpec/Body/syscla_cons.html" target="_top"><code class="classname">CONS</code></a>
  <span class="data"><code class="literal">(<a href="http://www.lisp.org/HyperSpec/Body/syscla_string.html" target="_top"><code class="classname">STRING</code></a> . <a href="http://www.lisp.org/HyperSpec/Body/syscla_function.html" target="_top"><code class="classname">FUNCTION</code></a>)</code></span></dt><dd>the actual binding: when the user types the string,
  the function is called.
</dd></dl></div><p>
E.g.,
</p><pre class="programlisting">
(setq <a href="debugger.html#user-commands" title="25.1.1. User-customizable Commands"><code class="varname">CUSTOM:*USER-COMMANDS*</code></a>
      (list (lambda () (list (format nil "~2%User-defined commands:")))
            (lambda ()
              (flet ((panic () (format t "don't panic, ~D~%" (random 42))))
                (list (format nil "~%panic   :p    hit the panic button!")
                      (cons "panic" #'panic)
                      (cons ":p" #'panic))))
            (lambda ()
              (let ((curses #("ouch" "yuk" "bletch")))
                (flet ((swear ()
                         (format t "~A!~%"
                                 (aref curses (random (length curses))))))
                  (list (format nil "~%swear   :e    curse")
                        (cons "swear" #'swear)
                        (cons ":e" #'swear)))))))
</pre></div></div><div class="bookinfo"><hr width="100%" /><table width="100%" summary="impnotes meta info"><th><td align="left">These notes document <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> version 2.35</td><td align="right">Last modified: 2005-08-29</td></th></table></div><div class="custom-footer"><hr width="100%" /><table width="100%"><tr><td align="left"><a href="http://clisp.cons.org"><img src="clisp.png" width="48" height="48" alt="[CLISP home]" /></a></td><td align="center"><a href="http://www.gnu.org"><img src="http://www.gnu.org/graphics/gnubanner.jpg" width="468" height="60" alt="[Come and see what GNU creates for YOU]" /></a></td><td align="right"><a href="http://sourceforge.net"><img width="125" height="37" alt="[SourceForge]" src="http://sflogo.sourceforge.net/sflogo.php?group_id=1355&amp;type=2&amp;page=debugger" /></a></td></tr></table></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="environment.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="environment.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="environment-dict.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 25. Environment
   [CLHS-25] </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 25.2. The Environment Dictionary
   [CLHS-25.2]</td></tr></table></div></body></html>
