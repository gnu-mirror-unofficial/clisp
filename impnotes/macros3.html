<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<HTML
><HEAD
><TITLE
>Extensions-1.10. Additional Fancy Macros</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.76b+
"><LINK
REV="MADE"
HREF="mailto:clisp-list@sf.net"><LINK
REL="HOME"
TITLE="Implementation Notes for GNU CLISP."
HREF="impnotes-top.html"><LINK
REL="UP"
TITLE="Extensions-1: Platform independent Extensions"
HREF="p-indep.html"><LINK
REL="PREVIOUS"
TITLE="Extensions-1.9. Maximum ANSI CL compliance"
HREF="ansi.html"><LINK
REL="NEXT"
TITLE="Extensions-1.11. Customizing CLISP behavior."
HREF="customize.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="impnotes.css"></HEAD
><BODY
CLASS="section"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Implementation Notes for <A
HREF="http://www.gnu.org"
TARGET="_top"
>GNU</A
> <A
HREF="http://clisp.cons.org"
TARGET="_top"
><B
CLASS="command"
>CLISP</B
></A
>.: These notes document <A
HREF="http://clisp.cons.org"
TARGET="_top"
><B
CLASS="command"
>CLISP</B
></A
> version 2.31.</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="ansi.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 29. Extensions-1: Platform independent Extensions</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="customize.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="section"
><H1
CLASS="section"
><A
NAME="macros3"
></A
>29.10. Extensions-1.10. Additional Fancy Macros</H1
><P
ALIGN="justify"
><A
HREF="http://clisp.cons.org"
TARGET="_top"
><B
CLASS="command"
>CLISP</B
></A
> comes with some extension macros, mostly defined in the
 file <TT
CLASS="filename"
>macros3.lisp</TT
> and loaded from the file
 <TT
CLASS="filename"
>init.lisp</TT
> during <B
CLASS="command"
>make</B
>:</P
><DIV
CLASS="formalpara"
><P
><A
NAME="ethe"
></A
><B
>Macro <A
HREF="macros3.html#ethe"
><TT
CLASS="function"
>EXT:ETHE</TT
></A
>. </B
><TT
CLASS="sexp"
>(<A
HREF="macros3.html#ethe"
><TT
CLASS="function"
>EXT:ETHE</TT
></A
> <TT
CLASS="replaceable"
><I
>value-type</I
></TT
> <TT
CLASS="replaceable"
><I
>form</I
></TT
>)</TT
>
 enforces a type check in both interpreted and compiled code.
 </P
></DIV
><DIV
CLASS="formalpara"
><P
><A
NAME="letf"
></A
><B
>Macros <A
HREF="macros3.html#letf"
><TT
CLASS="function"
>EXT:LETF</TT
></A
> &#38; <A
HREF="macros3.html#letf"
><TT
CLASS="function"
>EXT:LETF*</TT
></A
>. </B
>These macros are similar to <A
HREF="http://www.lisp.org/HyperSpec/Body/speope_letcm_letst.html"
TARGET="_top"
><TT
CLASS="function"
>LET</TT
></A
> and <A
HREF="http://www.lisp.org/HyperSpec/Body/speope_letcm_letst.html"
TARGET="_top"
><TT
CLASS="function"
>LET*</TT
></A
>, respectively,
 except that they can bind places, even places with multiple values.
 Example:

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13; (letf (((values a b) form)) ...)
</PRE
></TD
></TR
></TABLE
>

is equivalent to

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13; (multiple-value-bind (a b) form ...)
</PRE
></TD
></TR
></TABLE
>

while

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;(letf (((first l) 7)) ...)
</PRE
></TD
></TR
></TABLE
>

is approximately equivalent to

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13; (<A
HREF="http://www.lisp.org/HyperSpec/Body/speope_letcm_letst.html"
TARGET="_top"
><TT
CLASS="function"
>LET*</TT
></A
> ((#:g1 l) (#:g2 (first #:g1)))
   (<A
HREF="http://www.lisp.org/HyperSpec/Body/speope_unwind-protect.html"
TARGET="_top"
><TT
CLASS="function"
>UNWIND-PROTECT</TT
></A
> (<A
HREF="http://www.lisp.org/HyperSpec/Body/speope_progn.html"
TARGET="_top"
><TT
CLASS="function"
>PROGN</TT
></A
> (<A
HREF="http://www.lisp.org/HyperSpec/Body/mac_setfcm_psetf.html"
TARGET="_top"
><TT
CLASS="function"
>SETF</TT
></A
> (first #:g1) 7) ...)
      (<A
HREF="http://www.lisp.org/HyperSpec/Body/mac_setfcm_psetf.html"
TARGET="_top"
><TT
CLASS="function"
>SETF</TT
></A
> (first #:g1) #:g2)))
</PRE
></TD
></TR
></TABLE
>
</P
></DIV
><DIV
CLASS="formalpara"
><P
><A
NAME="with-collect"
></A
><B
>Macro <TT
CLASS="function"
>EXT:WITH-COLLECT</TT
>. </B
>Similar to the <A
HREF="http://www.lisp.org/HyperSpec/Body/mac_loop.html"
TARGET="_top"
><TT
CLASS="function"
>LOOP</TT
></A
>'s
 <A
HREF="http://www.lisp.org/HyperSpec/Body/sec_6-1-3.html"
TARGET="_top"
><TT
CLASS="constant"
>collect</TT
></A
>
 construct, except that it is looks more "Lispy" and can appear
 arbitrarily deep.  It defines local macros (with <A
HREF="http://www.lisp.org/HyperSpec/Body/speope_fletcm_scm_macrolet.html"
TARGET="_top"
><TT
CLASS="function"
>MACROLET</TT
></A
>) which
 collect objects given to it into lists, which are then returned as
 multiple values.  E.g.,

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13; (ext:with-collect (c0 c1)
   (dotimes (i 10) (if (oddp i) (c0 i) (c1 i))))
</PRE
></TD
></TR
></TABLE
>

returns two lists <TT
CLASS="sexp"
>(1 3 5 7 9)</TT
> and
<TT
CLASS="sexp"
>(0 2 4 6 8)</TT
> as multiple values.
</P
></DIV
><DIV
CLASS="formalpara"
><P
><A
NAME="with-gensyms"
></A
><B
>Macro <TT
CLASS="function"
>EXT:WITH-GENSYMS</TT
>. </B
>Similar to its namesake from
 <A
HREF="http://www.paulgraham.com/"
TARGET="_top"
>Paul Graham</A
>'s book
 <A
HREF="http://www.paulgraham.com/onlisp.html"
TARGET="_top"
><SPAN
CLASS="QUOTE"
>"On
  Lisp"</SPAN
></A
>, this macro is useful for writing other macros:
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13; (with-gensyms ("FOO-" bar baz zot) ...)
</PRE
></TD
></TR
></TABLE
>
expands to
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13; (let ((bar (gensym "FOO-BAR-"))
       (baz (gensym "FOO-BAZ-"))
       (zot (gensym "FOO-ZOT-")))
   ...)
</PRE
></TD
></TR
></TABLE
>
</P
></DIV
><DIV
CLASS="formalpara"
><P
><A
NAME="remove-plist"
></A
><B
>Function <TT
CLASS="function"
>EXT:REMOVE-PLIST</TT
>. </B
>Similar to <A
HREF="http://www.lisp.org/HyperSpec/Body/fun_removecm__elete-if-not.html"
TARGET="_top"
><TT
CLASS="function"
>REMOVE</TT
></A
> and <A
HREF="http://www.lisp.org/HyperSpec/Body/mac_remf.html"
TARGET="_top"
><TT
CLASS="function"
>REMF</TT
></A
>, this function removes some
 properties from a property list.  It is non-destructve and thus can be
 used on <A
HREF="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html"
TARGET="_top"
><TT
CLASS="literal"
>&#38;REST</TT
></A
> arguments to remove some keyword parameters, e.g.,
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13; (defmacro with-foo ((<A
HREF="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html"
TARGET="_top"
><TT
CLASS="literal"
>&#38;KEY</TT
></A
> foo1 foo2) <A
HREF="http://www.lisp.org/HyperSpec/Body/sec_3-4-4.html"
TARGET="_top"
><TT
CLASS="literal"
>&#38;BODY</TT
></A
> body)
   `(... ,foo1 ... ,foo2 ... ,@body))
 (defmacro with-foo-bar ((<A
HREF="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html"
TARGET="_top"
><TT
CLASS="literal"
>&#38;REST</TT
></A
> opts <A
HREF="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html"
TARGET="_top"
><TT
CLASS="literal"
>&#38;KEY</TT
></A
> bar1 bar2
                          <A
HREF="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html"
TARGET="_top"
><TT
CLASS="literal"
>&#38;ALLOW-OTHER-KEYS</TT
></A
>)
                         <A
HREF="http://www.lisp.org/HyperSpec/Body/sec_3-4-4.html"
TARGET="_top"
><TT
CLASS="literal"
>&#38;BODY</TT
></A
> body)
   `(with-foo (,@(remove-plist opts :bar1 :bar2)
      ... ,bar1 ... ,bar2 ... ,@body)))
 (defun foo-bar ()
   (with-foo-bar (:bar1 1 :foo2 2) ...))
</PRE
></TD
></TR
></TABLE
>
here <TT
CLASS="function"
>WITH-FOO</TT
> does not receive the
<TT
CLASS="literal"
>:BAR1 1</TT
> argument from <TT
CLASS="function"
>FOO-BAR</TT
>.
</P
></DIV
><DIV
CLASS="formalpara"
><P
><A
NAME="html-http-output"
></A
><B
>Macros <TT
CLASS="function"
>EXT:WITH-HTML-OUTPUT</TT
> and
                   <TT
CLASS="function"
>EXT:WITH-HTTP-OUTPUT</TT
>. </B
>Defined in <TT
CLASS="filename"
>inspect.lisp</TT
>, these macros are useful
 for the rudimentary <A
HREF="http://www.w3.org/Protocols/"
TARGET="_top"
><B
CLASS="command"
>HTTP</B
></A
> server defined there.</P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="ansi.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="impnotes-top.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="customize.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Extensions-1.9. Maximum ANSI CL compliance</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="p-indep.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Extensions-1.11. Customizing <A
HREF="http://clisp.cons.org"
TARGET="_top"
><B
CLASS="command"
>CLISP</B
></A
> behavior.</TD
></TR
></TABLE
></DIV
><div
class="custom-footer"
><hr
width="100%"><table
width="100%"
><tr
><td
align="left"
><a
href="http://clisp.cons.org"
><img
src="clisp.png"
width="48"
height="48"
alt="[CLISP home]"></a
></td
><td
align="center"
><a
href="http://www.gnu.org"
><img
src="http://www.gnu.org/graphics/gnubanner.jpg"
width="468"
height="60"
alt="[Come and see what GNU creates for YOU]"></a
></td
><td
align="right"
><a
href="http://sourceforge.net"
><img
src="http://sourceforge.net/sflogo.php?group_id=1355&amp;type=2"
width="125"
height="37"
alt="[SourceForge]"></a
></td
></tr
></table
></div
></BODY
></HTML
>