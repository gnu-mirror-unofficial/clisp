<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>32.13. Raw Socket Access.</title><link rel="stylesheet" href="impnotes.css" type="text/css" /><link rev="made" href="mailto:clisp-list@sf.net" /><meta name="generator" content="DocBook XSL Stylesheets V1.68.1" /><link rel="start" href="index.html" title="Implementation Notes for GNU CLISP" /><link rel="up" href="ext-modules.html" title="Chapter 32. Extensions Implemented as Modules" /><link rel="prev" href="fastcgi.html" title="32.12. The FastCGI Interface" /><link rel="next" href="wildcard.html" title="32.14. The Wildcard Module" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">32.13. Raw Socket Access.</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="fastcgi.html">Prev</a> </td><th width="60%" align="center">Chapter 32. Extensions Implemented as Modules</th><td width="20%" align="right"> <a accesskey="n" href="wildcard.html">Next</a></td></tr></table><hr /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="rawsock"></a>32.13. Raw Socket Access.</h2></div></div></div><p>This is the raw socket interface, as described in
 <a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/basedefs/syssocket.h.html">&lt;<code class="filename">sys/socket.h</code>&gt;</a>.
Sockets are represented by their <a href="http://www.lisp.org/HyperSpec/Body/typ_fixnum.html" target="_top"><code class="classname">FIXNUM</code></a> <a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/basedefs/xbd_chap03.html#tag_03_165">file descriptor</a>s.</p><p>When this module is present, <a href="http://www.lisp.org/HyperSpec/Body/var_stfeaturesst.html" target="_top"><code class="varname">*FEATURES*</code></a> contains the
 symbol <code class="constant">:RAWSOCK</code>.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="rawsock-use-sockets"></a>Use <code class="classname">SOCKET:SOCKET-STREAM</code> instead!</h3><p>This interface is very low-level, and you probably do not need
 it - unless you are doing something <span class="emphasis"><em>very</em></span> unusual.
 If you are interested in TCP/IP (Internet) stream sockets, you should use
 <a href="socket.html" title="31.5. Socket Streams"><code class="classname">SOCKET:SOCKET-STREAM</code></a>s, <span class="strong"><strong>not</strong></span> this package.</p></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="rawsock-not-streams"></a>Do <span class="strong"><strong>not</strong></span> use <code class="function">EXT:MAKE-STREAM</code>!</h3><p>You can turn such a raw socket into a usual lisp <a href="http://www.lisp.org/HyperSpec/Body/syscla_stream.html" target="_top"><code class="classname">STREAM</code></a>
  using <a href="stream-dict.html#make-stream" title="21.3.2. Function EXT:MAKE-STREAM"><code class="function">EXT:MAKE-STREAM</code></a>, but you should be <span class="emphasis"><em>extremely</em></span>
  careful with such dubious actions!  See the <code class="email">&lt;<a href="mailto:clisp-devel/at/lists.sourceforge.net"><a href="http://lists.sourceforge.net/lists/listinfo/clisp-devel" target="_top">clisp-devel/at/lists.sourceforge.net</a></a>&gt;</code>
  <a href="http://sourceforge.net/mailarchive/message.php?msg_id=7203955" target="_top">mailing list archives</a> for more details.
  Note that <a href="stream-dict.html#make-stream" title="21.3.2. Function EXT:MAKE-STREAM"><code class="function">EXT:MAKE-STREAM</code></a> will duplicate the <a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/basedefs/xbd_chap03.html#tag_03_165">file descriptor</a>
  (using <a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/dup.html"><code class="function">dup</code></a>),
  so you <span class="emphasis"><em>still</em></span> have to <a href="http://www.lisp.org/HyperSpec/Body/fun_close.html" target="_top"><code class="function">CLOSE</code></a> the original raw socket.
</p></div><p>We implement access to
 </p><table class="simplelist" border="0" summary="Simple list"><tr><td><a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/accept.html"><code class="function">accept</code></a></td><td><a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/htonl.html"><code class="function">htonl</code></a></td><td><a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/recv.html"><code class="function">recv</code></a></td><td><a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/sendto.html"><code class="function">sendto</code></a></td></tr><tr><td><a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/bind.html"><code class="function">bind</code></a></td><td><a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/htons.html"><code class="function">htons</code></a></td><td><a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/recvfrom.html"><code class="function">recvfrom</code></a></td><td><a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/sockatmark.html"><code class="function">sockatmark</code></a></td></tr><tr><td><a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/connect.html"><code class="function">connect</code></a></td><td><a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/listen.html"><code class="function">listen</code></a></td><td><a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/recvmsg.html"><code class="function">recvmsg</code></a></td><td><a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/socket.html"><code class="function">socket</code></a></td></tr><tr><td><a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/getpeername.html"><code class="function">getpeername</code></a></td><td><a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/ntohl.html"><code class="function">ntohl</code></a></td><td><a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/send.html"><code class="function">send</code></a></td><td><a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/socketpair.html"><code class="function">socketpair</code></a></td></tr><tr><td><a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/getsockname.html"><code class="function">getsockname</code></a></td><td><a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/ntohs.html"><code class="function">ntohs</code></a></td><td><a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/sendmsg.html"><code class="function">sendmsg</code></a></td><td> </td></tr></table><p>
 using same-named lisp functions in package
 <strong class="package">“<span class="quote">RAWSOCK</span>”</strong>.
 Additionally,</p><div class="itemizedlist"><ul type="disc"><li><code class="function">RAWSOCK:SOCK-READ</code>
    calls <a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/read.html"><code class="function">read</code></a>;</li><li><code class="function">RAWSOCK:SOCK-WRITE</code>
    calls <a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/write.html"><code class="function">write</code></a>;</li><li><code class="function">RAWSOCK:SOCK-CLOSE</code>
    calls <a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/close.html"><code class="function">close</code></a>.</li></ul></div><p>The interface to <a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/getsockopt.html"><code class="function">getsockopt</code></a>
 and <a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/setsockopt.html"><code class="function">setsockopt</code></a> is available via
 the <a href="http://www.lisp.org/HyperSpec/Body/mac_setfcm_psetf.html" target="_top"><code class="function">SETF</code></a>able function
 <code class="code">(RAWSOCK:SOCKET-OPTION <em class="replaceable"><code>socket</code></em> <em class="replaceable"><code>name</code></em> <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;KEY</code></a> :LEVEL)</code>
 which returns and sets individual (for specific option <em class="replaceable"><code>name</code></em>
 and <em class="replaceable"><code>level</code></em>) and multiple (when <em class="replaceable"><code>name</code></em> is
 <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a> and/or <em class="replaceable"><code>level</code></em> is <code class="constant">:ALL</code>) options.
 (See also <a href="socket.html#so-opt"><code class="function">SOCKET:SOCKET-OPTIONS</code></a>.)</p><p>We do not interface to <a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/select.html"><code class="function">select</code></a>
 or <a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/poll.html"><code class="function">poll</code></a>,
 they are available through <a href="socket.html#so-status"><code class="function">SOCKET:SOCKET-STATUS</code></a>.</p><p>We do not interface to <a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/shutdown.html"><code class="function">shutdown</code></a>,
 it is available through <a href="socket.html#sost-shut"><code class="function">SOCKET:SOCKET-STREAM-SHUTDOWN</code></a>.</p><p>We do not interface to <a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/gethostbyname.html"><code class="function">gethostbyname</code></a>
 or <a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/gethostbyaddr.html"><code class="function">gethostbyaddr</code></a>,
 they are available through <a href="syscalls.html#resolve-host"><code class="function">POSIX:RESOLVE-HOST-IPADDR</code></a>.</p><div class="variablelist"><a id="rawsock-add-on"></a><p class="title"><b>Additional Functions</b></p><dl><dt><code class="code">(RAWSOCK:CONVERT-ADDRESS
    <em class="replaceable"><code>family</code></em> <em class="replaceable"><code>address</code></em>)</code></dt><dd>convert between <a href="http://www.lisp.org/HyperSpec/Body/syscla_string.html" target="_top"><code class="classname">STRING</code></a> and <a href="http://www.lisp.org/HyperSpec/Body/syscla_integer.html" target="_top"><code class="classname">INTEGER</code></a> IP
    <em class="replaceable"><code>address</code></em> representations using <a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/inet_addr.html"><code class="function">inet_addr</code></a>,
    <a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/inet_ntoa.html"><code class="function">inet_ntoa</code></a>,
    <a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/inet_ntop.html"><code class="function">inet_ntop</code></a>,
    or <a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/inet_pton.html"><code class="function">inet_pton</code></a>.
 </dd><dt><code class="code">(RAWSOCK:MAKE-SOCKADDR
    <em class="replaceable"><code>family</code></em> <em class="replaceable"><code>data</code></em>)</code></dt><dd>create a <span class="type">sockaddr</span> object.
 </dd><dt><code class="code">(RAWSOCK:SOCKADDR-FAMILY
    <em class="replaceable"><code>sockaddr</code></em>)</code></dt><dd>return the numeric family of a
    <span class="type">sockaddr</span> object.</dd><dt><code class="code">(RAWSOCK:SOCKADDR-DATA
    <em class="replaceable"><code>sockaddr</code></em>)</code></dt><dd>return a <a href="http://www.lisp.org/HyperSpec/Body/glo_f.html#fresh" target="_top">fresh</a> data vector of a
    <span class="type">sockaddr</span> object.</dd><dt><code class="code">(RAWSOCK:OPEN-UNIX-SOCKET
    <em class="replaceable"><code>pathname</code></em> <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;OPTIONAL</code></a> <em class="replaceable"><code>type</code></em>)</code></dt><dd>open a <a href="http://www.UNIX-systems.org/online.html" target="_top"><span class="strong"><strong>UNIX</strong></span></a> socket special file.
 </dd><dt><code class="code">(RAWSOCK:MAKE-MSGHDR <em class="replaceable"><code>data</code></em>)</code></dt><dd>Create a <span class="type">RAWSOCK:MSGHDR</span> object for
    <a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/sendmsg.html"><code class="function">sendmsg</code></a> and
    <a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/recvmsg.html"><code class="function">recvmsg</code></a>.
 </dd><dt><code class="code">(RAWSOCK:IPCSUM <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;OPTIONAL</code></a> <em class="replaceable"><code>buffer</code></em>)</code><br /><code class="code">(RAWSOCK:ICMPCSUM <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;OPTIONAL</code></a> <em class="replaceable"><code>buffer</code></em>)</code><br /><code class="code">(RAWSOCK:TCPCSUM <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;OPTIONAL</code></a> <em class="replaceable"><code>buffer</code></em>)</code><br /><code class="code">(RAWSOCK:UDPCSUM <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;OPTIONAL</code></a> <em class="replaceable"><code>buffer</code></em>)</code></dt><dd>Compute the appropriate protocol checksum.
    <em class="replaceable"><code>buffer</code></em> defaults to the internal buffer.
 </dd><dt><code class="code">(RAWSOCK:BUFFER)</code></dt><dd>Return the internal buffer, used as the default
    argument in the checksum functions and when <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a> is passed as the
    <em class="replaceable"><code>buffer</code></em> argument to the i/o functions like
    <a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/sendto.html"><code class="function">sendto</code></a>.
 </dd><dt><code class="code">(RAWSOCK:RESIZE-BUFFER <em class="replaceable"><code>size</code></em>)</code></dt><dd>Resize the internal buffer.
 </dd><dt><code class="code">(RAWSOCK:CONFIGDEV <em class="replaceable"><code>socket</code></em> <em class="replaceable"><code>name</code></em> <em class="replaceable"><code>address</code></em>
    <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;KEY</code></a> <em class="replaceable"><code>promisc</code></em>
    <em class="replaceable"><code>noarp</code></em>)</code></dt><dd>Set some socket options and IP <em class="replaceable"><code>address</code></em>
  with <a class="unix" href="http://www.opengroup.org/onlinepubs/007904975/functions/ioctl.html"><code class="function">ioctl</code></a>.
 </dd></dl></div></div><div class="bookinfo"><hr width="100%" /><table width="100%" summary="impnotes meta info"><th><td align="left">These notes document <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> version 2.35</td><td align="right">Last modified: 2005-08-29</td></th></table></div><div class="custom-footer"><hr width="100%" /><table width="100%"><tr><td align="left"><a href="http://clisp.cons.org"><img src="clisp.png" width="48" height="48" alt="[CLISP home]" /></a></td><td align="center"><a href="http://www.gnu.org"><img src="http://www.gnu.org/graphics/gnubanner.jpg" width="468" height="60" alt="[Come and see what GNU creates for YOU]" /></a></td><td align="right"><a href="http://sourceforge.net"><img width="125" height="37" alt="[SourceForge]" src="http://sflogo.sourceforge.net/sflogo.php?group_id=1355&amp;type=2&amp;page=rawsock" /></a></td></tr></table></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="fastcgi.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ext-modules.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="wildcard.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">32.12. The FastCGI Interface </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 32.14. The Wildcard Module</td></tr></table></div></body></html>
