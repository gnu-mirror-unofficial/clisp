<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>29.2. Gray streams</title><link rel="stylesheet" href="impnotes.css" type="text/css" /><link rev="made" href="mailto:clisp-list@sf.net" /><meta name="generator" content="DocBook XSL Stylesheets V1.68.1" /><link rel="start" href="index.html" title="Implementation Notes for GNU CLISP" /><link rel="up" href="ext-standard.html" title="Chapter 29. Standard Widely Portable Extensions" /><link rel="prev" href="mop-chap.html" title="29.1. Meta-Object Protocol" /><link rel="next" href="ext-p-indep.html" title="Chapter 30. Platform Independent Extensions" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">29.2. Gray streams</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="mop-chap.html">Prev</a> </td><th width="60%" align="center">Chapter 29. Standard Widely Portable Extensions</th><td width="20%" align="right"> <a accesskey="n" href="ext-p-indep.html">Next</a></td></tr></table><hr /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="gray"></a>29.2. Gray streams</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="gray.html#fill-stream">29.2.1. Class <code class="classname">EXT:FILL-STREAM</code></a></span></dt></dl></div><p>This interface permits the definition of new classes of streams,
and programming their behavior by defining methods for the elementary
stream operations.
It is based on the proposal <a href="ftp://parcftp.xerox.com/pub/cl/cleanup/mail/stream-definition-by-user.mail" target="_top">STREAM-DEFINITION-BY-USER:GENERIC-FUNCTIONS</a> of David N. Gray to X3J13
and is supported by most <a href="http://www.lisp.org" target="_top"><span><strong class="command">Common Lisp</strong></span></a> implementations currently in use.</p><p>All symbols defined by this interface, starting with the prefix
 <code class="literal">FUNDAMENTAL-</code> or <code class="literal">STREAM-</code>,
 are exported from the package <a href="gray.html" title="29.2. Gray streams"><strong class="package">“<span class="quote">GRAY</span>”</strong></a>
 and <a href="pack-dict.html#re-export" title="11.5.3. Function EXT:RE-EXPORT"><code class="function">EXT:RE-EXPORT</code></a>ed from <a href="imppack.html#ext-pac"><strong class="package">“<span class="quote">EXT</span>”</strong></a>.</p><div class="variablelist"><p class="title"><b>Defined classes</b></p><dl><dt><a id="fu-st"></a><a href="gray.html#fu-st"><code class="classname">GRAY:FUNDAMENTAL-STREAM</code></a></dt><dd>This is a superclass of all user-defined streams.
   It is a subclass of <a href="http://www.lisp.org/HyperSpec/Body/syscla_stream.html" target="_top"><code class="classname">STREAM</code></a> and of <a href="http://www.lisp.org/HyperSpec/Body/cla_standard-object.html" target="_top"><code class="classname">STANDARD-OBJECT</code></a>.
   Its metaclass is <a href="http://www.lisp.org/HyperSpec/Body/syscla_standard-class.html" target="_top"><code class="classname">STANDARD-CLASS</code></a>.</dd><dt><a id="fu-st-in"></a><a href="gray.html#fu-st-in"><code class="classname">GRAY:FUNDAMENTAL-INPUT-STREAM</code></a></dt><dd>This is a superclass of all user-defined <a href="http://www.lisp.org/HyperSpec/Body/glo_i.html#input" target="_top">input</a> <a href="http://www.lisp.org/HyperSpec/Body/syscla_stream.html" target="_top"><code class="classname">STREAM</code></a>s.
   It is a subclass of <a href="gray.html#fu-st"><code class="classname">GRAY:FUNDAMENTAL-STREAM</code></a>.  The built-in function <a href="http://www.lisp.org/HyperSpec/Body/fun_input-str_put-stream-p.html" target="_top"><code class="function">INPUT-STREAM-P</code></a>
   returns true on instances of this class.  This means that when you
   define a new stream class capable of doing input, you have to make it
   a subclass of <a href="gray.html#fu-st-in"><code class="classname">GRAY:FUNDAMENTAL-INPUT-STREAM</code></a>.</dd><dt><a id="fu-st-out"></a><a href="gray.html#fu-st-out"><code class="classname">GRAY:FUNDAMENTAL-OUTPUT-STREAM</code></a></dt><dd>This is a superclass of all user-defined <a href="http://www.lisp.org/HyperSpec/Body/glo_o.html#output" target="_top">output</a> <a href="http://www.lisp.org/HyperSpec/Body/syscla_stream.html" target="_top"><code class="classname">STREAM</code></a>s.
   It is a subclass of <a href="gray.html#fu-st"><code class="classname">GRAY:FUNDAMENTAL-STREAM</code></a>.  The built-in function <a href="http://www.lisp.org/HyperSpec/Body/fun_input-str_put-stream-p.html" target="_top"><code class="function">OUTPUT-STREAM-P</code></a>
   returns true on instances of this class.  This means that when you
   define a new stream class capable of doing output, you have to make
   it a subclass of <a href="gray.html#fu-st-out"><code class="classname">GRAY:FUNDAMENTAL-OUTPUT-STREAM</code></a>.</dd><dt><a id="fu-st-char"></a><a href="gray.html#fu-st-char"><code class="classname">GRAY:FUNDAMENTAL-CHARACTER-STREAM</code></a></dt><dd>This is a superclass of all user-defined streams
   whose <a href="http://www.lisp.org/HyperSpec/Body/fun_stream-element-type.html" target="_top"><code class="function">STREAM-ELEMENT-TYPE</code></a> is <a href="http://www.lisp.org/HyperSpec/Body/syscla_character.html" target="_top"><code class="classname">CHARACTER</code></a>.  It is a subclass of
   <a href="gray.html#fu-st"><code class="classname">GRAY:FUNDAMENTAL-STREAM</code></a>.  It defines a method on <a href="http://www.lisp.org/HyperSpec/Body/fun_stream-element-type.html" target="_top"><code class="function">STREAM-ELEMENT-TYPE</code></a> that returns
   <a href="http://www.lisp.org/HyperSpec/Body/syscla_character.html" target="_top"><code class="classname">CHARACTER</code></a>.</dd><dt><a id="fu-st-bin"></a><a href="gray.html#fu-st-bin"><code class="classname">GRAY:FUNDAMENTAL-BINARY-STREAM</code></a></dt><dd>This is a superclass of all user-defined streams
   whose <a href="http://www.lisp.org/HyperSpec/Body/fun_stream-element-type.html" target="_top"><code class="function">STREAM-ELEMENT-TYPE</code></a> is a subtype of <a href="http://www.lisp.org/HyperSpec/Body/syscla_integer.html" target="_top"><code class="classname">INTEGER</code></a>.  It is a
   subclass of <a href="gray.html#fu-st"><code class="classname">GRAY:FUNDAMENTAL-STREAM</code></a>.  When you define a subclass of <a href="gray.html#fu-st-bin"><code class="classname">GRAY:FUNDAMENTAL-BINARY-STREAM</code></a>,
   you have to provide a method on <a href="http://www.lisp.org/HyperSpec/Body/fun_stream-element-type.html" target="_top"><code class="function">STREAM-ELEMENT-TYPE</code></a>.
  </dd><dt><code class="classname">GRAY:FUNDAMENTAL-CHARACTER-INPUT-STREAM</code></dt><dd>This is a convenience class inheriting from both
   <a href="gray.html#fu-st-char"><code class="classname">GRAY:FUNDAMENTAL-CHARACTER-STREAM</code></a> and <a href="gray.html#fu-st-in"><code class="classname">GRAY:FUNDAMENTAL-INPUT-STREAM</code></a>.</dd><dt><code class="classname">GRAY:FUNDAMENTAL-CHARACTER-OUTPUT-STREAM</code></dt><dd>This is a convenience class inheriting from both
   <a href="gray.html#fu-st-char"><code class="classname">GRAY:FUNDAMENTAL-CHARACTER-STREAM</code></a> and <a href="gray.html#fu-st-out"><code class="classname">GRAY:FUNDAMENTAL-OUTPUT-STREAM</code></a>.</dd><dt><code class="classname">GRAY:FUNDAMENTAL-BINARY-INPUT-STREAM</code></dt><dd>This is a convenience class inheriting from both
   <a href="gray.html#fu-st-bin"><code class="classname">GRAY:FUNDAMENTAL-BINARY-STREAM</code></a> and <a href="gray.html#fu-st-in"><code class="classname">GRAY:FUNDAMENTAL-INPUT-STREAM</code></a>.</dd><dt><code class="classname">GRAY:FUNDAMENTAL-BINARY-OUTPUT-STREAM</code></dt><dd>This is a convenience class inheriting from both
   <a href="gray.html#fu-st-bin"><code class="classname">GRAY:FUNDAMENTAL-BINARY-STREAM</code></a> and <a href="gray.html#fu-st-out"><code class="classname">GRAY:FUNDAMENTAL-OUTPUT-STREAM</code></a>.</dd></dl></div><div class="variablelist"><p class="title"><b>General generic functions defined on streams</b></p><dl><dt><code class="code">(<a href="http://www.lisp.org/HyperSpec/Body/fun_stream-element-type.html" target="_top"><code class="function">STREAM-ELEMENT-TYPE</code></a> <em class="replaceable"><code>stream</code></em>)</code></dt><dd><p>Returns the stream's element type, normally a
   subtype of <a href="http://www.lisp.org/HyperSpec/Body/syscla_character.html" target="_top"><code class="classname">CHARACTER</code></a> or <a href="http://www.lisp.org/HyperSpec/Body/syscla_integer.html" target="_top"><code class="classname">INTEGER</code></a>.</p><p>The method for <a href="gray.html#fu-st-char"><code class="classname">GRAY:FUNDAMENTAL-CHARACTER-STREAM</code></a> returns <a href="http://www.lisp.org/HyperSpec/Body/syscla_character.html" target="_top"><code class="classname">CHARACTER</code></a>.
  </p></dd><dt><code class="code">((<a href="http://www.lisp.org/HyperSpec/Body/mac_setfcm_psetf.html" target="_top"><code class="function">SETF</code></a> <a href="http://www.lisp.org/HyperSpec/Body/fun_stream-element-type.html" target="_top"><code class="function">STREAM-ELEMENT-TYPE</code></a>)
    <em class="replaceable"><code>new-element-type</code></em> <em class="replaceable"><code>stream</code></em>)</code></dt><dd><p>Changes the stream's element type.</p><p>The default method <a href="http://www.lisp.org/HyperSpec/Body/fun_signal.html" target="_top"><code class="function">SIGNAL</code></a>s an <a href="http://www.lisp.org/HyperSpec/Body/contyp_error.html" target="_top"><code class="classname">ERROR</code></a>.</p><p>This function is a <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> extension (see <a href="stream-dict.html#stream-eltype" title="21.3.1. Function STREAM-ELEMENT-TYPE">Section 21.3.1, “Function <code class="function">STREAM-ELEMENT-TYPE</code>”</a>).</p></dd><dt><code class="code">(<a href="http://www.lisp.org/HyperSpec/Body/fun_close.html" target="_top"><code class="function">CLOSE</code></a> <em class="replaceable"><code>stream</code></em> <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;KEY</code></a>
    <code class="constant">:ABORT</code>)</code></dt><dd><p>Closes the stream and flushes any associated buffers.
   </p><p>When you define a primary method on this
    function, do not forget to <a href="http://www.lisp.org/HyperSpec/Body/locfun_call-next-method.html" target="_top"><code class="function">CALL-NEXT-METHOD</code></a>.
  </p></dd><dt><code class="code">(<a href="http://www.lisp.org/HyperSpec/Body/fun_open-stream-p.html" target="_top"><code class="function">OPEN-STREAM-P</code></a> <em class="replaceable"><code>stream</code></em>)</code></dt><dd><p>Returns true before the stream has been closed, and
    <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a> after the stream has been closed.</p><p>You do not need to add methods to this function.</p></dd><dt><code class="code">(<code class="function">GRAY:STREAM-POSITION</code>
    <em class="replaceable"><code>stream</code></em> <em class="replaceable"><code>position</code></em>)</code></dt><dd><p>Just like <a href="http://www.lisp.org/HyperSpec/Body/fun_file-position.html" target="_top"><code class="function">FILE-POSITION</code></a>, but <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>
    <em class="replaceable"><code>position</code></em> means inquire.</p><p>You must define a method for this function.</p></dd></dl></div><div class="variablelist"><p class="title"><b>generic functions for character input</b></p><dl><dt><a id="st-rc"></a><code class="code">(<a href="gray.html#st-rc"><code class="function">GRAY:STREAM-READ-CHAR</code></a> <em class="replaceable"><code>stream</code></em>)</code></dt><dd><p>If a character was pushed back using <a href="gray.html#st-uc"><code class="function">GRAY:STREAM-UNREAD-CHAR</code></a>,
   returns and consumes it.  Otherwise returns and consumes the next
   character from the stream. Returns <code class="constant">:EOF</code> if the <a href="http://www.lisp.org/HyperSpec/Body/glo_e.html#end_of_file" target="_top"><code class="literal">end-of-stream</code></a> is reached.
   </p><p>You must define a method for this function.</p></dd><dt><a id="st-uc"></a><code class="code">(<a href="gray.html#st-uc"><code class="function">GRAY:STREAM-UNREAD-CHAR</code></a> <em class="replaceable"><code>stream</code></em> <em class="replaceable"><code>char</code></em>)</code></dt><dd><p>Pushes <em class="replaceable"><code>char</code></em>, which must be the last character
   read from the <em class="replaceable"><code>stream</code></em>, back onto the front of the <em class="replaceable"><code>stream</code></em>.
   </p><p>You must define a method for this function.</p></dd><dt><a id="st-rcnh"></a><code class="code">(<a href="gray.html#st-rcnh"><code class="function">GRAY:STREAM-READ-CHAR-NO-HANG</code></a> <em class="replaceable"><code>stream</code></em>)</code></dt><dd><p>Returns a character or <code class="constant">:EOF</code>, like <a href="gray.html#st-rc"><code class="function">GRAY:STREAM-READ-CHAR</code></a>, if
   that would return immediately.  If <a href="gray.html#st-rc"><code class="function">GRAY:STREAM-READ-CHAR</code></a>'s value is not available
   immediately, returns <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a> instead of waiting.</p><p>
   The default method simply calls <a href="gray.html#st-rc"><code class="function">GRAY:STREAM-READ-CHAR</code></a>; this is sufficient for streams
   whose <a href="gray.html#st-rc"><code class="function">GRAY:STREAM-READ-CHAR</code></a> method never blocks.</p></dd><dt><code class="code">(<code class="function">GRAY:STREAM-PEEK-CHAR</code>
    <em class="replaceable"><code>stream</code></em>)</code></dt><dd><p>If a character was pushed back using <a href="gray.html#st-uc"><code class="function">GRAY:STREAM-UNREAD-CHAR</code></a>,
   returns it.  Otherwise returns the next character from the stream,
   avoiding any side effects <a href="gray.html#st-rc"><code class="function">GRAY:STREAM-READ-CHAR</code></a> would do.  Returns <code class="constant">:EOF</code> if the
   <a href="http://www.lisp.org/HyperSpec/Body/glo_e.html#end_of_file" target="_top"><code class="literal">end-of-stream</code></a> is reached.</p><p>The default method calls <a href="gray.html#st-rc"><code class="function">GRAY:STREAM-READ-CHAR</code></a> and <a href="gray.html#st-uc"><code class="function">GRAY:STREAM-UNREAD-CHAR</code></a>; this is
   sufficient for streams whose <a href="gray.html#st-rc"><code class="function">GRAY:STREAM-READ-CHAR</code></a> method has no
   side-effects.</p></dd><dt><code class="code">(<code class="function">GRAY:STREAM-LISTEN</code>
    <em class="replaceable"><code>stream</code></em>)</code></dt><dd><p>If a character was pushed back using <a href="gray.html#st-uc"><code class="function">GRAY:STREAM-UNREAD-CHAR</code></a>,
   returns it.  Otherwise returns the next character from the stream, if
   already available.  If no character is available immediately, or if
   <a href="http://www.lisp.org/HyperSpec/Body/glo_e.html#end_of_file" target="_top"><code class="literal">end-of-stream</code></a> is reached, returns <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>.</p><p>The default method calls <a href="gray.html#st-rcnh"><code class="function">GRAY:STREAM-READ-CHAR-NO-HANG</code></a> and <a href="gray.html#st-uc"><code class="function">GRAY:STREAM-UNREAD-CHAR</code></a>; this is
   sufficient for streams whose <a href="gray.html#st-rc"><code class="function">GRAY:STREAM-READ-CHAR</code></a> method has no
   side-effects.</p></dd><dt><code class="code">(<code class="function">GRAY:STREAM-READ-CHAR-WILL-HANG-P</code>
    <em class="replaceable"><code>stream</code></em>)</code></dt><dd><p>Returns <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a> if <a href="gray.html#st-rc"><code class="function">GRAY:STREAM-READ-CHAR</code></a> will return immediately.
   Otherwise it returns true.</p><p>The default method calls <a href="gray.html#st-rcnh"><code class="function">GRAY:STREAM-READ-CHAR-NO-HANG</code></a> and <a href="gray.html#st-uc"><code class="function">GRAY:STREAM-UNREAD-CHAR</code></a>; this is
   sufficient for streams whose <a href="gray.html#st-rc"><code class="function">GRAY:STREAM-READ-CHAR</code></a> method has no side-effects.</p><p>This function is a <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> extension (see <a href="stream-dict.html#rcwhp"><code class="function">EXT:READ-CHAR-WILL-HANG-P</code></a>).</p></dd><dt><code class="code">(<code class="function">GRAY:STREAM-READ-CHAR-SEQUENCE</code> <em class="replaceable"><code>stream</code></em>
   <em class="replaceable"><code>sequence</code></em> <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;OPTIONAL</code></a> [<em class="replaceable"><code>start</code></em> [<em class="replaceable"><code>end</code></em>]])</code></dt><dd><p>Fills the subsequence of <em class="replaceable"><code>sequence</code></em> specified by
   <code class="constant">:START</code> and <code class="constant">:END</code> with characters consecutively read from <em class="replaceable"><code>stream</code></em>.
   Returns the index of the first element of <em class="replaceable"><code>sequence</code></em> that was not
   updated (<a href="http://www.lisp.org/HyperSpec/Body/fun_eqcm_sleq__lteqcm_gteq.html" target="_top"><code class="function">=</code></a> <em class="replaceable"><code>end</code></em>, or <a href="http://www.lisp.org/HyperSpec/Body/fun_eqcm_sleq__lteqcm_gteq.html" target="_top"><code class="function">&lt;</code></a> <em class="replaceable"><code>end</code></em> if the stream reached its end).
   </p><p><em class="replaceable"><code>sequence</code></em> is an <a href="http://www.lisp.org/HyperSpec/Body/syscla_array.html" target="_top"><code class="classname">ARRAY</code></a> of <a href="http://www.lisp.org/HyperSpec/Body/syscla_character.html" target="_top"><code class="classname">CHARACTER</code></a>s, i.e. a <a href="http://www.lisp.org/HyperSpec/Body/syscla_string.html" target="_top"><code class="classname">STRING</code></a>.
   <em class="replaceable"><code>start</code></em> is a nonnegative <a href="http://www.lisp.org/HyperSpec/Body/syscla_integer.html" target="_top"><code class="classname">INTEGER</code></a> and defaults to <code class="literal">0</code>.
   <em class="replaceable"><code>end</code></em> is a nonnegative <a href="http://www.lisp.org/HyperSpec/Body/syscla_integer.html" target="_top"><code class="classname">INTEGER</code></a> or <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a> and defaults to <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>,
   which stands for <code class="code">(<a href="http://www.lisp.org/HyperSpec/Body/fun_length.html" target="_top"><code class="function">LENGTH</code></a> <em class="replaceable"><code>sequence</code></em>)</code>.
  </p><p>The default method repeatedly calls <a href="gray.html#st-rc"><code class="function">GRAY:STREAM-READ-CHAR</code></a>; this
   is always sufficient if speed does not matter.</p><p>This function is a <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> extension (see
   <a href="stream-dict.html#rd-ch-seq"><code class="function">EXT:READ-CHAR-SEQUENCE</code></a>).</p></dd><dt><code class="code">(<code class="function">GRAY:STREAM-READ-LINE</code>
    <em class="replaceable"><code>stream</code></em>)</code></dt><dd><p>Reads a line of characters, and return two values:
   the line (a <a href="http://www.lisp.org/HyperSpec/Body/syscla_string.html" target="_top"><code class="classname">STRING</code></a>, without the terminating <span class="keysym">#\Newline</span> character),
   and a <a href="http://www.lisp.org/HyperSpec/Body/typ_boolean.html" target="_top"><code class="classname">BOOLEAN</code></a> value which is true if the line was terminated by
   <a href="http://www.lisp.org/HyperSpec/Body/glo_e.html#end_of_file" target="_top"><code class="literal">end-of-stream</code></a> instead of <span class="keysym">#\Newline</span>.</p><p>The default method repeatedly calls <a href="gray.html#st-rc"><code class="function">GRAY:STREAM-READ-CHAR</code></a>; this
   is always sufficient.</p></dd><dt><code class="code">(<code class="function">GRAY:STREAM-CLEAR-INPUT</code>
    <em class="replaceable"><code>stream</code></em>)</code></dt><dd><p>Clears all pending interactive input from the
   <em class="replaceable"><code>stream</code></em>, and returns true if some pending input was removed.</p><p>The default method does nothing and returns <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>; this is
   sufficient for non-interactive streams.</p></dd></dl></div><div class="variablelist"><p class="title"><b>generic functions for character output</b></p><dl><dt><a id="st-wc"></a><code class="code">(<a href="gray.html#st-wc"><code class="function">GRAY:STREAM-WRITE-CHAR</code></a> <em class="replaceable"><code>stream</code></em> <em class="replaceable"><code>char</code></em>)</code></dt><dd><p>Writes <em class="replaceable"><code>char</code></em>.
   </p><p>You must define a method for this function.</p></dd><dt><a id="st-lc"></a><code class="code">(<a href="gray.html#st-lc"><code class="function">GRAY:STREAM-LINE-COLUMN</code></a> <em class="replaceable"><code>stream</code></em>)</code></dt><dd><p>Returns the column number where the next character
   would be written (<code class="literal">0</code> stands for the first column),
    or <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a> if that is not meaningful for this stream.
   </p><p>You must define a method for this function.</p></dd><dt><code class="code">(<code class="function">GRAY:STREAM-START-LINE-P</code>
                 <em class="replaceable"><code>stream</code></em>)</code></dt><dd><p>Returns true if the next character would be
   written at the start of a new line.</p><p>The default method calls <a href="gray.html#st-lc"><code class="function">GRAY:STREAM-LINE-COLUMN</code></a> and compares its result with
   0; this is sufficient for streams whose <a href="gray.html#st-lc"><code class="function">GRAY:STREAM-LINE-COLUMN</code></a> never returns <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>.
  </p></dd><dt><code class="code">(<code class="function">GRAY:STREAM-WRITE-CHAR-SEQUENCE</code>
    <em class="replaceable"><code>stream</code></em> <em class="replaceable"><code>sequence</code></em> <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;OPTIONAL</code></a> [<em class="replaceable"><code>start</code></em> [<em class="replaceable"><code>end</code></em>]])</code></dt><dd><p>Outputs the subsequence of <em class="replaceable"><code>sequence</code></em> specified
   by <code class="constant">:START</code> and <code class="constant">:END</code> to <em class="replaceable"><code>stream</code></em>.</p><p><em class="replaceable"><code>sequence</code></em> is an <a href="http://www.lisp.org/HyperSpec/Body/syscla_array.html" target="_top"><code class="classname">ARRAY</code></a> of <a href="http://www.lisp.org/HyperSpec/Body/syscla_character.html" target="_top"><code class="classname">CHARACTER</code></a>s, i.e. a <a href="http://www.lisp.org/HyperSpec/Body/syscla_string.html" target="_top"><code class="classname">STRING</code></a>.
   <em class="replaceable"><code>start</code></em> is a nonnegative <a href="http://www.lisp.org/HyperSpec/Body/syscla_integer.html" target="_top"><code class="classname">INTEGER</code></a> and defaults to 0.
   <em class="replaceable"><code>end</code></em> is a nonnegative integer or <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a> and defaults to <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>,
   which stands for <code class="code">(<a href="http://www.lisp.org/HyperSpec/Body/fun_length.html" target="_top"><code class="function">LENGTH</code></a> <em class="replaceable"><code>sequence</code></em>)</code>.
  </p><p>The default method repeatedly calls <a href="gray.html#st-wc"><code class="function">GRAY:STREAM-WRITE-CHAR</code></a>; this
   is always sufficient if speed does not matter.
  </p><p>This function is a <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> extension
   (see <a href="stream-dict.html#wr-ch-seq"><code class="function">EXT:WRITE-CHAR-SEQUENCE</code></a>).</p></dd><dt><code class="code">(<code class="function">GRAY:STREAM-WRITE-STRING</code>
    <em class="replaceable"><code>stream</code></em> <em class="replaceable"><code>string</code></em> <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;OPTIONAL</code></a> [<em class="replaceable"><code>start</code></em> [<em class="replaceable"><code>end</code></em>]])</code></dt><dd><p>Outputs the subsequence of <em class="replaceable"><code>string</code></em> specified by
   <code class="constant">:START</code> and <code class="constant">:END</code> to <em class="replaceable"><code>stream</code></em>.  Returns <em class="replaceable"><code>string</code></em>.</p><p><em class="replaceable"><code>string</code></em> is a string.  <em class="replaceable"><code>start</code></em> is a nonnegative integer
   and default to 0.  <em class="replaceable"><code>end</code></em> is a nonnegative integer or <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a> and
   defaults to <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>, which stands for <code class="code">(<a href="http://www.lisp.org/HyperSpec/Body/fun_length.html" target="_top"><code class="function">LENGTH</code></a> <em class="replaceable"><code>string</code></em>)</code>.
   </p><p>The default method calls
   <code class="function">GRAY:STREAM-WRITE-CHAR-SEQUENCE</code>;
   this is always sufficient.</p></dd><dt><code class="code">(<code class="function">GRAY:STREAM-TERPRI</code>
                 <em class="replaceable"><code>stream</code></em>)</code></dt><dd><p>Outputs a <span class="keysym">#\Newline</span> character.</p><p>The default method calls <a href="gray.html#st-wc"><code class="function">GRAY:STREAM-WRITE-CHAR</code></a>; this is always
   sufficient.</p></dd><dt><code class="code">(<code class="function">GRAY:STREAM-FRESH-LINE</code>
                 <em class="replaceable"><code>stream</code></em>)</code></dt><dd><p>Possibly outputs a <span class="keysym">#\Newline</span> character, so as to ensure
   that the next character would be written at the start of a new line.
   Returns true if it did output a <span class="keysym">#\Newline</span> character.</p><p>The default method calls
   <code class="function">GRAY:STREAM-START-LINE-P</code> and then
   <code class="function">GRAY:STREAM-TERPRI</code> if necessary; this is always
   sufficient.</p></dd><dt><code class="code">(<code class="function">GRAY:STREAM-FINISH-OUTPUT</code>
                 <em class="replaceable"><code>stream</code></em>)</code></dt><dd><p>Ensures that any buffered output has reached its
   destination, and then returns.</p><p>The default method does nothing.</p></dd><dt><code class="code">(<code class="function">GRAY:STREAM-FORCE-OUTPUT</code>
                 <em class="replaceable"><code>stream</code></em>)</code></dt><dd><p>Brings any buffered output on its way towards its
   destination, and returns without waiting until it has reached its
   destination.</p><p>The default method does nothing.</p></dd><dt><code class="code">(<code class="function">GRAY:STREAM-CLEAR-OUTPUT</code>
                 <em class="replaceable"><code>stream</code></em>)</code></dt><dd><p>Attempts to discard any buffered output which has
   not yet reached its destination.</p><p>The default method does nothing.</p></dd><dt><code class="code">(<code class="function">GRAY:STREAM-ADVANCE-TO-COLUMN</code>
                 <em class="replaceable"><code>stream</code></em> <em class="replaceable"><code>column</code></em>)</code></dt><dd><p>Ensures that the next character will be written at
   <em class="replaceable"><code>column</code></em> at least.</p><p>The default method outputs an appropriate amount of space
   characters; this is sufficient for non-proportional output.</p></dd></dl></div><div class="variablelist"><p class="title"><b>generic functions for binary input</b></p><dl><dt><a id="st-rb"></a><code class="code">(<a href="gray.html#st-rb"><code class="function">GRAY:STREAM-READ-BYTE</code></a> <em class="replaceable"><code>stream</code></em>)</code></dt><dd><p>Returns and consumes the next integer from the
   stream. Returns <code class="constant">:EOF</code> if the <a href="http://www.lisp.org/HyperSpec/Body/glo_e.html#end_of_file" target="_top"><code class="literal">end-of-stream</code></a> is reached.</p><p>You must define a method for this function.</p></dd><dt><a id="st-rbla"></a><code class="code">(<a href="gray.html#st-rbla"><code class="function">GRAY:STREAM-READ-BYTE-LOOKAHEAD</code></a> <em class="replaceable"><code>stream</code></em>)</code></dt><dd><p>To be called only if <em class="replaceable"><code>stream</code></em>'s
   <a href="http://www.lisp.org/HyperSpec/Body/fun_stream-element-type.html" target="_top"><code class="function">STREAM-ELEMENT-TYPE</code></a> is <span class="type"><code class="literal">(<a href="http://www.lisp.org/HyperSpec/Body/typ_unsigned-byte.html" target="_top"><code class="classname">UNSIGNED-BYTE</code></a> 8)</code></span> or <span class="type"><code class="literal">(<a href="http://www.lisp.org/HyperSpec/Body/typ_signed-byte.html" target="_top"><code class="classname">SIGNED-BYTE</code></a> 8)</code></span>.
   Returns <a href="http://www.lisp.org/HyperSpec/Body/convar_t.html" target="_top"><code class="constant">T</code></a> if <a href="gray.html#st-rb"><code class="function">GRAY:STREAM-READ-BYTE</code></a> would return immediately with an
   <a href="http://www.lisp.org/HyperSpec/Body/syscla_integer.html" target="_top"><code class="classname">INTEGER</code></a> result.  Returns <code class="constant">:EOF</code> if the <a href="http://www.lisp.org/HyperSpec/Body/glo_e.html#end_of_file" target="_top"><code class="literal">end-of-stream</code></a> is already
   known to be reached.  If <a href="gray.html#st-rb"><code class="function">GRAY:STREAM-READ-BYTE</code></a>'s value is not available
   immediately, returns <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a> instead of waiting.</p><p>You must define a method for this function.</p><p>This function is a <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> extension (see
   <a href="stream-dict.html#rbla"><code class="function">EXT:READ-BYTE-LOOKAHEAD</code></a>).</p></dd><dt><code class="code">(<code class="function">GRAY:STREAM-READ-BYTE-WILL-HANG-P</code>
                 <em class="replaceable"><code>stream</code></em>)</code></dt><dd><p>To be called only if <em class="replaceable"><code>stream</code></em>'s
   <a href="http://www.lisp.org/HyperSpec/Body/fun_stream-element-type.html" target="_top"><code class="function">STREAM-ELEMENT-TYPE</code></a> is <span class="type"><code class="literal">(<a href="http://www.lisp.org/HyperSpec/Body/typ_unsigned-byte.html" target="_top"><code class="classname">UNSIGNED-BYTE</code></a> 8)</code></span> or <span class="type"><code class="literal">(<a href="http://www.lisp.org/HyperSpec/Body/typ_signed-byte.html" target="_top"><code class="classname">SIGNED-BYTE</code></a> 8)</code></span>.
   Returns <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a> if <a href="gray.html#st-rb"><code class="function">GRAY:STREAM-READ-BYTE</code></a> will return immediately.
   Otherwise it returns true.</p><p>The default method calls <a href="gray.html#st-rbla"><code class="function">GRAY:STREAM-READ-BYTE-LOOKAHEAD</code></a>; this is always sufficient.
   </p><p>This function is a <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> extension (see <a href="stream-dict.html#rbwhp"><code class="function">EXT:READ-BYTE-WILL-HANG-P</code></a>).
 </p></dd><dt><code class="code">(<code class="function">GRAY:STREAM-READ-BYTE-NO-HANG</code>
                 <em class="replaceable"><code>stream</code></em>)</code></dt><dd><p>To be called only if <em class="replaceable"><code>stream</code></em>'s
   <a href="http://www.lisp.org/HyperSpec/Body/fun_stream-element-type.html" target="_top"><code class="function">STREAM-ELEMENT-TYPE</code></a> is <span class="type"><code class="literal">(<a href="http://www.lisp.org/HyperSpec/Body/typ_unsigned-byte.html" target="_top"><code class="classname">UNSIGNED-BYTE</code></a> 8)</code></span> or <span class="type"><code class="literal">(<a href="http://www.lisp.org/HyperSpec/Body/typ_signed-byte.html" target="_top"><code class="classname">SIGNED-BYTE</code></a> 8)</code></span>.
   Returns an <a href="http://www.lisp.org/HyperSpec/Body/syscla_integer.html" target="_top"><code class="classname">INTEGER</code></a> or <code class="constant">:EOF</code>, like <a href="gray.html#st-rb"><code class="function">GRAY:STREAM-READ-BYTE</code></a>, if that would
   return immediately.  If <a href="gray.html#st-rb"><code class="function">GRAY:STREAM-READ-BYTE</code></a>'s value is not available immediately,
   returns <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a> instead of waiting.</p><p>The default method calls <a href="gray.html#st-rb"><code class="function">GRAY:STREAM-READ-BYTE</code></a> if <a href="gray.html#st-rbla"><code class="function">GRAY:STREAM-READ-BYTE-LOOKAHEAD</code></a> returns true;
    this is always sufficient.</p><p>This function is a <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> extension (see <a href="stream-dict.html#rbnh"><code class="function">EXT:READ-BYTE-NO-HANG</code></a>).
 </p></dd><dt><code class="code">(<code class="function">GRAY:STREAM-READ-BYTE-SEQUENCE</code>
     <em class="replaceable"><code>stream</code></em> <em class="replaceable"><code>sequence</code></em> <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;OPTIONAL</code></a>
      [<em class="replaceable"><code>start</code></em> [<em class="replaceable"><code>end</code></em> [<em class="replaceable"><code>no-hang</code></em> [<em class="replaceable"><code>interactive</code></em>]]]])</code></dt><dd><p>Fills the subsequence of <em class="replaceable"><code>sequence</code></em> specified by
    <code class="constant">:START</code> and <code class="constant">:END</code> with integers consecutively read from <em class="replaceable"><code>stream</code></em>.
    Returns the index of the first element of <em class="replaceable"><code>sequence</code></em> that was not
    updated (<a href="http://www.lisp.org/HyperSpec/Body/fun_eqcm_sleq__lteqcm_gteq.html" target="_top"><code class="function">=</code></a> <em class="replaceable"><code>end</code></em>, or <a href="http://www.lisp.org/HyperSpec/Body/fun_eqcm_sleq__lteqcm_gteq.html" target="_top"><code class="function">&lt;</code></a> <em class="replaceable"><code>end</code></em> if the stream reached its end).
   </p><p><em class="replaceable"><code>sequence</code></em> is an <a href="http://www.lisp.org/HyperSpec/Body/syscla_array.html" target="_top"><code class="classname">ARRAY</code></a> of <a href="http://www.lisp.org/HyperSpec/Body/syscla_integer.html" target="_top"><code class="classname">INTEGER</code></a>s.
    <em class="replaceable"><code>start</code></em> is a nonnegative <a href="http://www.lisp.org/HyperSpec/Body/syscla_integer.html" target="_top"><code class="classname">INTEGER</code></a> and defaults to 0.
    <em class="replaceable"><code>end</code></em> is a nonnegative <a href="http://www.lisp.org/HyperSpec/Body/syscla_integer.html" target="_top"><code class="classname">INTEGER</code></a> or <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a> and defaults to <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>,
    which stands for <code class="code">(<a href="http://www.lisp.org/HyperSpec/Body/fun_length.html" target="_top"><code class="function">LENGTH</code></a> <em class="replaceable"><code>sequence</code></em>)</code>.
    If <em class="replaceable"><code>no-hang</code></em> is true, the function should avoid blocking and instead fill
    only as many elements as are immediately available. If <em class="replaceable"><code>no-hang</code></em> is false
    and <em class="replaceable"><code>interactive</code></em> is true, the function can block for reading the first
    byte but should avoid blocking for any further bytes.</p><p>The default method repeatedly calls <a href="gray.html#st-rb"><code class="function">GRAY:STREAM-READ-BYTE</code></a>; this
    is always sufficient if speed does not matter.</p><p>This function is a <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> extension (see
    <a href="stream-dict.html#rd-by-seq"><code class="function">EXT:READ-BYTE-SEQUENCE</code></a>).</p></dd></dl></div><div class="variablelist"><p class="title"><b>generic functions for binary output</b></p><dl><dt><code class="code">(<code class="function">GRAY:STREAM-WRITE-BYTE</code>
                 <em class="replaceable"><code>stream</code></em> <em class="replaceable"><code>integer</code></em>)</code></dt><dd><p>Writes <em class="replaceable"><code>integer</code></em>.</p><p>You must define a method for this function.</p></dd><dt><code class="code">(<code class="function">GRAY:STREAM-WRITE-BYTE-SEQUENCE</code>
     <em class="replaceable"><code>stream</code></em> <em class="replaceable"><code>sequence</code></em> <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;OPTIONAL</code></a>
      [<em class="replaceable"><code>start</code></em> [<em class="replaceable"><code>end</code></em> [<em class="replaceable"><code>no-hang</code></em>]]])</code></dt><dd><p>Outputs the subsequence of <em class="replaceable"><code>sequence</code></em> specified
    by <code class="constant">:START</code> and <code class="constant">:END</code> to <em class="replaceable"><code>stream</code></em></p><p><em class="replaceable"><code>sequence</code></em> is an <a href="http://www.lisp.org/HyperSpec/Body/syscla_array.html" target="_top"><code class="classname">ARRAY</code></a> of <a href="http://www.lisp.org/HyperSpec/Body/syscla_integer.html" target="_top"><code class="classname">INTEGER</code></a>s.
    <em class="replaceable"><code>start</code></em> is a nonnegative <a href="http://www.lisp.org/HyperSpec/Body/syscla_integer.html" target="_top"><code class="classname">INTEGER</code></a> and defaults to 0.
    <em class="replaceable"><code>end</code></em> is a nonnegative <a href="http://www.lisp.org/HyperSpec/Body/syscla_integer.html" target="_top"><code class="classname">INTEGER</code></a> or <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a> and defaults to <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>,
    which stands for <code class="code">(<a href="http://www.lisp.org/HyperSpec/Body/fun_length.html" target="_top"><code class="function">LENGTH</code></a> <em class="replaceable"><code>sequence</code></em>)</code>.
    If <em class="replaceable"><code>no-hang</code></em> is true, the function should avoid blocking and instead output
    only as many elements as it can immediately proceed. If <em class="replaceable"><code>no-hang</code></em> is false
    and <em class="replaceable"><code>interactive</code></em> is true, the function can block for writing the first
    byte but should avoid blocking for any further bytes.</p><p>The default method repeatedly calls
    <code class="function">GRAY:STREAM-WRITE-BYTE</code>; this is always
    sufficient if speed does not matter.</p><p>This function is a <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> extension (see
    <a href="stream-dict.html#wr-by-seq"><code class="function">EXT:WRITE-BYTE-SEQUENCE</code></a>).</p></dd></dl></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="fill-stream"></a>29.2.1. Class <a href="gray.html#fill-stream" title="29.2.1. Class EXT:FILL-STREAM"><code class="classname">EXT:FILL-STREAM</code></a></h3></div></div></div><p>As an example of the use of <a href="gray.html" title="29.2. Gray streams"><strong class="package">“<span class="quote">GRAY</span>”</strong></a> <a href="http://www.lisp.org/HyperSpec/Body/syscla_stream.html" target="_top"><code class="classname">STREAM</code></a>s, <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a>
 offers an additional class, <a href="gray.html#fill-stream" title="29.2.1. Class EXT:FILL-STREAM"><code class="classname">EXT:FILL-STREAM</code></a>.  An instance of this class
 is a “<span class="quote">formatting</span>” <a href="http://www.lisp.org/HyperSpec/Body/syscla_stream.html" target="_top"><code class="classname">STREAM</code></a>, which makes the final
 output to the underlying stream look neat: indented and filled.
 An instance of <a href="gray.html#fill-stream" title="29.2.1. Class EXT:FILL-STREAM"><code class="classname">EXT:FILL-STREAM</code></a> is created like this:
</p><pre class="programlisting">
(<a href="http://www.lisp.org/HyperSpec/Body/stagenfun_make-instance.html" target="_top"><code class="function">MAKE-INSTANCE</code></a> '<a href="gray.html#fill-stream" title="29.2.1. Class EXT:FILL-STREAM"><code class="classname">EXT:FILL-STREAM</code></a> :stream <em class="replaceable"><code>stream</code></em>
               [:text-indent symbol-or-number]
               [:sexp-indent symbol-or-number-or-function])
</pre><p>where</p><div class="variablelist"><dl><dt><em class="replaceable"><code>stream</code></em></dt><dd>is the target <a href="http://www.lisp.org/HyperSpec/Body/syscla_stream.html" target="_top"><code class="classname">STREAM</code></a> where the output actually
    goes.</dd><dt><em class="replaceable"><code>symbol-or-number</code></em></dt><dd>is the variable whose value is the <a href="http://www.lisp.org/HyperSpec/Body/syscla_integer.html" target="_top"><code class="classname">INTEGER</code></a> text
    indentation or the indentation itself (defaults to 0).
 </dd><dt><em class="replaceable"><code>symbol-or-number-or-function</code></em></dt><dd><p>When <a href="http://www.lisp.org/HyperSpec/Body/fun_format.html" target="_top"><code class="function">FORMAT</code></a> writes an S-expression to a
    <a href="gray.html#fill-stream" title="29.2.1. Class EXT:FILL-STREAM"><code class="classname">EXT:FILL-STREAM</code></a> using <a href="http://www.lisp.org/HyperSpec/Body/sec_22-3-4-2.html" target="_top"><code class="literal">~S</code></a>, and the expression's printed
    representation does not fit on the current line, it is printed on
    separate lines, ignoring the prescribed text indentation and
    preserving spacing.  When this argument is non-<a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>, the
    S-expression <span class="strong"><strong>is</strong></span> indented by:</p><div class="variablelist"><dl><dt><a href="http://www.lisp.org/HyperSpec/Body/convar_t.html" target="_top"><code class="constant">T</code></a></dt><dd>the text indentation above;
     </dd><dt><a href="http://www.lisp.org/HyperSpec/Body/syscla_symbol.html" target="_top"><code class="classname">SYMBOL</code></a></dt><dd><a href="http://www.lisp.org/HyperSpec/Body/acc_symbol-value.html" target="_top"><code class="function">SYMBOL-VALUE</code></a> is the indentation;
     </dd><dt><a href="http://www.lisp.org/HyperSpec/Body/syscla_integer.html" target="_top"><code class="classname">INTEGER</code></a></dt><dd>the indentation itself;
     </dd><dt><a href="http://www.lisp.org/HyperSpec/Body/syscla_function.html" target="_top"><code class="classname">FUNCTION</code></a></dt><dd>called with one argument, the text indentation,
        and the value is used as S-expression indentation;
        thus <a href="http://www.lisp.org/HyperSpec/Body/fun_identity.html" target="_top"><code class="function">IDENTITY</code></a> is equivalent to <a href="http://www.lisp.org/HyperSpec/Body/convar_t.html" target="_top"><code class="constant">T</code></a> above.
    </dd></dl></div><p>
    Defaults to <a href="gray.html#fill-stream" class="olink"><code class="varname">CUSTOM:*FILL-INDENT-SEXP*</code></a>, whose initial value is <a href="http://www.lisp.org/HyperSpec/Body/fun_1plcm_1-.html" target="_top"><code class="function">1+</code></a>.
</p></dd></dl></div><p></p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>Note that, due to buffering, one must call <a href="http://www.lisp.org/HyperSpec/Body/fun_finish-ou_clear-output.html" target="_top"><code class="function">FORCE-OUTPUT</code></a>
 when done with the <a href="gray.html#fill-stream" title="29.2.1. Class EXT:FILL-STREAM"><code class="classname">EXT:FILL-STREAM</code></a> (and before changing the indent variable).
 The former is done automatically by the macro
<code class="code">(with-fill-stream (fill target-stream ...) ...)</code>.</p></div><div class="example"><a id="ex-fill-stream"></a><p class="title"><b>Example 29.1. Example of <a href="gray.html#fill-stream" title="29.2.1. Class EXT:FILL-STREAM"><code class="classname">EXT:FILL-STREAM</code></a> usage</b></p><pre class="programlisting">
(defvar *my-indent-level*)
(with-output-to-string (out)
  (let ((*print-right-margin* 20)
        (*print-pretty* t)
        (*my-indent-level* 2))
    (with-fill-stream (fill out :text-indent '*my-indent-level*)
      (format fill "~%this is some long sentence which will      be broken at spaces")
      (force-output fill)
      (let ((*my-indent-level* 5))
        (format fill "~%and    properly indented to the level specified by the ~S argument which can be a ~S or an ~S - cool!"
                :TEXT-INDENT 'symbol 'integer))
      (format fill "~%Don't forget  to call ~S on it, and/or use ~S   Pretty formatting of the  S-expressions    printed with ~~S is  preserved: ~S"
              'force-output 'with-fill-stream '(defun foo (x y z) (if x (+ y z) (* y z)))))))
⇒ <code class="computeroutput">"
  this is some long
  sentence which
  will be broken at
  spaces
     and properly
     indented to
     the level
     specified by
     the :TEXT-INDENT
     argument which
     can be a
SYMBOL
     or an INTEGER
     - cool!
  Don't forget to
  call FORCE-OUTPUT
  on it, and/or use
WITH-FILL-STREAM
  Pretty formatting
  of the
  S-expressions
  printed with ~S
  is preserved:
(DEFUN FOO (X Y Z)
 (IF X (+ Y Z)
  (* Y Z)))
"</code></pre></div></div></div><div class="bookinfo"><hr width="100%" /><table width="100%" summary="impnotes meta info"><th><td align="left">These notes document <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> version 2.35</td><td align="right">Last modified: 2005-08-29</td></th></table></div><div class="custom-footer"><hr width="100%" /><table width="100%"><tr><td align="left"><a href="http://clisp.cons.org"><img src="clisp.png" width="48" height="48" alt="[CLISP home]" /></a></td><td align="center"><a href="http://www.gnu.org"><img src="http://www.gnu.org/graphics/gnubanner.jpg" width="468" height="60" alt="[Come and see what GNU creates for YOU]" /></a></td><td align="right"><a href="http://sourceforge.net"><img width="125" height="37" alt="[SourceForge]" src="http://sflogo.sourceforge.net/sflogo.php?group_id=1355&amp;type=2&amp;page=gray" /></a></td></tr></table></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="mop-chap.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ext-standard.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ext-p-indep.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">29.1. Meta-Object Protocol </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 30. Platform Independent Extensions</td></tr></table></div></body></html>
