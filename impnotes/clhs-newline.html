<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>13.8. Treatment of Newline during Input and Output
   [CLHS-13.1.8]</title><link rel="stylesheet" href="impnotes.css" type="text/css" /><link rev="made" href="mailto:clisp-list@lists.sourceforge.net" /><meta name="generator" content="DocBook XSL Stylesheets V1.69.1" /><link rel="start" href="index.html" title="Implementation Notes for GNU CLISP" /><link rel="up" href="characters.html" title="Chapter 13. Characters&#10;   [CLHS-13]" /><link rel="prev" href="char-ord.html" title="13.7. Ordering of Characters&#10;   [CLHS-13.1.6]" /><link rel="next" href="char-int.html" title="13.9. Character Encodings&#10;   [CLHS-13.1.9]" /><meta name="date" content="'generated: 2006-07-15 04:20:48-04:00'" /><link rel="author" title="Authors" href="index.html#authors" /><link rel="contents" title="Table of Contents" href="index.html" /><link rel="glossary" href="glossary.html" /><link rel="help" href="faq.html#faq-help" title="How do I ask for help?" /><link rel="home" title="Home" href="http://clisp.cons.org" /><link rel="index" href="idx.html" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">13.8. Treatment of Newline during Input and Output
   [CLHS-13.1.8]</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="char-ord.html">Prev</a> </td><th width="60%" align="center">Chapter 13. Characters
   [CLHS-13]</th><td width="20%" align="right"> <a accesskey="n" href="char-int.html">Next</a></td></tr></table><hr /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="clhs-newline"></a>13.8. Treatment of Newline during Input and Output
   <a href="http://www.lisp.org/HyperSpec/Body/sec_13-1-8.html" target="_top">[CLHS-13.1.8]</a></h2></div></div></div><p>Newlines are written according to the stream's <a href="encoding.html" title="30.5. Encodings"><code class="classname">EXT:ENCODING</code></a>, see the
 function <a href="http://www.lisp.org/HyperSpec/Body/fun_stream-external-format.html" target="_top"><code class="function">STREAM-EXTERNAL-FORMAT</code></a> and the description of <a href="encoding.html" title="30.5. Encodings"><code class="classname">EXT:ENCODING</code></a>s,
 in particular, <a href="encoding.html#newline" title="30.5.3. Line Terminators">line terminator</a>s.
 The default behavior is as follows:</p>
<!--#if defined(WIN32) || (defined(UNIX) && (O_BINARY != 0))-->
<div class="variablelist"><dl><dt><span class="term"><span class="plat-dep">Platform Dependent: <span class="plat-dep"><a href="http://winehq.com/" target="_top"><span class="platform">Win32</span></a> platform only.</span></span></span></dt><dd>When writing to a file, <span class="keysym">#\Newline</span> is converted to
 <span class="keycode">CR</span>/<span class="keycode">LF</span>. (This is the usual convention on <a href="http://www.freedos.org/" target="_top"><span class="platform">DOS</span></a>.)
 For example, <span class="keysym">#\Return</span>+<span class="keysym">#\Newline</span> is written as <span class="keycode">CR</span>/<span class="keycode">CR</span>/<span class="keycode">LF</span>.
</dd></dl></div>
<!--#endif-->
<p>When reading from a file, <span class="keycode">CR</span>/<span class="keycode">LF</span> is converted to <span class="keysym">#\Newline</span>
 (the usual convention on <a href="http://www.freedos.org/" target="_top"><span class="platform">DOS</span></a>), and <span class="keycode">CR</span> not followed by <span class="keycode">LF</span> is
 converted to <span class="keysym">#\Newline</span> as well (the usual conversion on MacOS, also used
 by some programs on <a href="http://winehq.com/" target="_top"><span class="platform">Win32</span></a>).
 If you do not want this, i.e., if you really want to distinguish
 <span class="keycode">LF</span>, <span class="keycode">CR</span> and <span class="keycode">CR</span>/<span class="keycode">LF</span>, you have to resort to
 binary input (function <a href="http://www.lisp.org/HyperSpec/Body/fun_read-byte.html" target="_top"><code class="function">READ-BYTE</code></a>).</p><p><b>Justification. </b><a href="http://www.unicode.org/reports/tr13/tr13-9.html" target="_top">Unicode
  Newline Guidelines</a> say: “<span class="quote">Even if you know which
  characters represents NLF on your particular platform, on input and in
  interpretation, treat CR, LF, CRLF, and NEL the same. Only on output do
  you need to distinguish between them.</span>”</p><p><b>Rationale. </b>In <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a>, <span class="keysym">#\Newline</span> is identical to <span class="keysym">#\Linefeed</span>
 (which is specifically permitted by [<span class="citation"><a href="references.html#ansi-cl">ANSI CL standard</a></span>] in section
 <a href="http://www.lisp.org/HyperSpec/Body/sec_13-1-7.html" target="_top">13.1.7 “<span class="quote">Character
   Names</span>”</a>).
 Consider a file containing exactly this string:
 <code class="code">(<a href="http://www.lisp.org/HyperSpec/Body/fun_concatenate.html" target="_top"><code class="function">CONCATENATE</code></a> '<a href="http://www.lisp.org/HyperSpec/Body/any_string.html" target="_top"><code class="literal">STRING</code></a> "foo" (<a href="http://www.lisp.org/HyperSpec/Body/fun_string.html" target="_top"><code class="function">STRING</code></a> <span class="keysym">#\Linefeed</span>)
  "bar" (<a href="http://www.lisp.org/HyperSpec/Body/fun_string.html" target="_top"><code class="function">STRING</code></a> <span class="keysym">#\Return</span>) (<a href="http://www.lisp.org/HyperSpec/Body/fun_string.html" target="_top"><code class="function">STRING</code></a> <span class="keysym">#\Linefeed</span>))</code>
 Suppose we open it with <code class="code">(<a href="http://www.lisp.org/HyperSpec/Body/fun_open.html" target="_top"><code class="function">OPEN</code></a> "foo" <a href="stream-dict.html#extfmt"><code class="constant">:EXTERNAL-FORMAT</code></a> <code class="constant">:DOS</code>)</code>.
 What should <a href="http://www.lisp.org/HyperSpec/Body/fun_read-line.html" target="_top"><code class="function">READ-LINE</code></a> return?
 Right now, it returns <span class="returnvalue">"foo"</span>
 (the second <a href="http://www.lisp.org/HyperSpec/Body/fun_read-line.html" target="_top"><code class="function">READ-LINE</code></a> returns <span class="returnvalue">"bar"</span>
 and reaches <a href="http://www.lisp.org/HyperSpec/Body/glo_e.html#end_of_file" target="_top"><code class="literal">end-of-stream</code></a>).
 If our i/o were “<span class="quote">faithful</span>”, <a href="http://www.lisp.org/HyperSpec/Body/fun_read-line.html" target="_top"><code class="function">READ-LINE</code></a> would have
 returned the string <code class="code">(<a href="http://www.lisp.org/HyperSpec/Body/fun_concatenate.html" target="_top"><code class="function">CONCATENATE</code></a> '<a href="http://www.lisp.org/HyperSpec/Body/any_string.html" target="_top"><code class="literal">STRING</code></a> "foo" (<a href="http://www.lisp.org/HyperSpec/Body/fun_string.html" target="_top"><code class="function">STRING</code></a>
  <span class="keysym">#\Linefeed</span>) "bar")</code>, i.e., a string with an embedded <span class="keysym">#\Newline</span>
 between <span class="returnvalue">"foo"</span>
 and <span class="returnvalue">"bar"</span> (because a single <span class="keysym">#\Linefeed</span> is not a
 <span class="keysym">#\Newline</span> in the specified <a href="stream-dict.html#extfmt"><code class="constant">:EXTERNAL-FORMAT</code></a>, it will not make <a href="http://www.lisp.org/HyperSpec/Body/fun_read-line.html" target="_top"><code class="function">READ-LINE</code></a> return,
 but it <span class="strong"><strong>is</strong></span> a <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> <span class="keysym">#\Newline</span>!)  Even though the specification for
 <a href="http://www.lisp.org/HyperSpec/Body/fun_read-line.html" target="_top"><code class="function">READ-LINE</code></a> does not explicitly forbids newlines inside the returned
 string, such behavior would be quite surprising, to say the least.
 Moreover, this line (with an embedded <span class="keysym">#\Newline</span>) would be written as two
 lines (when writing to a <a href="http://www.lisp.org/HyperSpec/Body/syscla_stream.html" target="_top"><code class="classname">STREAM</code></a> with <a href="stream-dict.html#extfmt"><code class="constant">:EXTERNAL-FORMAT</code></a> of <code class="constant">:DOS</code>), because
 the embedded <span class="keysym">#\Newline</span> would be written as <span class="keycode">CR</span>+<span class="keycode">LF</span>.</p></div><div class="bookinfo"><hr width="100%" /><table width="100%" summary="impnotes meta info"><th><td align="left">These notes document <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> version 2.39</td><td align="right">Last modified: 2006-07-15</td></th></table></div><div class="custom-footer"><hr width="100%" /><table width="100%"><tr><td align="left"><a href="http://clisp.cons.org"><img src="clisp.png" width="48" height="48" alt="[CLISP home]" /></a></td><td align="center"><a href="http://sourceforge.net/donate/index.php?group_id=1355"><img src="http://images.sourceforge.net/images/project-support.jpg" width="88" height="32" border="0" alt="[Support This Project]" /></a></td><td align="right"><a href="http://sourceforge.net"><img width="125" height="37" alt="[SourceForge]" src="http://sflogo.sourceforge.net/sflogo.php?group_id=1355&amp;type=2&amp;page=clhs-newline" /></a></td></tr></table></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="char-ord.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="characters.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="char-int.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">13.7. Ordering of Characters
   [CLHS-13.1.6] </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 13.9. Character Encodings
   [CLHS-13.1.9]</td></tr></table></div></body></html>
