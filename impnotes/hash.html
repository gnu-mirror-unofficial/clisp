<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<HTML
><HEAD
><TITLE
>Hash Tables
   [CLHS-18]</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.76b+
"><LINK
REV="MADE"
HREF="mailto:clisp-list@sf.net"><LINK
REL="HOME"
TITLE="Implementation Notes for GNU CLISP."
HREF="impnotes-top.html"><LINK
REL="UP"
TITLE="Chapters or the Common Lisp HyperSpec"
HREF="clhs-chapters.html"><LINK
REL="PREVIOUS"
TITLE="Sequences
   [CLHS-17]"
HREF="sequences.html"><LINK
REL="NEXT"
TITLE="Filenames
   [CLHS-19]"
HREF="filenames.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="impnotes.css"></HEAD
><BODY
CLASS="chapter"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Implementation Notes for <A
HREF="http://www.gnu.org"
TARGET="_top"
>GNU</A
> <A
HREF="http://clisp.cons.org"
TARGET="_top"
><B
CLASS="command"
>CLISP</B
></A
>.: These notes document <A
HREF="http://clisp.cons.org"
TARGET="_top"
><B
CLASS="command"
>CLISP</B
></A
> version 2.31.</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="sequences.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="filenames.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="chapter"
><H1
><A
NAME="hash"
></A
>Chapter 18. Hash Tables
   <A
HREF="http://www.lisp.org/HyperSpec/Body/chap-18.html"
TARGET="_top"
>[CLHS-18]</A
></H1
><DIV
CLASS="TOC"
><DL
><DT
><B
>Table of Contents</B
></DT
><DT
>18.1. <A
HREF="hash.html#hash-dict"
>The Hash Tables Dictionary
   <A
HREF="http://www.lisp.org/HyperSpec/Body/sec_the_hash__s_dictionary.html"
TARGET="_top"
>[CLHS-18.2]</A
></A
></DT
></DL
></DIV
><DIV
CLASS="section"
><H1
CLASS="section"
><A
NAME="hash-dict"
></A
>18.1. The Hash Tables Dictionary
   <A
HREF="http://www.lisp.org/HyperSpec/Body/sec_the_hash__s_dictionary.html"
TARGET="_top"
>[CLHS-18.2]</A
></H1
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="make-hash"
></A
>18.1.1. Function <A
HREF="http://www.lisp.org/HyperSpec/Body/fun_make-hash-table.html"
TARGET="_top"
><TT
CLASS="function"
>MAKE-HASH-TABLE</TT
></A
></H2
><P
ALIGN="justify"
><A
HREF="http://www.lisp.org/HyperSpec/Body/fun_make-hash-table.html"
TARGET="_top"
><TT
CLASS="function"
>MAKE-HASH-TABLE</TT
></A
> supports additional keywords
 <TT
CLASS="constant"
>:INITIAL-CONTENTS</TT
>
 and <TT
CLASS="constant"
>:WEAK</TT
>:</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;(<A
HREF="http://www.lisp.org/HyperSpec/Body/fun_make-hash-table.html"
TARGET="_top"
><TT
CLASS="function"
>MAKE-HASH-TABLE</TT
></A
> <A
HREF="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html"
TARGET="_top"
><TT
CLASS="literal"
>&#38;KEY</TT
></A
> :test :initial-contents :size
                 :rehash-size :rehash-threshold :weak)
</PRE
></TD
></TR
></TABLE
><P
ALIGN="justify"
>The <TT
CLASS="constant"
>:INITIAL-CONTENTS</TT
> argument is an
 <A
HREF="http://www.lisp.org/HyperSpec/Body/glo_a.html#association_list"
TARGET="_top"
>alist</A
> that is used to initialize the new hash table.
 The <TT
CLASS="constant"
>:REHASH-THRESHOLD</TT
> argument is ignored.</P
><P
ALIGN="justify"
>The <TT
CLASS="constant"
>:WEAK</TT
> can take the following values:
 <P
></P
><TABLE
BORDER="0"
><TBODY
><TR
><TD
><A
HREF="http://www.lisp.org/HyperSpec/Body/convar_nil.html"
TARGET="_top"
><TT
CLASS="constant"
>NIL</TT
></A
> (default)</TD
></TR
><TR
><TD
><TT
CLASS="constant"
>:KEY</TT
></TD
></TR
><TR
><TD
><TT
CLASS="constant"
>:VALUE</TT
></TD
></TR
><TR
><TD
><TT
CLASS="constant"
>:EITHER</TT
></TD
></TR
><TR
><TD
><TT
CLASS="constant"
>:BOTH</TT
></TD
></TR
></TBODY
></TABLE
><P
></P
>
and specifies whether the <A
HREF="http://www.lisp.org/HyperSpec/Body/syscla_hash-table.html"
TARGET="_top"
><TT
CLASS="classname"
>HASH-TABLE</TT
></A
> is <I
CLASS="emphasis"
>weak</I
>:
if the key, value, either or both are not accessible for the <A
HREF="gc.html"
>garbage-collect</A
>ion
purposes, i.e., if they are only accessible via weak <A
HREF="http://www.lisp.org/HyperSpec/Body/syscla_hash-table.html"
TARGET="_top"
><TT
CLASS="classname"
>HASH-TABLE</TT
></A
>s
and <A
HREF="weak.html"
><TT
CLASS="classname"
>EXT:WEAK-POINTER</TT
></A
>s, it is <A
HREF="gc.html"
>garbage-collect</A
>ed and removed from the weak
<A
HREF="http://www.lisp.org/HyperSpec/Body/syscla_hash-table.html"
TARGET="_top"
><TT
CLASS="classname"
>HASH-TABLE</TT
></A
>.</P
><P
ALIGN="justify"
>The <A
HREF="http://www.lisp.org/HyperSpec/Body/mac_setfcm_psetf.html"
TARGET="_top"
><TT
CLASS="function"
>SETF</TT
></A
>able predicate <TT
CLASS="function"
>EXT:HASH-TABLE-WEAK-P</TT
>
checks whether the <A
HREF="http://www.lisp.org/HyperSpec/Body/syscla_hash-table.html"
TARGET="_top"
><TT
CLASS="classname"
>HASH-TABLE</TT
></A
> is weak.</P
><P
ALIGN="justify"
>Just like <A
HREF="weak.html"
><TT
CLASS="classname"
>EXT:WEAK-POINTER</TT
></A
>s, weak <A
HREF="http://www.lisp.org/HyperSpec/Body/syscla_hash-table.html"
TARGET="_top"
><TT
CLASS="classname"
>HASH-TABLE</TT
></A
>s cannot be
printed readably.</P
></DIV
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="defhash"
></A
>18.1.2. Macro <A
HREF="hash.html#defhash"
><TT
CLASS="function"
>EXT:DEFINE-HASH-TABLE-TEST</TT
></A
></H2
><P
ALIGN="justify"
>You can define a new hash table test using the macro
 <A
HREF="hash.html#defhash"
><TT
CLASS="function"
>EXT:DEFINE-HASH-TABLE-TEST</TT
></A
>: <TT
CLASS="sexp"
>(<A
HREF="hash.html#defhash"
><TT
CLASS="function"
>EXT:DEFINE-HASH-TABLE-TEST</TT
></A
> test-name <TT
CLASS="replaceable"
><I
>test-function</I
></TT
>
  <TT
CLASS="replaceable"
><I
>hash-function</I
></TT
>)</TT
>, after which <TT
CLASS="replaceable"
><I
>test-name</I
></TT
>
 can be passed as the <TT
CLASS="constant"
>:TEST</TT
> argument to
 <A
HREF="http://www.lisp.org/HyperSpec/Body/fun_make-hash-table.html"
TARGET="_top"
><TT
CLASS="function"
>MAKE-HASH-TABLE</TT
></A
>.  E.g.: <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13; (<A
HREF="hash.html#defhash"
><TT
CLASS="function"
>EXT:DEFINE-HASH-TABLE-TEST</TT
></A
> string <A
HREF="http://www.lisp.org/HyperSpec/Body/fun_stringeqc_ng-not-lessp.html"
TARGET="_top"
><TT
CLASS="function"
>STRING=</TT
></A
> <A
HREF="http://www.lisp.org/HyperSpec/Body/fun_sxhash.html"
TARGET="_top"
><TT
CLASS="function"
>SXHASH</TT
></A
>)
 (<A
HREF="http://www.lisp.org/HyperSpec/Body/fun_make-hash-table.html"
TARGET="_top"
><TT
CLASS="function"
>MAKE-HASH-TABLE</TT
></A
> :test 'string)
</PRE
></TD
></TR
></TABLE
>
(which is not too useful because it is equivalent to an <A
HREF="http://www.lisp.org/HyperSpec/Body/fun_equal.html"
TARGET="_top"
><TT
CLASS="function"
>EQUAL</TT
></A
>
<A
HREF="http://www.lisp.org/HyperSpec/Body/syscla_hash-table.html"
TARGET="_top"
><TT
CLASS="classname"
>HASH-TABLE</TT
></A
> but less efficient).</P
><P
ALIGN="justify"
>The fundamental requirement is that the <TT
CLASS="replaceable"
><I
>test-function</I
></TT
> and <TT
CLASS="replaceable"
><I
>hash-function</I
></TT
> are
 consistent: <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;  (<A
HREF="http://www.lisp.org/HyperSpec/Body/fun_funcall.html"
TARGET="_top"
><TT
CLASS="function"
>FUNCALL</TT
></A
> <TT
CLASS="replaceable"
><I
>test-function</I
></TT
> <TT
CLASS="replaceable"
><I
>x</I
></TT
> <TT
CLASS="replaceable"
><I
>y</I
></TT
>) ==&#62;
  (<A
HREF="http://www.lisp.org/HyperSpec/Body/fun_eqcm_sleq__lteqcm_gteq.html"
TARGET="_top"
><TT
CLASS="function"
>=</TT
></A
> (<A
HREF="http://www.lisp.org/HyperSpec/Body/fun_funcall.html"
TARGET="_top"
><TT
CLASS="function"
>FUNCALL</TT
></A
> <TT
CLASS="replaceable"
><I
>hash-function</I
></TT
> <TT
CLASS="replaceable"
><I
>x</I
></TT
>) (<A
HREF="http://www.lisp.org/HyperSpec/Body/fun_funcall.html"
TARGET="_top"
><TT
CLASS="function"
>FUNCALL</TT
></A
> <TT
CLASS="replaceable"
><I
>hash-function</I
></TT
> <TT
CLASS="replaceable"
><I
>y</I
></TT
>))
 </PRE
></TD
></TR
></TABLE
>
 This means that the following definition: <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;  (<A
HREF="hash.html#defhash"
><TT
CLASS="function"
>EXT:DEFINE-HASH-TABLE-TEST</TT
></A
> number <A
HREF="http://www.lisp.org/HyperSpec/Body/fun_eqcm_sleq__lteqcm_gteq.html"
TARGET="_top"
><TT
CLASS="function"
>=</TT
></A
> <A
HREF="http://www.lisp.org/HyperSpec/Body/fun_sxhash.html"
TARGET="_top"
><TT
CLASS="function"
>SXHASH</TT
></A
>) ; <B
CLASS="emphasis"
>BAD!</B
>
 </PRE
></TD
></TR
></TABLE
>
 is <I
CLASS="emphasis"
>not</I
> correct because <TT
CLASS="sexp"
>(<A
HREF="http://www.lisp.org/HyperSpec/Body/fun_eqcm_sleq__lteqcm_gteq.html"
TARGET="_top"
><TT
CLASS="function"
>=</TT
></A
> 1 1d0)</TT
> is
 <A
HREF="http://www.lisp.org/HyperSpec/Body/convar_t.html"
TARGET="_top"
><TT
CLASS="constant"
>T</TT
></A
> but <TT
CLASS="sexp"
>(<A
HREF="http://www.lisp.org/HyperSpec/Body/fun_eqcm_sleq__lteqcm_gteq.html"
TARGET="_top"
><TT
CLASS="function"
>=</TT
></A
> (<A
HREF="http://www.lisp.org/HyperSpec/Body/fun_sxhash.html"
TARGET="_top"
><TT
CLASS="function"
>SXHASH</TT
></A
> 1) (<A
HREF="http://www.lisp.org/HyperSpec/Body/fun_sxhash.html"
TARGET="_top"
><TT
CLASS="function"
>SXHASH</TT
></A
> 1d0))</TT
>
 is <A
HREF="http://www.lisp.org/HyperSpec/Body/convar_nil.html"
TARGET="_top"
><TT
CLASS="constant"
>NIL</TT
></A
>.  The correct way is, e.g.: <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;  (<A
HREF="hash.html#defhash"
><TT
CLASS="function"
>EXT:DEFINE-HASH-TABLE-TEST</TT
></A
> number <A
HREF="http://www.lisp.org/HyperSpec/Body/fun_eqcm_sleq__lteqcm_gteq.html"
TARGET="_top"
><TT
CLASS="function"
>=</TT
></A
> (<A
HREF="http://www.lisp.org/HyperSpec/Body/mac_lambda.html"
TARGET="_top"
><TT
CLASS="function"
>LAMBDA</TT
></A
> (x) (<A
HREF="http://www.lisp.org/HyperSpec/Body/fun_sxhash.html"
TARGET="_top"
><TT
CLASS="function"
>SXHASH</TT
></A
> (<A
HREF="http://www.lisp.org/HyperSpec/Body/fun_coerce.html"
TARGET="_top"
><TT
CLASS="function"
>COERCE</TT
></A
> x '<A
HREF="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html"
TARGET="_top"
><TT
CLASS="classname"
>SHORT-FLOAT</TT
></A
>))))
 </PRE
></TD
></TR
></TABLE
>
 (note that
 <TT
CLASS="sexp"
>(<A
HREF="http://www.lisp.org/HyperSpec/Body/fun_coerce.html"
TARGET="_top"
><TT
CLASS="function"
>COERCE</TT
></A
> <TT
CLASS="replaceable"
><I
>x</I
></TT
> <A
HREF="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html"
TARGET="_top"
><TT
CLASS="classname"
>SHORT-FLOAT</TT
></A
>)</TT
>
 does <I
CLASS="emphasis"
>not</I
> cons while
 <TT
CLASS="sexp"
>(<A
HREF="http://www.lisp.org/HyperSpec/Body/fun_coerce.html"
TARGET="_top"
><TT
CLASS="function"
>COERCE</TT
></A
> <TT
CLASS="replaceable"
><I
>x</I
></TT
> <A
HREF="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html"
TARGET="_top"
><TT
CLASS="classname"
>DOUBLE-FLOAT</TT
></A
>)</TT
>
 does).</P
></DIV
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="ht-test"
></A
>18.1.3. Function <A
HREF="http://www.lisp.org/HyperSpec/Body/fun_hash-table-test.html"
TARGET="_top"
><TT
CLASS="function"
>HASH-TABLE-TEST</TT
></A
></H2
><P
ALIGN="justify"
>Function <A
HREF="http://www.lisp.org/HyperSpec/Body/fun_hash-table-test.html"
TARGET="_top"
><TT
CLASS="function"
>HASH-TABLE-TEST</TT
></A
> returns either one of the four standard
 symbols <A
HREF="http://www.lisp.org/HyperSpec/Body/fun_eq.html"
TARGET="_top"
><TT
CLASS="function"
>EQ</TT
></A
>, <A
HREF="http://www.lisp.org/HyperSpec/Body/fun_eql.html"
TARGET="_top"
><TT
CLASS="function"
>EQL</TT
></A
>, <A
HREF="http://www.lisp.org/HyperSpec/Body/fun_equal.html"
TARGET="_top"
><TT
CLASS="function"
>EQUAL</TT
></A
>, <A
HREF="http://www.lisp.org/HyperSpec/Body/fun_equalp.html"
TARGET="_top"
><TT
CLASS="function"
>EQUALP</TT
></A
>, or, for <A
HREF="http://www.lisp.org/HyperSpec/Body/syscla_hash-table.html"
TARGET="_top"
><TT
CLASS="classname"
>HASH-TABLE</TT
></A
>s
 created with a user-defined <A
HREF="http://www.lisp.org/HyperSpec/Body/fun_hash-table-test.html"
TARGET="_top"
><TT
CLASS="function"
>HASH-TABLE-TEST</TT
></A
> (see macro <A
HREF="hash.html#defhash"
><TT
CLASS="function"
>EXT:DEFINE-HASH-TABLE-TEST</TT
></A
>),
 a <A
HREF="http://www.lisp.org/HyperSpec/Body/syscla_cons.html"
TARGET="_top"
><TT
CLASS="classname"
>CONS</TT
></A
> cell <TT
CLASS="sexp"
>(<TT
CLASS="replaceable"
><I
>test-function</I
></TT
> . <TT
CLASS="replaceable"
><I
>hash-function</I
></TT
>)</TT
>.</P
></DIV
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="dohash"
></A
>18.1.4. Macro <A
HREF="hash.html#dohash"
><TT
CLASS="function"
>EXT:DOHASH</TT
></A
></H2
><P
ALIGN="justify"
>For iteration through a <A
HREF="http://www.lisp.org/HyperSpec/Body/syscla_hash-table.html"
TARGET="_top"
><TT
CLASS="classname"
>HASH-TABLE</TT
></A
>, a macro <A
HREF="hash.html#dohash"
><TT
CLASS="function"
>EXT:DOHASH</TT
></A
>,
 similar to <A
HREF="http://www.lisp.org/HyperSpec/Body/mac_dolist.html"
TARGET="_top"
><TT
CLASS="function"
>DOLIST</TT
></A
>, can be used instead of <A
HREF="http://www.lisp.org/HyperSpec/Body/fun_maphash.html"
TARGET="_top"
><TT
CLASS="function"
>MAPHASH</TT
></A
>:</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;(<A
HREF="hash.html#dohash"
><TT
CLASS="function"
>EXT:DOHASH</TT
></A
> (<TT
CLASS="replaceable"
><I
>key-var</I
></TT
> <TT
CLASS="replaceable"
><I
>value-var</I
></TT
> <TT
CLASS="replaceable"
><I
>hash-table-form</I
></TT
> [<TT
CLASS="replaceable"
><I
>resultform</I
></TT
>])
  {<TT
CLASS="replaceable"
><I
>declaration</I
></TT
>}*
  {<TT
CLASS="replaceable"
><I
>tag</I
></TT
>|<TT
CLASS="replaceable"
><I
>form</I
></TT
>}*)
</PRE
></TD
></TR
></TABLE
><P
ALIGN="justify"
><A
HREF="hash.html#dohash"
><TT
CLASS="function"
>EXT:DOHASH</TT
></A
> forms are <A
HREF="http://www.lisp.org/HyperSpec/Body/glo_i.html#iteration_form"
TARGET="_top"
>iteration form</A
>s.</P
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="sequences.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="impnotes-top.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="filenames.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Sequences
   <A
HREF="http://www.lisp.org/HyperSpec/Body/chap-17.html"
TARGET="_top"
>[CLHS-17]</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="clhs-chapters.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Filenames
   <A
HREF="http://www.lisp.org/HyperSpec/Body/chap-19.html"
TARGET="_top"
>[CLHS-19]</A
></TD
></TR
></TABLE
></DIV
><div
class="custom-footer"
><hr
width="100%"><table
width="100%"
><tr
><td
align="left"
><a
href="http://clisp.cons.org"
><img
src="clisp.png"
width="48"
height="48"
alt="[CLISP home]"></a
></td
><td
align="center"
><a
href="http://www.gnu.org"
><img
src="http://www.gnu.org/graphics/gnubanner.jpg"
width="468"
height="60"
alt="[Come and see what GNU creates for YOU]"></a
></td
><td
align="right"
><a
href="http://sourceforge.net"
><img
src="http://sourceforge.net/sflogo.php?group_id=1355&amp;type=2"
width="125"
height="37"
alt="[SourceForge]"></a
></td
></tr
></table
></div
></BODY
></HTML
>