<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:cf="http://docbook.sourceforge.net/xmlns/chunkfast/1.0"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>31.5. Socket Streams</title><link rel="stylesheet" href="impnotes.css" type="text/css" /><link rev="made" href="mailto:clisp-list@sf.net" /><meta name="generator" content="DocBook XSL Stylesheets V2005-07-12_04:47_snapshot" /><link rel="start" href="index.html" title="Implementation Notes for GNU CLISP." /><link rel="up" href="ext-platform.html" title="Chapter 31. Platform Specific Extensions" /><link rel="prev" href="affi.html" title="31.4. The Amiga Foreign Function Call Facility" /><link rel="next" href="quickstart.html" title="31.6. Quickstarting delivery with CLISP" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">31.5. Socket Streams</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="affi.html">Prev</a> </td><th width="60%" align="center">Chapter 31. Platform Specific Extensions</th><td width="20%" align="right"> <a accesskey="n" href="quickstart.html">Next</a></td></tr></table><hr /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="socket"></a>31.5. Socket Streams</h2></div><div><h3 class="subtitle"><span class="plat-dep">Platform Dependent: <span class="plat-dep"><a href="http://www.UNIX-systems.org/online.html" target="_top"><span class="strong"><strong>UNIX</strong></span></a>, <a href="http://winehq.com/" target="_top"><span class="strong"><strong>Win32</strong></span></a> platforms only.</span></span></h3></div></div></div>
<!--#ifdef SOCKET_STREAMS-->
<div class="variablelist"><dl><dt><a id="sose"></a><code class="code">(<a href="socket.html#sose"><code class="function">SOCKET:SOCKET-SERVER</code></a> <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;OPTIONAL</code></a>
                 [<em class="replaceable"><code>port-or-socket</code></em>])</code></dt><dd>This function creates a socket an binds a port to
    the socket.  The server exists to watch for client connect attempts.
    The optional argument is either a port (positive <a href="http://www.lisp.org/HyperSpec/Body/typ_fixnum.html" target="_top"><code class="classname">FIXNUM</code></a>) or a
    <a href="socket.html" title="31.5. Socket Streams"><code class="classname">SOCKET:SOCKET-STREAM</code></a> (from whose peer the connections will be made).
 </dd><dt><a id="sose-close"></a><code class="code">(<a href="socket.html#sose-close"><code class="function">SOCKET:SOCKET-SERVER-CLOSE</code></a> <em class="replaceable"><code>socket-server</code></em>)</code></dt><dd>Closes down the server socket.
    <a href="stream-dict.html#close" title="21.3.10. Function CLOSE">Just like streams</a>,
    <a href="socket.html" title="31.5. Socket Streams"><code class="classname">SOCKET:SOCKET-SERVER</code></a>s are closed at <a href="gc.html" title="Chapter 34. Overview of CLISP's Garbage Collection">garbage-collect</a>ion.  You should not rely on
    this however, because <a href="gc.html" title="Chapter 34. Overview of CLISP's Garbage Collection">garbage-collect</a>ion times are not deterministic.
 </dd><dt><a id="sose-hopo"></a><code class="code">(<a href="socket.html#sose-hopo"><code class="function">SOCKET:SOCKET-SERVER-HOST</code></a> <em class="replaceable"><code>socket-server</code></em>)</code><br /><code class="code">(<a href="socket.html#sose-hopo"><code class="function">SOCKET:SOCKET-SERVER-PORT</code></a> <em class="replaceable"><code>socket-server</code></em>)</code></dt><dd>Returns the host mask indicating which hosts can
    connect to this server and the port which was bound using <a href="socket.html#sose"><code class="function">SOCKET:SOCKET-SERVER</code></a>.
 </dd><dt><a id="so-wait"></a><code class="code">(<a href="socket.html#so-wait"><code class="function">SOCKET:SOCKET-WAIT</code></a>
    <em class="replaceable"><code>socket-server</code></em> <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;OPTIONAL</code></a> <a href="socket.html#timeout-opt">[<em class="replaceable"><code>seconds</code></em> [<em class="replaceable"><code>microseconds</code></em>]]</a>)</code></dt><dd>Wait for a fixed time for a
    connection on the <em class="replaceable"><code>socket-server</code></em> (a <a href="socket.html" title="31.5. Socket Streams"><code class="classname">SOCKET:SOCKET-SERVER</code></a>).
    Without a timeout argument, <a href="socket.html#so-wait"><code class="function">SOCKET:SOCKET-WAIT</code></a> blocks indefinitely.
    When timeout is zero, poll.
    Returns <a href="http://www.lisp.org/HyperSpec/Body/convar_t.html" target="_top"><code class="constant">T</code></a> when a connection is available (i.e., <a href="socket.html#so-accept"><code class="function">SOCKET:SOCKET-ACCEPT</code></a> will
    not block) and <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a> on timeout.</dd><dt><a id="so-accept"></a><code class="code">(<a href="socket.html#so-accept"><code class="function">SOCKET:SOCKET-ACCEPT</code></a> <em class="replaceable"><code>socket-server</code></em>
    <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;KEY</code></a> <a href="stream-dict.html#eltype"><code class="constant">:ELEMENT-TYPE</code></a> <a href="stream-dict.html#extfmt"><code class="constant">:EXTERNAL-FORMAT</code></a> <a href="stream-dict.html#buffered"><code class="constant">:BUFFERED</code></a> <a href="socket.html#timeout-k"><code class="constant">:TIMEOUT</code></a>)</code></dt><dd>Creates the server-side <a href="http://www.lisp.org/HyperSpec/Body/glo_b.html#bidirectional" target="_top">bidirectional</a>
    <a href="socket.html" title="31.5. Socket Streams"><code class="classname">SOCKET:SOCKET-STREAM</code></a> for the connection.
   Waits for an attempt to connect to the server for no more than
   <a href="socket.html#timeout-k"><code class="constant">:TIMEOUT</code></a> <a href="http://www.lisp.org/HyperSpec/Body/sec_25-1-4-4.html" target="_top">seconds</a> (which may be a non-negative <a href="http://www.lisp.org/HyperSpec/Body/syscla_real.html" target="_top"><code class="classname">REAL</code></a> or a
   list <span class="data"><code class="literal">(sec usec)</code></span> or a pair
   <span class="data"><code class="literal">(sec . usec)</code></span>).
   <a href="http://www.lisp.org/HyperSpec/Body/fun_signal.html" target="_top"><code class="function">SIGNAL</code></a>s an <a href="http://www.lisp.org/HyperSpec/Body/contyp_error.html" target="_top"><code class="classname">ERROR</code></a> if no connection is made in that time.
  </dd><dt><a id="so-connect"></a><code class="code">(<a href="socket.html#so-connect"><code class="function">SOCKET:SOCKET-CONNECT</code></a>
    <em class="replaceable"><code>port</code></em> <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;OPTIONAL</code></a> [<em class="replaceable"><code>host</code></em>] <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;KEY</code></a>
    <a href="stream-dict.html#eltype"><code class="constant">:ELEMENT-TYPE</code></a> <a href="stream-dict.html#extfmt"><code class="constant">:EXTERNAL-FORMAT</code></a> <a href="stream-dict.html#buffered"><code class="constant">:BUFFERED</code></a> <a href="socket.html#timeout-k"><code class="constant">:TIMEOUT</code></a>)</code></dt><dd>Attempts to create a client-side <a href="http://www.lisp.org/HyperSpec/Body/glo_b.html#bidirectional" target="_top">bidirectional</a>
   <a href="socket.html" title="31.5. Socket Streams"><code class="classname">SOCKET:SOCKET-STREAM</code></a>.  Blocks until the server accepts the connection, for
   no more than <a href="socket.html#timeout-k"><code class="constant">:TIMEOUT</code></a> <a href="http://www.lisp.org/HyperSpec/Body/sec_25-1-4-4.html" target="_top">seconds</a>.  If it is 0, returns immediately
   and (probably) blocks on the next i/o operation (you can use
   <a href="socket.html#so-status"><code class="function">SOCKET:SOCKET-STATUS</code></a> to check whether it will actually block).
  </dd><dt><a id="so-status"></a><code class="code">(<a href="socket.html#so-status"><code class="function">SOCKET:SOCKET-STATUS</code></a>
                 <em class="replaceable"><code>socket-stream-or-list</code></em>
                 <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;OPTIONAL</code></a> <a href="socket.html#timeout-opt">[<em class="replaceable"><code>seconds</code></em> [<em class="replaceable"><code>microseconds</code></em>]]</a>)</code></dt><dd><p>Checks whether it is possible to read from or write
   to a <a href="socket.html" title="31.5. Socket Streams"><code class="classname">SOCKET:SOCKET-STREAM</code></a> or whether a connection is available on a
   <a href="socket.html" title="31.5. Socket Streams"><code class="classname">SOCKET:SOCKET-SERVER</code></a> without blocking.</p><p>For the cognoscenti: this is the interface to <a href="http://www.opengroup.org/onlinepubs/007904975/functions/select.html" target="_top"><code class="function">select</code></a>, so
    it will work for any <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> <a href="http://www.lisp.org/HyperSpec/Body/syscla_stream.html" target="_top"><code class="classname">STREAM</code></a> which is based on a
    <a href="http://www.opengroup.org/onlinepubs/007904975/basedefs/xbd_chap03.html#tag_03_165" target="_top">file descriptor</a>, e.g., <a href="terminal.html#with-kbd" class="olink"><code class="varname">EXT:*KEYBOARD-INPUT*</code></a> and <a href="stream-dict.html#open" title="21.3.9. Function OPEN">file</a>/<a href="shell.html#pipe" title="31.8.2. Pipes">pipe</a>/<a href="socket.html" title="31.5. Socket Streams">socket</a> <a href="http://www.lisp.org/HyperSpec/Body/syscla_stream.html" target="_top"><code class="classname">STREAM</code></a>, as well as
    for <a href="rawsock.html" title="32.13. Raw Socket Access.">raw sockets</a>.</p><p>This is similar to <a href="http://www.lisp.org/HyperSpec/Body/fun_listen.html" target="_top"><code class="function">LISTEN</code></a>, which checks only one
    <a href="http://www.lisp.org/HyperSpec/Body/syscla_stream.html" target="_top"><code class="classname">STREAM</code></a> and only for input, and <a href="socket.html#so-wait"><code class="function">SOCKET:SOCKET-WAIT</code></a>, which works only with
    <a href="socket.html" title="31.5. Socket Streams"><code class="classname">SOCKET:SOCKET-SERVER</code></a>s.</p><p>We define “<span class="quote">status</span>” for a <a href="socket.html" title="31.5. Socket Streams"><code class="classname">SOCKET:SOCKET-SERVER</code></a> or a
    <a href="socket.html" title="31.5. Socket Streams"><code class="classname">SOCKET:SOCKET-STREAM</code></a> to be <code class="constant">:ERROR</code> if any i/o operation will cause an
    <a href="http://www.lisp.org/HyperSpec/Body/contyp_error.html" target="_top"><code class="classname">ERROR</code></a>.</p><p>Additionally, for a <a href="socket.html" title="31.5. Socket Streams"><code class="classname">SOCKET:SOCKET-SERVER</code></a>, we define
    “<span class="quote">status</span>” to be <a href="http://www.lisp.org/HyperSpec/Body/convar_t.html" target="_top"><code class="constant">T</code></a> if a connection is available, i.e.,
    is <a href="socket.html#so-accept"><code class="function">SOCKET:SOCKET-ACCEPT</code></a> will not block, and <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a> otherwise.</p><p>Additionally, for a <a href="socket.html" title="31.5. Socket Streams"><code class="classname">SOCKET:SOCKET-STREAM</code></a>, we define
    “<span class="quote">status</span>” in the given <em class="replaceable"><code>direction</code></em> (one of <code class="constant">:INPUT</code>,
    <code class="constant">:OUTPUT</code>, and <code class="constant">:IO</code>) to be
    </p><div class="variablelist"><a id="so-status-values"></a><p class="title"><b>Possible status values for various directions:</b></p><dl><dt><code class="constant">:INPUT</code> status:</dt><dd><div class="variablelist"><dl><dt><a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a></dt><dd>reading will block
        </dd><dt><code class="constant">:INPUT</code></dt><dd>some input is available
        </dd><dt><code class="constant">:EOF</code></dt><dd>the stream has reached its end
       </dd></dl></div></dd><dt><code class="constant">:OUTPUT</code> status:</dt><dd><div class="variablelist"><dl><dt><a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a></dt><dd>writing will block
        </dd><dt><code class="constant">:OUTPUT</code></dt><dd>output to the stream will not block
       </dd></dl></div></dd><dt><code class="constant">:IO</code> status:</dt><dd><div class="informaltable"><a id="so-status-i-o"></a><table border="1"><colgroup><col align="center" /><col align="center" /><col align="center" /><col align="center" /></colgroup><thead><tr><th rowspan="2" align="center" valign="bottom">output status</th><th colspan="3" align="center">input status</th></tr><tr><th align="center"><a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a></th><th align="center"><code class="constant">:INPUT</code></th><th align="center"><code class="constant">:EOF</code></th></tr></thead><tbody><tr><td align="center"><a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a></td><td align="center"><a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a></td><td align="center"><code class="constant">:INPUT</code></td><td align="center"><code class="constant">:EOF</code></td></tr><tr><td align="center"><code class="constant">:OUTPUT</code></td><td align="center"><code class="constant">:OUTPUT</code></td><td align="center"><code class="constant">:IO</code></td><td align="center"><code class="constant">:APPEND</code></td></tr></tbody></table></div></dd></dl></div><div class="variablelist"><p class="title"><b>Possible values of
     <em class="replaceable"><code>socket-stream-or-list</code></em>:</b></p><dl><dt><a href="socket.html" title="31.5. Socket Streams"><code class="classname">SOCKET:SOCKET-STREAM</code></a> or <a href="socket.html" title="31.5. Socket Streams"><code class="classname">SOCKET:SOCKET-SERVER</code></a></dt><dd>Returns the appropriate status, as defined
       above (<code class="constant">:IO</code> status for <a href="socket.html" title="31.5. Socket Streams"><code class="classname">SOCKET:SOCKET-STREAM</code></a>)
    </dd><dt><code class="code">(<a href="socket.html" title="31.5. Socket Streams"><code class="classname">SOCKET:SOCKET-STREAM</code></a> . <em class="replaceable"><code>direction</code></em>)</code></dt><dd>Return the status in the specified direction
    </dd><dt>a list of the above</dt><dd>Return a list of values, one for each element of the
       argument list (a la <a href="http://www.lisp.org/HyperSpec/Body/fun_mapccm_ma_istcm_mapcon.html" target="_top"><code class="function">MAPCAR</code></a>)</dd></dl></div><p>If you want to avoid <a href="http://www.lisp.org/HyperSpec/Body/glo_c.html#cons" target="_top">consing[3]</a> up a <a href="http://www.lisp.org/HyperSpec/Body/glo_f.html#fresh" target="_top">fresh</a> list, you can
    make the elements of <em class="replaceable"><code>socket-stream-or-list</code></em>
    to be <span class="data"><code class="literal">(<em class="replaceable"><code>socket-stream</code></em> <em class="replaceable"><code>direction</code></em> .
     <em class="replaceable"><code>x</code></em>)</code></span> or <span class="data"><code class="literal">(<em class="replaceable"><code>socket-server</code></em> . <em class="replaceable"><code>x</code></em>)</code></span>.
    Then <a href="socket.html#so-status"><code class="function">SOCKET:SOCKET-STATUS</code></a> will destructively modify its argument and replace
    <em class="replaceable"><code>x</code></em> or <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a> with the status and return the modified list.
    You can pass this modified list to <a href="socket.html#so-status"><code class="function">SOCKET:SOCKET-STATUS</code></a> again.</p><p>The optional arguments specify the timeout. <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a> means
    wait forever, <code class="literal">0</code> means poll.</p><p>The second value returned is the number of objects with
    non-<a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a> status, i.e., “<span class="quote">actionable</span>” objects.
    <a href="socket.html#so-status"><code class="function">SOCKET:SOCKET-STATUS</code></a> returns either due to a timeout or when this number is
    positive, i.e., if the timeout was <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a> and <a href="socket.html#so-status"><code class="function">SOCKET:SOCKET-STATUS</code></a> did
    return, then the second value is positive.</p></dd><dt><a id="sost-hopo"></a><code class="code">(<a href="socket.html#sost-hopo"><code class="function">SOCKET:SOCKET-STREAM-HOST</code></a> <em class="replaceable"><code>socket-stream</code></em>)</code><br /><code class="code">(<a href="socket.html#sost-hopo"><code class="function">SOCKET:SOCKET-STREAM-PORT</code></a> <em class="replaceable"><code>socket-stream</code></em>)</code></dt><dd>These two functions return information about the
    <a href="socket.html" title="31.5. Socket Streams"><code class="classname">SOCKET:SOCKET-STREAM</code></a>.</dd><dt><a id="service-port"></a><code class="code">(<a href="socket.html#service-port"><code class="function">SOCKET:SOCKET-SERVICE-PORT</code></a>
                 <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;OPTIONAL</code></a> <em class="replaceable"><code>service-name</code></em>
                 (<em class="replaceable"><code>protocol</code></em> "tcp"))</code></dt><dd>A convenience function for looking up a port given
    the service name.  It returns the servent struct as <a href="http://www.lisp.org/HyperSpec/Body/glo_m.html#multiple_values" target="_top">multiple values</a>
    (name, list of aliases, port, protocol) for the given
    <em class="replaceable"><code>service-name</code></em> and
    <em class="replaceable"><code>protocol</code></em>, or all services as the list of
    <span class="type"><code class="literal">(<a href="http://www.lisp.org/HyperSpec/Body/typ_simple-vector.html" target="_top"><code class="classname">SIMPLE-VECTOR</code></a> 4)</code></span>
    if <em class="replaceable"><code>service-name</code></em> is not given or is
    <code class="constant">:DEFAULT</code> or <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>.</dd><dt><a id="sost-peer"></a><code class="code">(<a href="socket.html#sost-peer"><code class="function">SOCKET:SOCKET-STREAM-PEER</code></a>
    <em class="replaceable"><code>socket-stream</code></em> [<em class="replaceable"><code>do-not-resolve-p</code></em>])</code></dt><dd><p>Given a <a href="socket.html" title="31.5. Socket Streams"><code class="classname">SOCKET:SOCKET-STREAM</code></a>, this function returns the
    name of the host on the opposite side of the connection and its port
    number; the server-side can use this to see who connected.</p><p>When the optional second argument is non-<a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>, the hostname
    resolution is disabled and just the IP address is returned, without
    the <acronym title="Fully Qualified Domain Name"><span class="acronym">FQDN</span></acronym>.
 </p></dd><dt><a id="sost-local"></a><code class="code">(<a href="socket.html#sost-local"><code class="function">SOCKET:SOCKET-STREAM-LOCAL</code></a>
    <em class="replaceable"><code>socket-stream</code></em> [<em class="replaceable"><code>do-not-resolve-p</code></em>])</code></dt><dd>The dual to <a href="socket.html#sost-peer"><code class="function">SOCKET:SOCKET-STREAM-PEER</code></a> - same information,
   host name and port number, but for the local host.
   The difference from <a href="socket.html#sost-hopo"><code class="function">SOCKET:SOCKET-STREAM-HOST</code></a> and <a href="socket.html#sost-hopo"><code class="function">SOCKET:SOCKET-STREAM-PORT</code></a> is that this function
   asks the OS (and thus returns the correct trusted values) while the
   other two are just accessors to the internal data structure, and
   basically return the arguments given to the function which created
   the <em class="replaceable"><code>socket-stream</code></em>.</dd><dt><a id="sost-shut"></a><code class="code">(<a href="socket.html#sost-shut"><code class="function">SOCKET:SOCKET-STREAM-SHUTDOWN</code></a> <em class="replaceable"><code>socket-stream</code></em>
    <em class="replaceable"><code>direction</code></em>)</code></dt><dd><p>Some Internet protocols, such as <a href="http://www.w3.org/Protocols/" target="_top"><span><strong class="command">HTTP</strong></span></a>, provide for
   closing the connection in one <em class="replaceable"><code>direction</code></em> using <a href="http://www.opengroup.org/onlinepubs/007904975/functions/shutdown.html" target="_top"><code class="function">shutdown</code></a>.
   This function provides an interface to this <a href="http://www.UNIX-systems.org/online.html" target="_top"><span class="strong"><strong>UNIX</strong></span></a> system call.
   <em class="replaceable"><code>direction</code></em> should be <code class="constant">:INPUT</code> or <code class="constant">:OUTPUT</code>.
   Note that you should still call <a href="http://www.lisp.org/HyperSpec/Body/fun_close.html" target="_top"><code class="function">CLOSE</code></a> after you are done with your
   <em class="replaceable"><code>socket-stream</code></em>; this is best accomplished by using <a href="http://www.lisp.org/HyperSpec/Body/mac_with-open-stream.html" target="_top"><code class="function">WITH-OPEN-STREAM</code></a>.</p><p>All <a href="socket.html" title="31.5. Socket Streams"><code class="classname">SOCKET:SOCKET-STREAM</code></a>s are <a href="http://www.lisp.org/HyperSpec/Body/glo_b.html#bidirectional" target="_top">bidirectional</a> <a href="http://www.lisp.org/HyperSpec/Body/syscla_stream.html" target="_top"><code class="classname">STREAM</code></a>s (i.e., both <a href="http://www.lisp.org/HyperSpec/Body/fun_input-str_put-stream-p.html" target="_top"><code class="function">INPUT-STREAM-P</code></a>
   and <a href="http://www.lisp.org/HyperSpec/Body/fun_input-str_put-stream-p.html" target="_top"><code class="function">OUTPUT-STREAM-P</code></a> return <a href="http://www.lisp.org/HyperSpec/Body/convar_t.html" target="_top"><code class="constant">T</code></a> for them).
   <a href="socket.html#sost-shut"><code class="function">SOCKET:SOCKET-STREAM-SHUTDOWN</code></a> <span class="emphasis"><em>breaks</em></span> this and turns its argument
   stream into an <a href="http://www.lisp.org/HyperSpec/Body/glo_i.html#input" target="_top">input</a> <a href="http://www.lisp.org/HyperSpec/Body/syscla_stream.html" target="_top"><code class="classname">STREAM</code></a> (if <em class="replaceable"><code>direction</code></em> is <code class="constant">:OUTPUT</code>) or <a href="http://www.lisp.org/HyperSpec/Body/glo_o.html#output" target="_top">output</a> <a href="http://www.lisp.org/HyperSpec/Body/syscla_stream.html" target="_top"><code class="classname">STREAM</code></a> (if
   <em class="replaceable"><code>direction</code></em> is <code class="constant">:INPUT</code>).
    Thus, the following important invariant is preserved: whenever
   </p><div class="itemizedlist"><ul type="disc"><li>a <a href="http://www.lisp.org/HyperSpec/Body/syscla_stream.html" target="_top"><code class="classname">STREAM</code></a> is open
    (i.e., <a href="http://www.lisp.org/HyperSpec/Body/fun_open-stream-p.html" target="_top"><code class="function">OPEN-STREAM-P</code></a> returns <a href="http://www.lisp.org/HyperSpec/Body/convar_t.html" target="_top"><code class="constant">T</code></a>) and</li><li>a <a href="http://www.lisp.org/HyperSpec/Body/syscla_stream.html" target="_top"><code class="classname">STREAM</code></a> is an <a href="http://www.lisp.org/HyperSpec/Body/glo_i.html#input" target="_top">input</a> <a href="http://www.lisp.org/HyperSpec/Body/syscla_stream.html" target="_top"><code class="classname">STREAM</code></a> (i.e., <a href="http://www.lisp.org/HyperSpec/Body/fun_input-str_put-stream-p.html" target="_top"><code class="function">INPUT-STREAM-P</code></a>
     returns <a href="http://www.lisp.org/HyperSpec/Body/convar_t.html" target="_top"><code class="constant">T</code></a>)</li></ul></div><p>
   the <a href="http://www.lisp.org/HyperSpec/Body/syscla_stream.html" target="_top"><code class="classname">STREAM</code></a> can be read from (e.g., with <a href="http://www.lisp.org/HyperSpec/Body/fun_read-char.html" target="_top"><code class="function">READ-CHAR</code></a> or <a href="http://www.lisp.org/HyperSpec/Body/fun_read-byte.html" target="_top"><code class="function">READ-BYTE</code></a>).
 </p></dd><dt><a id="so-opt"></a><code class="code">(<a href="socket.html#so-opt"><code class="function">SOCKET:SOCKET-OPTIONS</code></a> <em class="replaceable"><code>socket-server</code></em> <a href="http://www.lisp.org/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;REST</code></a>
    {<em class="replaceable"><code>option</code></em>}*)</code></dt><dd>Query and, optionally, set socket options using
   <a href="http://www.opengroup.org/onlinepubs/007904975/functions/getsockopt.html" target="_top"><code class="function">getsockopt</code></a> and <a href="http://www.opengroup.org/onlinepubs/007904975/functions/setsockopt.html" target="_top"><code class="function">setsockopt</code></a>.
   An <em class="replaceable"><code>option</code></em> is a keyword, optionally followed by the new value.
   When the new value is not supplied, <a href="http://www.opengroup.org/onlinepubs/007904975/functions/setsockopt.html" target="_top"><code class="function">setsockopt</code></a> is not called.
   For each option the old (or current, if new value was not supplied)
   value is returned. E.g., <code class="code">(<a href="socket.html#so-opt"><code class="function">SOCKET:SOCKET-OPTIONS</code></a> <em class="replaceable"><code>socket-server</code></em>
   :SO-LINGER 1 :SO-RCVLOWAT)</code> returns 2 values: <a href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>, the old
   value of the <code class="constant">:SO-LINGER</code> option, and 1, the
   current value of the <code class="constant">:SO-RCVLOWAT</code> option.
  </dd></dl></div>
<!--#endif-->
</div><div class="bookinfo"><hr width="100%" /><table width="100%" summary="impnotes meta info"><th><td align="left">These notes document <a href="http://clisp.cons.org" target="_top"><span><strong class="command">CLISP</strong></span></a> version 2.34.</td><td align="right">Last modified: 2005-07-20</td></th></table></div><div class="custom-footer"><hr width="100%" /><table width="100%"><tr><td align="left"><a href="http://clisp.cons.org"><img src="clisp.png" width="48" height="48" alt="[CLISP home]" /></a></td><td align="center"><a href="http://www.gnu.org"><img src="http://www.gnu.org/graphics/gnubanner.jpg" width="468" height="60" alt="[Come and see what GNU creates for YOU]" /></a></td><td align="right"><a href="http://sourceforge.net"><img width="125" height="37" alt="[SourceForge]" src="http://sflogo.sourceforge.net/sflogo.php?group_id=1355&amp;type=2&amp;page=socket" /></a></td></tr></table></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="affi.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ext-platform.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="quickstart.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">31.4. The Amiga Foreign Function Call Facility </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 31.6. Quickstarting delivery with <span><strong class="command">CLISP</strong></span></td></tr></table></div></body></html>
